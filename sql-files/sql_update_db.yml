# This file is a part of rAthena.
#   Copyright(C) 2020 rAthena Development Team
#   https://rathena.org - https://github.com/rathena
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program. If not, see <http://www.gnu.org/licenses/>.
#
###########################################################################
# SQL Update Database
###########################################################################
#
# SQL Update Settings
#
###########################################################################
# - Id                       Patch ID.
#   Script                   Individual SQL script to execute.
#   Mode                     Server mode the update applies to. (Default: Both)
#   Database                 Database the update applies to. (Default: Normal)
#   Skip                     Skip the update. (Default: false)
#   PatchDate                Timestamp of when succesfully patched. Automatically generated by the server.
###########################################################################

Header:
  Type: SQL_UPDATE_DB
  Version: 1

Body:
  # 14.3 Flaming Basin - Dimensional Travel Quest variable fix
  - Id: 1
    Script: >
      UPDATE `char_reg_num` SET `key` = 'ep14_3_newerabs' WHERE `key` = 'ep14_3_dimensional_travel' AND `index` = 0 AND `value` < 2;
    Mode: Renewal
  - Id: 2
    Script: >
      UPDATE `char_reg_num` SET `key` = 'ep14_3_newerabs', `value` = 3 WHERE `key` = 'ep14_3_dimensional_travel' AND `index` = 0 AND `value` = 2;
    Mode: Renewal
  - Id: 3
    Script: >
      UPDATE `char_reg_num` SET `key` = 'ep14_3_newerabs', `value` = `value` + 2 WHERE `key` = 'ep14_3_dimensional_travel' AND `index` = 0 AND `value` < 8;
    Mode: Renewal
  - Id: 4
    Script: >
      UPDATE `char_reg_num` SET `key` = 'ep14_3_newerabs', `value` = `value` + 7 WHERE `key` = 'ep14_3_dimensional_travel' AND `index` = 0 AND `value` > 7;
    Mode: Renewal

  # CR_CULTIVATION removal from Renewal
  - Id: 5
    Script: >
      UPDATE `char` c, `skill` s SET `c`.skill_point = `c`.skill_point + `s`.lv WHERE `s`.id = 491 AND `c`.char_id = `s`.char_id;
    Mode: Renewal
  - Id: 6
    Script: >
      DELETE FROM `skill` WHERE `id` = 491;
    Mode: Renewal

  # AB_EUCHARISTICA removal
  - Id: 7
    Script: >
      UPDATE `char` c, `skill` s SET `c`.skill_point = `c`.skill_point + `s`.lv WHERE `s`.id = 2049 AND `c`.char_id = `s`.char_id;
  - Id: 8 
    Script: >
      DELETE FROM `skill` WHERE `id` = 2049;

  # GN_SLINGITEM removal
  - Id: 9
    Script: >
      UPDATE `char` c, `skill` s SET `c`.skill_point = `c`.skill_point + `s`.lv WHERE `s`.id = 2493 AND `c`.char_id = `s`.char_id;
  - Id: 10
    Script: >
      DELETE FROM `skill` WHERE `id` = 2493;

  # GN_MAKEBOMB removal
  - Id: 11
    Script: >
      UPDATE `char` c, `skill` s SET `c`.skill_point = `c`.skill_point + `s`.lv WHERE `s`.id = 2496 AND `c`.char_id = `s`.char_id;
  - Id: 12
    Script: >
      DELETE FROM `skill` WHERE `id` = 2496;

  # HT_SANDMAN removal from Super Novice Expanded
  - Id: 13
    Script: >
      UPDATE `char` c, `skill` s SET `c`.skill_point = `c`.skill_point + `s`.lv WHERE (`c`.class = 4190 OR `c`.class = 4191) AND `s`.id = 119 AND `c`.char_id = `s`.char_id;
  - Id: 14
    Script: >
      DELETE FROM `skill` USING `skill`, `char` WHERE (`char`.class = 4190 OR `char`.class = 4191) AND `skill`.id = 119 AND `char`.char_id = `skill`.char_id;

  # HT_FLASHER removal from Super Novice Expanded
  - Id: 15
    Script: >
      UPDATE `char` c, `skill` s SET `c`.skill_point = `c`.skill_point + `s`.lv WHERE (`c`.class = 4190 OR `c`.class = 4191) AND `s`.id = 120 AND `c`.char_id = `s`.char_id;
  - Id: 16
    Script: >
      DELETE FROM `skill` USING `skill`, `char` WHERE (`char`.class = 4190 OR `char`.class = 4191) AND `skill`.id = 120 AND `char`.char_id = `skill`.char_id;

  # HT_FREEZINGTRAP removal from Super Novice Expanded
  - Id: 17
    Script: >
      UPDATE `char` c, `skill` s SET `c`.skill_point = `c`.skill_point + `s`.lv WHERE (`c`.class = 4190 OR `c`.class = 4191) AND `s`.id = 121 AND `c`.char_id = `s`.char_id;
  - Id: 18
    Script: >
      DELETE FROM `skill` USING `skill`, `char` WHERE (`char`.class = 4190 OR `char`.class = 4191) AND `skill`.id = 121 AND `char`.char_id = `skill`.char_id;

Footer:
  Imports:
  - Path: sql-files/saves/login-sql_update_db.yml
  - Path: sql-files/saves/char-sql_update_db.yml
  - Path: sql-files/saves/map-sql_update_db.yml
  - Path: sql-files/saves/log-sql_update_db.yml
