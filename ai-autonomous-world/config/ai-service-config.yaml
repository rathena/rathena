# ============================================================================
# AI Autonomous World Service - Configuration
# ============================================================================
# This file configures the AI service including LLM providers, databases,
# and autonomous feature settings.
#
# ⚠️  SECURITY WARNING ⚠️
# DO NOT commit API keys or passwords to version control!
# All sensitive values use ${ENVIRONMENT_VARIABLE} placeholders.
# Set actual values in the .env file located at:
#   ai-autonomous-world/ai_service/.env
#
# The .env file should be in .gitignore and never committed.
# ============================================================================

# Service Configuration
service:
  name: "ai-service"
  host: "0.0.0.0"
  port: 8000
  environment: "development"  # Options: development, staging, production
  debug: true
  log_level: "INFO"  # Options: DEBUG, INFO, WARNING, ERROR, CRITICAL

# ============================================================================
# LLM Provider Configuration
# ============================================================================
# Configure your preferred LLM providers. The service supports multiple
# providers and will use the default_provider unless specified per request.
#
# Supported Providers:
# - azure_openai: Azure OpenAI Service (recommended for enterprise)
# - openai: OpenAI API
# - deepseek: DeepSeek API
# - google_gemini: Google Gemini API
# - anthropic: Anthropic Claude API
# - ollama: Local Ollama instance (no API key required)
# ============================================================================

llm:
  default_provider: "azure_openai"  # Default LLM provider to use
  
  # Azure OpenAI Configuration (Recommended for Production)
  # IMPORTANT: Set your actual API key in the .env file, NOT here!
  # This file may be committed to version control.
  azure_openai:
    enabled: "${AZURE_OPENAI_ENABLED:-true}"
    api_key: "${AZURE_OPENAI_API_KEY}"
    endpoint: "${AZURE_OPENAI_ENDPOINT}"
    api_version: "${AZURE_OPENAI_API_VERSION:-2024-02-15-preview}"
    deployment_name: "${AZURE_OPENAI_DEPLOYMENT_NAME}"
    model: "${AZURE_OPENAI_MODEL:-gpt-4}"
    temperature: "${AZURE_OPENAI_TEMPERATURE:-0.7}"
    max_tokens: "${AZURE_OPENAI_MAX_TOKENS:-2000}"
    timeout: "${AZURE_OPENAI_TIMEOUT:-30}"
  
  # OpenAI Configuration
  # IMPORTANT: Set your actual API key in the .env file, NOT here!
  openai:
    enabled: "${OPENAI_ENABLED:-false}"
    api_key: "${OPENAI_API_KEY}"
    model: "${OPENAI_MODEL:-gpt-4-turbo-preview}"
    temperature: "${OPENAI_TEMPERATURE:-0.7}"
    max_tokens: "${OPENAI_MAX_TOKENS:-2000}"
    timeout: "${OPENAI_TIMEOUT:-30}"

  # DeepSeek Configuration
  # IMPORTANT: Set your actual API key in the .env file, NOT here!
  deepseek:
    enabled: "${DEEPSEEK_ENABLED:-false}"
    api_key: "${DEEPSEEK_API_KEY}"
    base_url: "${DEEPSEEK_BASE_URL:-https://api.deepseek.com/v1}"
    model: "${DEEPSEEK_MODEL:-deepseek-chat}"
    temperature: "${DEEPSEEK_TEMPERATURE:-0.7}"
    max_tokens: "${DEEPSEEK_MAX_TOKENS:-2000}"
    timeout: "${DEEPSEEK_TIMEOUT:-30}"

  # Google Gemini Configuration
  # IMPORTANT: Set your actual API key in the .env file, NOT here!
  google_gemini:
    enabled: "${GOOGLE_GEMINI_ENABLED:-false}"
    api_key: "${GOOGLE_API_KEY}"
    model: "${GOOGLE_GEMINI_MODEL:-gemini-pro}"
    temperature: "${GOOGLE_GEMINI_TEMPERATURE:-0.7}"
    max_tokens: "${GOOGLE_GEMINI_MAX_TOKENS:-2000}"
    timeout: "${GOOGLE_GEMINI_TIMEOUT:-30}"

  # Anthropic Claude Configuration
  # IMPORTANT: Set your actual API key in the .env file, NOT here!
  anthropic:
    enabled: "${ANTHROPIC_ENABLED:-false}"
    api_key: "${ANTHROPIC_API_KEY}"
    model: "${ANTHROPIC_MODEL:-claude-3-opus-20240229}"
    temperature: "${ANTHROPIC_TEMPERATURE:-0.7}"
    max_tokens: "${ANTHROPIC_MAX_TOKENS:-2000}"
    timeout: "${ANTHROPIC_TIMEOUT:-30}"

  # Ollama Configuration (Local, No API Key Required)
  ollama:
    enabled: "${OLLAMA_ENABLED:-false}"
    base_url: "${OLLAMA_BASE_URL:-http://localhost:11434}"
    model: "${OLLAMA_MODEL:-llama2}"
    temperature: "${OLLAMA_TEMPERATURE:-0.7}"
    timeout: "${OLLAMA_TIMEOUT:-60}"

# ============================================================================
# Database Configuration
# ============================================================================

# DragonflyDB (Redis-compatible) - High-speed caching and Pub/Sub
# IMPORTANT: Set password in .env file if authentication is enabled
dragonfly:
  host: "${DRAGONFLY_HOST:-localhost}"
  port: "${DRAGONFLY_PORT:-6379}"
  db: "${DRAGONFLY_DB:-0}"
  password: "${DRAGONFLY_PASSWORD:-}"  # Set in .env if authentication enabled
  max_connections: "${DRAGONFLY_MAX_CONNECTIONS:-50}"
  socket_timeout: "${DRAGONFLY_SOCKET_TIMEOUT:-5}"
  socket_connect_timeout: "${DRAGONFLY_SOCKET_CONNECT_TIMEOUT:-5}"

# PostgreSQL - Persistent memory storage (requires Memori SDK)
# IMPORTANT: Set your actual password in the .env file, NOT here!
postgres:
  host: "${POSTGRES_HOST:-localhost}"
  port: "${POSTGRES_PORT:-5432}"
  database: "${POSTGRES_DB:-ai_world_memory}"
  user: "${POSTGRES_USER:-postgres}"
  password: "${POSTGRES_PASSWORD}"
  min_connections: "${POSTGRES_MIN_CONNECTIONS:-5}"
  max_connections: "${POSTGRES_MAX_CONNECTIONS:-20}"
  
  # Required PostgreSQL Extensions:
  # - pgvector: Vector similarity search
  # - timescaledb: Time-series data
  # - age: Graph database capabilities
  #
  # Installation (requires sudo):
  # sudo apt-get install postgresql-17 postgresql-17-pgvector
  # sudo apt-get install timescaledb-2-postgresql-17
  # Follow Apache AGE installation guide for your PostgreSQL version

# ============================================================================
# Autonomous Features Configuration
# ============================================================================

autonomous_features:
  # NPC Movement System
  npc_movement:
    enabled: true
    mode: "event_driven"  # Options: event_driven, fixed_interval
    update_interval: 60  # seconds (for fixed_interval mode)
    idle_timeout: 60  # seconds (for event_driven mode)
    chain_movement: true
    adaptive_behavior: true
    max_distance: 10  # cells

  # Economic Simulation
  economic_simulation:
    enabled: true
    mode: "daily"  # Options: hourly, daily, weekly
    update_interval: 86400  # seconds
    adaptive_pricing: true
    learning_enabled: true
    inflation_enabled: true
    supply_demand_enabled: true
    events_enabled: true

  # Shop Restocking
  shop_restocking:
    enabled: true
    mode: "npc_driven"  # Options: npc_driven, scheduled
    check_interval: 86400  # seconds
    npc_learning: true
    default_restock_interval: 3600  # seconds

  # Faction System
  faction_system:
    enabled: true
    reputation_decay: true
    decay_interval: 604800  # seconds (7 days)
    dynamic_relationships: true

  # Agent Learning
  agent_learning:
    enabled: true
    memory_retention_days: 30
    decision_logging: true
    context_window: 10

  # NPC-to-NPC Interactions
  npc_interactions:
    enabled: true
    interaction_range: 5  # cells
    relationship_tracking: true
    information_sharing: true
    proximity_check_interval: 30  # seconds
    relationship_decay_rate: 0.01  # per day

  # Instant Response System
  instant_response:
    enabled: true
    instant_events:
      - "combat"
      - "urgent_quest"
      - "special_event"
      - "player_death"
      - "boss_spawn"
    max_concurrent: 10

  # Universal Consciousness
  universal_consciousness:
    enabled: true
    reasoning_depth: "deep"  # Options: shallow, medium, deep
    history_days: 7
    future_planning: true
    planning_steps: 3
    reasoning_chain_logging: true
    world_consciousness: true

  # LLM Optimization
  llm_optimization:
    mode: "balanced"  # Options: fast, balanced, quality
    decision_cache:
      enabled: true
      ttl: 3600  # seconds
      similarity_threshold: 0.85
    decision_batching:
      enabled: true
      batch_size: 5
      batch_timeout: 2.0  # seconds
    pre_filtering: true
    rule_based_decisions: true
    complexity_threshold: 0.5

# ============================================================================
# Free-Form Text Input Configuration
# ============================================================================

free_form_input:
  enabled: true
  mode: "chat_command"  # Options: chat_command, npc_dialogue
  max_length: 500  # characters
  rate_limiting: true
  response_timeout: 30  # seconds

# Chat Command Interface
chat_command:
  enabled: true
  prefix: "@npc"
  cooldown: 2  # seconds
  proximity_required: true

# ============================================================================
# Performance & Optimization
# ============================================================================

performance:
  # GPU Acceleration (requires FAISS)
  gpu_acceleration:
    enabled: false  # Set to true if GPU and FAISS are available
    device: "cuda:0"

  # HTTP Connection Pooling
  http_pooling:
    enabled: true
    max_connections: 100
    timeout: 30

  # Redis Caching
  redis_caching:
    enabled: true
    default_ttl: 300  # seconds
    max_cache_size: 10000  # items

  # Batch Processing
  batch_processing:
    enabled: true
    default_batch_size: 10
    max_wait_time: 1.0  # seconds

# ============================================================================
# Logging Configuration
# ============================================================================

logging:
  level: "INFO"
  format: "json"  # Options: json, text
  rotation: "10 MB"  # Rotate when log file reaches this size
  retention: "7 days"  # Keep logs for this duration
  compression: "gz"  # Compress rotated logs

# ============================================================================
# NPC Configuration
# ============================================================================
# Individual NPC configurations including personality traits and movement settings

npcs:
  # Existing NPCs
  ai_guard_003:
    name: "Guard Thorne"
    class: "guard"
    spawn_location:
      map: "prontera"
      x: 145
      y: 175
    personality:
      openness: 0.3
      conscientiousness: 0.8
      extraversion: 0.4
      agreeableness: 0.6
      neuroticism: 0.3
    movement:
      mode: "radius_restricted"  # Options: disabled, global, map_restricted, radius_restricted
      radius: 15
      spawn_x: 145
      spawn_y: 175

  ai_explorer_002:
    name: "Lyra the Explorer"
    class: "explorer"
    spawn_location:
      map: "prontera"
      x: 155
      y: 185
    personality:
      openness: 0.9
      conscientiousness: 0.5
      extraversion: 0.8
      agreeableness: 0.7
      neuroticism: 0.4
    movement:
      mode: "radius_restricted"
      radius: 20
      spawn_x: 155
      spawn_y: 185

  # Test NPC for Movement System Verification - AGGRESSIVE MOVEMENT
  test_merchant_001:
    name: "WanderingMerchant"
    class: "merchant"
    spawn_location:
      map: "prontera"
      x: 150
      y: 180
    personality:
      openness: 0.98  # MAXIMUM openness - extremely curious and restless
      conscientiousness: 0.3  # Low conscientiousness - impulsive, doesn't stick to routines
      extraversion: 0.95  # MAXIMUM extraversion - constantly seeking stimulation
      agreeableness: 0.8
      neuroticism: 0.1  # MINIMUM anxiety - fearless, adventurous
    movement:
      mode: "radius_restricted"  # Restricted to small area for easy observation
      radius: 10  # Small radius for visual verification
      spawn_x: 150
      spawn_y: 180
      aggressive: true  # Flag for aggressive movement behavior
      movement_probability: 0.95  # 95% chance to move when checked
      min_distance: 5  # Minimum distance to move (tiles)
      max_distance: 10  # Maximum distance to move (tiles)
    description: "Test NPC for autonomous movement system verification. AGGRESSIVE MOVEMENT: Moves every 2 seconds with high probability and large distances within 10-tile radius."

