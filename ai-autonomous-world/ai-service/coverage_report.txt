/home/lot399/ai-mmorpg-world/rathena-AI-world/p2p-coordinator/venv/lib/python3.12/site-packages/pytest_asyncio/plugin.py:208: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
[1m============================= test session starts ==============================[0m
platform linux -- Python 3.12.3, pytest-8.3.4, pluggy-1.6.0 -- /home/lot399/ai-mmorpg-world/rathena-AI-world/p2p-coordinator/venv/bin/python3
cachedir: .pytest_cache
rootdir: /ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service
configfile: pytest.ini
plugins: anyio-4.11.0, cov-7.0.0, Faker-37.12.0, asyncio-0.24.0, mock-3.15.1
asyncio: mode=Mode.AUTO, default_loop_scope=None
[1mcollecting ... [0mcollected 93 items

tests/performance/test_npc_load.py::test_100_npc_registration [31mFAILED[0m[31m     [  1%][0m
tests/performance/test_npc_load.py::test_100_npc_concurrent_interactions [31mFAILED[0m[31m [  2%][0m
tests/performance/test_npc_load.py::test_sustained_load_100_npcs [31mFAILED[0m[31m  [  3%][0m
tests/performance/test_npc_load.py::test_stress_test_200_npcs [31mFAILED[0m[31m     [  4%][0m
tests/test_config.py::TestSettings::test_default_settings [32mPASSED[0m[31m         [  5%][0m
tests/test_config.py::TestSettings::test_cors_origins_not_wildcard [32mPASSED[0m[31m [  6%][0m
tests/test_config.py::TestSettings::test_new_config_fields_exist [32mPASSED[0m[31m  [  7%][0m
tests/test_config.py::TestSettings::test_azure_endpoint_validation [32mPASSED[0m[31m [  8%][0m
tests/test_config.py::TestSettings::test_numeric_range_validation [32mPASSED[0m[31m [  9%][0m
tests/test_config.py::TestSettings::test_environment_override [32mPASSED[0m[31m     [ 10%][0m
tests/test_config.py::TestSettings::test_llm_provider_config [32mPASSED[0m[31m      [ 11%][0m
tests/test_config.py::TestSettings::test_redis_config [32mPASSED[0m[31m             [ 12%][0m
tests/test_config.py::TestSettings::test_movement_config [32mPASSED[0m[31m          [ 13%][0m
tests/test_config.py::TestSettings::test_chat_command_config [32mPASSED[0m[31m      [ 15%][0m
tests/test_config.py::TestSettings::test_gpu_config [32mPASSED[0m[31m               [ 16%][0m
tests/test_config.py::TestConfigValidation::test_invalid_port [32mPASSED[0m[31m     [ 17%][0m
tests/test_config.py::TestConfigValidation::test_invalid_redis_db [32mPASSED[0m[31m [ 18%][0m
tests/test_config.py::TestConfigValidation::test_temperature_range [32mPASSED[0m[31m [ 19%][0m
tests/test_config.py::TestConfigValidation::test_timeout_positive [32mPASSED[0m[31m [ 20%][0m
tests/test_config.py::TestConfigValidation::test_retry_count_positive [32mPASSED[0m[31m [ 21%][0m
tests/test_database.py::TestDatabase::test_database_initialization [32mPASSED[0m[31m [ 22%][0m
tests/test_database.py::TestDatabase::test_connect_success [31mFAILED[0m[31m        [ 23%][0m
tests/test_database.py::TestDatabase::test_connect_retry_logic [31mFAILED[0m[31m    [ 24%][0m
tests/test_database.py::TestDatabase::test_connect_max_retries_exceeded [31mFAILED[0m[31m [ 25%][0m
tests/test_database.py::TestDatabase::test_disconnect [31mFAILED[0m[31m             [ 26%][0m
tests/test_database.py::TestDatabase::test_get_npc_state [32mPASSED[0m[31m          [ 27%][0m
tests/test_database.py::TestDatabase::test_set_npc_state [32mPASSED[0m[31m          [ 29%][0m
tests/test_database.py::TestDatabase::test_get_player_memory [31mFAILED[0m[31m      [ 30%][0m
tests/test_database.py::TestDatabase::test_add_player_memory [31mFAILED[0m[31m      [ 31%][0m
tests/test_database.py::TestDatabase::test_rate_limit_check [31mFAILED[0m[31m       [ 32%][0m
tests/test_database.py::TestDatabase::test_set_rate_limit [31mFAILED[0m[31m         [ 33%][0m
tests/test_database.py::TestDatabase::test_quest_operations [31mFAILED[0m[31m       [ 34%][0m
tests/test_database.py::TestDatabaseErrorHandling::test_connection_error_handling [31mFAILED[0m[31m [ 35%][0m
tests/test_database.py::TestDatabaseErrorHandling::test_timeout_error_handling [31mFAILED[0m[31m [ 36%][0m
tests/test_environment.py::TestEnvironmentManager::test_initialize_creates_default_state [32mPASSED[0m[31m [ 37%][0m
tests/test_environment.py::TestEnvironmentManager::test_initialize_loads_existing_state [32mPASSED[0m[31m [ 38%][0m
tests/test_environment.py::TestEnvironmentManager::test_initialize_resources [32mPASSED[0m[31m [ 39%][0m
tests/test_environment.py::TestEnvironmentManager::test_update_environment_calls_all_systems [32mPASSED[0m[31m [ 40%][0m
tests/test_environment.py::TestEnvironmentManager::test_update_time_of_day_cycles_correctly [32mPASSED[0m[31m [ 41%][0m
tests/test_environment.py::TestEnvironmentManager::test_update_weather_respects_probability [32mPASSED[0m[31m [ 43%][0m
tests/test_environment.py::TestEnvironmentManager::test_weather_transition_weights [32mPASSED[0m[31m [ 44%][0m
tests/test_environment.py::TestEnvironmentManager::test_update_season_progresses_correctly [32mPASSED[0m[31m [ 45%][0m
tests/test_environment.py::TestEnvironmentManager::test_check_and_trigger_disasters [32mPASSED[0m[31m [ 46%][0m
tests/test_environment.py::TestEnvironmentManager::test_get_affected_areas [32mPASSED[0m[31m [ 47%][0m
tests/test_environment.py::TestEnvironmentManager::test_get_disaster_effects [32mPASSED[0m[31m [ 48%][0m
tests/test_environment.py::TestEnvironmentManager::test_update_active_disasters_expires_old [32mPASSED[0m[31m [ 49%][0m
tests/test_environment.py::TestEnvironmentManager::test_update_resource_availability [32mPASSED[0m[31m [ 50%][0m
tests/test_environment.py::TestEnvironmentManager::test_seasonal_resource_modifier [32mPASSED[0m[31m [ 51%][0m
tests/test_environment.py::TestEnvironmentManager::test_publish_environment_event [32mPASSED[0m[31m [ 52%][0m
tests/test_environment.py::TestEnvironmentManager::test_save_and_load_state [32mPASSED[0m[31m [ 53%][0m
tests/test_environment.py::TestEnvironmentManager::test_get_current_state [32mPASSED[0m[31m [ 54%][0m
tests/test_environment.py::TestEnvironmentManager::test_get_active_disasters [32mPASSED[0m[31m [ 55%][0m
tests/test_environment.py::TestEnvironmentManager::test_force_weather_change [32mPASSED[0m[31m [ 56%][0m
tests/test_environment.py::TestEnvironmentManager::test_trigger_disaster [32mPASSED[0m[31m [ 58%][0m
tests/test_environment.py::TestModuleFunctions::test_update_environment_cycle [32mPASSED[0m[31m [ 59%][0m
tests/test_environment.py::TestModuleFunctions::test_initialize_environment [32mPASSED[0m[31m [ 60%][0m
tests/test_environment.py::TestModuleFunctions::test_get_environment_state [32mPASSED[0m[31m [ 61%][0m
tests/test_environment.py::TestModuleFunctions::test_get_active_disasters_function [32mPASSED[0m[31m [ 62%][0m
tests/test_environment.py::TestModuleFunctions::test_force_weather_change_function [32mPASSED[0m[31m [ 63%][0m
tests/test_environment.py::TestModuleFunctions::test_trigger_disaster_function [32mPASSED[0m[31m [ 64%][0m
tests/test_environment.py::TestEnvironmentConfiguration::test_weather_types_configured [32mPASSED[0m[31m [ 65%][0m
tests/test_environment.py::TestEnvironmentConfiguration::test_time_of_day_phases_configured [32mPASSED[0m[31m [ 66%][0m
tests/test_environment.py::TestEnvironmentConfiguration::test_season_types_configured [32mPASSED[0m[31m [ 67%][0m
tests/test_environment.py::TestEnvironmentConfiguration::test_disaster_types_configured [32mPASSED[0m[31m [ 68%][0m
tests/test_environment.py::TestEnvironmentConfiguration::test_resource_types_configured [32mPASSED[0m[31m [ 69%][0m
tests/test_environment.py::TestEnvironmentConfiguration::test_probabilities_in_valid_range [32mPASSED[0m[31m [ 70%][0m
tests/test_environment.py::TestEnvironmentConfiguration::test_durations_positive [32mPASSED[0m[31m [ 72%][0m
tests/test_environment.py::TestEnvironmentConfiguration::test_environment_enabled_flag [32mPASSED[0m[31m [ 73%][0m
tests/test_environment.py::TestEnvironmentConfiguration::test_environment_update_mode [32mPASSED[0m[31m [ 74%][0m
tests/test_integration.py::TestModuleImports::test_config_import [32mPASSED[0m[31m  [ 75%][0m
tests/test_integration.py::TestModuleImports::test_database_import [32mPASSED[0m[31m [ 76%][0m
tests/test_integration.py::TestModuleImports::test_llm_factory_import [31mFAILED[0m[31m [ 77%][0m
tests/test_integration.py::TestModuleImports::test_llm_base_import [32mPASSED[0m[31m [ 78%][0m
tests/test_integration.py::TestModuleImports::test_azure_provider_import [31mFAILED[0m[31m [ 79%][0m
tests/test_integration.py::TestModuleImports::test_agents_import [31mFAILED[0m[31m  [ 80%][0m
tests/test_integration.py::TestModuleImports::test_main_app_import [31mFAILED[0m[31m [ 81%][0m
tests/test_integration.py::TestConfigurationValues::test_remediation_config_fields [32mPASSED[0m[31m [ 82%][0m
tests/test_integration.py::TestConfigurationValues::test_cors_security [32mPASSED[0m[31m [ 83%][0m
tests/test_integration.py::TestConfigurationValues::test_llm_provider_config [32mPASSED[0m[31m [ 84%][0m
tests/test_integration.py::TestDatabaseConnection::test_database_instance [32mPASSED[0m[31m [ 86%][0m
tests/test_integration.py::TestDatabaseConnection::test_database_class [32mPASSED[0m[31m [ 87%][0m
tests/test_integration.py::TestLLMProviders::test_azure_provider_initialization [31mFAILED[0m[31m [ 88%][0m
tests/test_integration.py::TestLLMProviders::test_llm_response_model [32mPASSED[0m[31m [ 89%][0m
tests/test_integration.py::TestAgents::test_dialogue_agent_initialization [31mFAILED[0m[31m [ 90%][0m
tests/test_integration.py::TestAgents::test_decision_agent_initialization [31mFAILED[0m[31m [ 91%][0m
tests/test_performance.py::TestDatabasePerformance::test_npc_state_read_performance [32mPASSED[0m[31m [ 92%][0m
tests/test_performance.py::TestDatabasePerformance::test_memory_retrieval_performance [31mFAILED[0m[31m [ 93%][0m
tests/test_performance.py::TestDatabasePerformance::test_concurrent_database_operations [32mPASSED[0m[31m [ 94%][0m
tests/test_performance.py::TestLLMPerformance::test_llm_generation_performance [32mPASSED[0m[31m [ 95%][0m
tests/test_performance.py::TestLLMPerformance::test_concurrent_llm_calls [32mPASSED[0m[31m [ 96%][0m
tests/test_performance.py::TestAgentPerformance::test_dialogue_agent_performance [31mFAILED[0m[31m [ 97%][0m
tests/test_performance.py::TestAgentPerformance::test_orchestrator_performance [31mFAILED[0m[31m [ 98%][0m
tests/test_performance.py::TestEndToEndPerformance::test_player_interaction_latency [31mFAILED[0m[31m [100%][0m

=================================== FAILURES ===================================
[31m[1m__________________________ test_100_npc_registration ___________________________[0m
[1m[31mtests/performance/test_npc_load.py[0m:163: in test_100_npc_registration
    assert stats['npc_registrations'] >= 90, "At least 90% of NPCs should register successfully"
[1m[31mE   AssertionError: At least 90% of NPCs should register successfully[0m
[1m[31mE   assert 51 >= 90[0m
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: Register 100 NPCs Concurrently
================================================================================
Failed to register NPC load_test_npc_088: 500
Failed to register NPC load_test_npc_087: 500
Failed to register NPC load_test_npc_086: 500
Failed to register NPC load_test_npc_079: 500
Failed to register NPC load_test_npc_055: 500
Failed to register NPC load_test_npc_078: 500
Failed to register NPC load_test_npc_075: 500
Failed to register NPC load_test_npc_074: 500
Failed to register NPC load_test_npc_073: 500
Failed to register NPC load_test_npc_071: 500
Failed to register NPC load_test_npc_070: 500
Failed to register NPC load_test_npc_068: 500
Failed to register NPC load_test_npc_072: 500
Failed to register NPC load_test_npc_069: 500
Failed to register NPC load_test_npc_067: 500
Failed to register NPC load_test_npc_066: 500
Failed to register NPC load_test_npc_065: 500
Failed to register NPC load_test_npc_064: 500
Failed to register NPC load_test_npc_063: 500
Failed to register NPC load_test_npc_059: 500
Failed to register NPC load_test_npc_061: 500
Failed to register NPC load_test_npc_062: 500
Failed to register NPC load_test_npc_060: 500
Failed to register NPC load_test_npc_056: 500
Failed to register NPC load_test_npc_058: 500
Failed to register NPC load_test_npc_057: 500
Failed to register NPC load_test_npc_053: 500
Failed to register NPC load_test_npc_052: 500
Failed to register NPC load_test_npc_054: 500
Failed to register NPC load_test_npc_084: 500
Failed to register NPC load_test_npc_085: 500
Failed to register NPC load_test_npc_083: 500
Failed to register NPC load_test_npc_082: 500
Failed to register NPC load_test_npc_081: 500
Failed to register NPC load_test_npc_077: 500
Failed to register NPC load_test_npc_076: 500
Failed to register NPC load_test_npc_080: 500
Failed to register NPC load_test_npc_096: 500
Failed to register NPC load_test_npc_097: 500
Failed to register NPC load_test_npc_095: 500
Failed to register NPC load_test_npc_094: 500
Failed to register NPC load_test_npc_093: 500
Failed to register NPC load_test_npc_091: 500
Failed to register NPC load_test_npc_092: 500
Failed to register NPC load_test_npc_090: 500
Failed to register NPC load_test_npc_089: 500
Failed to register NPC load_test_npc_100: 500
Failed to register NPC load_test_npc_099: 500
Failed to register NPC load_test_npc_098: 500

Results:
  Total NPCs: 51
  Errors: 49
  Error Rate: 49.00%
  Avg Latency: 655.92ms
  P50 Latency: 682.64ms
  P95 Latency: 723.49ms
  P99 Latency: 725.49ms
[31m[1m_____________________ test_100_npc_concurrent_interactions _____________________[0m
[1m[31mtests/performance/test_npc_load.py[0m:215: in test_100_npc_concurrent_interactions
    assert stats['player_interactions'] >= 450, "At least 90% of interactions should succeed"
[1m[31mE   AssertionError: At least 90% of interactions should succeed[0m
[1m[31mE   assert 0 >= 450[0m
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: 100 NPCs with Concurrent Player Interactions
================================================================================

Step 1: Registering 100 NPCs...
  Registered: 100 NPCs

Step 2: Simulating 500 player interactions...

Results:
  Total Interactions: 0
  Errors: 500
  Error Rate: 199.20%
  Avg Latency: 38209.33ms
  P50 Latency: 35394.31ms
  P95 Latency: 48654.10ms
  P99 Latency: 48744.49ms
[31m[1m_________________________ test_sustained_load_100_npcs _________________________[0m
[1m[31mtests/performance/test_npc_load.py[0m:283: in test_sustained_load_100_npcs
    assert throughput >= 5, "Throughput should be at least 5 req/s"
[1m[31mE   AssertionError: Throughput should be at least 5 req/s[0m
[1m[31mE   assert 0.0 >= 5[0m
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: Sustained Load - 100 NPCs for 60 seconds
================================================================================

Registering 100 NPCs...
Failed to register NPC load_test_npc_001: 429
Failed to register NPC load_test_npc_003: 429
Failed to register NPC load_test_npc_002: 429
Failed to register NPC load_test_npc_004: 429
Failed to register NPC load_test_npc_005: 429
Failed to register NPC load_test_npc_006: 429
Failed to register NPC load_test_npc_007: 429
Failed to register NPC load_test_npc_010: 429
Failed to register NPC load_test_npc_008: 429
Failed to register NPC load_test_npc_009: 429
Failed to register NPC load_test_npc_011: 429
Failed to register NPC load_test_npc_014: 429
Failed to register NPC load_test_npc_013: 429
Failed to register NPC load_test_npc_012: 429
Failed to register NPC load_test_npc_016: 429
Failed to register NPC load_test_npc_017: 429
Failed to register NPC load_test_npc_018: 429
Failed to register NPC load_test_npc_019: 429
Failed to register NPC load_test_npc_015: 429
Failed to register NPC load_test_npc_021: 429
Failed to register NPC load_test_npc_022: 429
Failed to register NPC load_test_npc_020: 429
Failed to register NPC load_test_npc_023: 429
Failed to register NPC load_test_npc_028: 429
Failed to register NPC load_test_npc_025: 429
Failed to register NPC load_test_npc_035: 429
Failed to register NPC load_test_npc_026: 429
Failed to register NPC load_test_npc_033: 429
Failed to register NPC load_test_npc_024: 429
Failed to register NPC load_test_npc_039: 429
Failed to register NPC load_test_npc_027: 429
Failed to register NPC load_test_npc_030: 429
Failed to register NPC load_test_npc_038: 429
Failed to register NPC load_test_npc_034: 429
Failed to register NPC load_test_npc_036: 429
Failed to register NPC load_test_npc_042: 429
Failed to register NPC load_test_npc_031: 429
Failed to register NPC load_test_npc_032: 429
Failed to register NPC load_test_npc_037: 429
Failed to register NPC load_test_npc_044: 429
Failed to register NPC load_test_npc_029: 429
Failed to register NPC load_test_npc_057: 429
Failed to register NPC load_test_npc_045: 429
Failed to register NPC load_test_npc_058: 429
Failed to register NPC load_test_npc_068: 429
Failed to register NPC load_test_npc_063: 429
Failed to register NPC load_test_npc_041: 429
Failed to register NPC load_test_npc_050: 429
Failed to register NPC load_test_npc_054: 429
Failed to register NPC load_test_npc_056: 429
Failed to register NPC load_test_npc_049: 429
Failed to register NPC load_test_npc_065: 429
Failed to register NPC load_test_npc_043: 429
Failed to register NPC load_test_npc_069: 429
Failed to register NPC load_test_npc_061: 429
Failed to register NPC load_test_npc_062: 429
Failed to register NPC load_test_npc_073: 429
Failed to register NPC load_test_npc_048: 429
Failed to register NPC load_test_npc_072: 429
Failed to register NPC load_test_npc_040: 429
Failed to register NPC load_test_npc_046: 429
Failed to register NPC load_test_npc_047: 429
Failed to register NPC load_test_npc_055: 429
Failed to register NPC load_test_npc_064: 429
Failed to register NPC load_test_npc_071: 429
Failed to register NPC load_test_npc_059: 429
Failed to register NPC load_test_npc_053: 429
Failed to register NPC load_test_npc_052: 429
Failed to register NPC load_test_npc_051: 429
Failed to register NPC load_test_npc_090: 429
Failed to register NPC load_test_npc_067: 429
Failed to register NPC load_test_npc_070: 429
Failed to register NPC load_test_npc_074: 429
Failed to register NPC load_test_npc_083: 429
Failed to register NPC load_test_npc_076: 429
Failed to register NPC load_test_npc_060: 429
Failed to register NPC load_test_npc_084: 429
  Registered: 23 NPCs

Running sustained load for 60 seconds...
  Progress: 10s - 0 interactions
  Progress: 10s - 0 interactions
  Progress: 10s - 0 interactions
  Progress: 10s - 0 interactions
  Progress: 10s - 0 interactions
  Progress: 10s - 0 interactions
  Progress: 20s - 0 interactions
  Progress: 20s - 0 interactions
  Progress: 20s - 0 interactions
  Progress: 20s - 0 interactions
  Progress: 20s - 0 interactions
  Progress: 20s - 0 interactions
  Progress: 20s - 0 interactions
  Progress: 30s - 0 interactions
  Progress: 30s - 0 interactions
  Progress: 30s - 0 interactions
  Progress: 30s - 0 interactions
  Progress: 30s - 0 interactions
  Progress: 30s - 0 interactions
  Progress: 30s - 0 interactions
  Progress: 40s - 0 interactions
  Progress: 40s - 0 interactions
  Progress: 40s - 0 interactions
  Progress: 40s - 0 interactions
  Progress: 40s - 0 interactions
  Progress: 40s - 0 interactions
  Progress: 40s - 0 interactions
  Progress: 50s - 0 interactions
  Progress: 50s - 0 interactions
  Progress: 50s - 0 interactions
  Progress: 50s - 0 interactions
  Progress: 50s - 0 interactions
  Progress: 50s - 0 interactions
  Progress: 60s - 0 interactions

Results:
  Duration: 60.09s
  Total Interactions: 0
  Throughput: 0.00 req/s
  Errors: 4097
  Error Rate: 101.92%
  Avg Latency: 31.04ms
  P50 Latency: 30.51ms
  P95 Latency: 44.20ms
  P99 Latency: 48.46ms
[31m[1m__________________________ test_stress_test_200_npcs ___________________________[0m
[1m[31mtests/performance/test_npc_load.py[0m:318: in test_stress_test_200_npcs
    assert stats['npc_registrations'] >= 180, "At least 90% of NPCs should register successfully"
[1m[31mE   AssertionError: At least 90% of NPCs should register successfully[0m
[1m[31mE   assert 0 >= 180[0m
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: Stress Test - 200 NPCs
================================================================================

Registering 200 NPCs...
Failed to register NPC stress_test_npc_001: 429
Failed to register NPC stress_test_npc_002: 429
Failed to register NPC stress_test_npc_003: 429
Failed to register NPC stress_test_npc_004: 429
Failed to register NPC stress_test_npc_007: 429
Failed to register NPC stress_test_npc_006: 429
Failed to register NPC stress_test_npc_005: 429
Failed to register NPC stress_test_npc_010: 429
Failed to register NPC stress_test_npc_011: 429
Failed to register NPC stress_test_npc_009: 429
Failed to register NPC stress_test_npc_008: 429
Failed to register NPC stress_test_npc_018: 429
Failed to register NPC stress_test_npc_015: 429
Failed to register NPC stress_test_npc_013: 429
Failed to register NPC stress_test_npc_020: 429
Failed to register NPC stress_test_npc_035: 429
Failed to register NPC stress_test_npc_017: 429
Failed to register NPC stress_test_npc_030: 429
Failed to register NPC stress_test_npc_021: 429
Failed to register NPC stress_test_npc_032: 429
Failed to register NPC stress_test_npc_023: 429
Failed to register NPC stress_test_npc_022: 429
Failed to register NPC stress_test_npc_014: 429
Failed to register NPC stress_test_npc_016: 429
Failed to register NPC stress_test_npc_024: 429
Failed to register NPC stress_test_npc_012: 429
Failed to register NPC stress_test_npc_019: 429
Failed to register NPC stress_test_npc_025: 429
Failed to register NPC stress_test_npc_036: 429
Failed to register NPC stress_test_npc_031: 429
Failed to register NPC stress_test_npc_029: 429
Failed to register NPC stress_test_npc_033: 429
Failed to register NPC stress_test_npc_027: 429
Failed to register NPC stress_test_npc_026: 429
Failed to register NPC stress_test_npc_037: 429
Failed to register NPC stress_test_npc_050: 429
Failed to register NPC stress_test_npc_044: 429
Failed to register NPC stress_test_npc_048: 429
Failed to register NPC stress_test_npc_039: 429
Failed to register NPC stress_test_npc_045: 429
Failed to register NPC stress_test_npc_042: 429
Failed to register NPC stress_test_npc_047: 429
Failed to register NPC stress_test_npc_046: 429
Failed to register NPC stress_test_npc_043: 429
Failed to register NPC stress_test_npc_034: 429
Failed to register NPC stress_test_npc_049: 429
Failed to register NPC stress_test_npc_041: 429
Failed to register NPC stress_test_npc_038: 429
Failed to register NPC stress_test_npc_040: 429
Failed to register NPC stress_test_npc_028: 429
  Registered batch 1/4: 50 NPCs
Failed to register NPC stress_test_npc_051: 429
Failed to register NPC stress_test_npc_052: 429
Failed to register NPC stress_test_npc_055: 429
Failed to register NPC stress_test_npc_057: 429
Failed to register NPC stress_test_npc_053: 429
Failed to register NPC stress_test_npc_059: 429
Failed to register NPC stress_test_npc_056: 429
Failed to register NPC stress_test_npc_062: 429
Failed to register NPC stress_test_npc_054: 429
Failed to register NPC stress_test_npc_064: 429
Failed to register NPC stress_test_npc_066: 429
Failed to register NPC stress_test_npc_065: 429
Failed to register NPC stress_test_npc_069: 429
Failed to register NPC stress_test_npc_061: 429
Failed to register NPC stress_test_npc_063: 429
Failed to register NPC stress_test_npc_073: 429
Failed to register NPC stress_test_npc_072: 429
Failed to register NPC stress_test_npc_071: 429
Failed to register NPC stress_test_npc_077: 429
Failed to register NPC stress_test_npc_075: 429
Failed to register NPC stress_test_npc_080: 429
Failed to register NPC stress_test_npc_067: 429
Failed to register NPC stress_test_npc_081: 429
Failed to register NPC stress_test_npc_084: 429
Failed to register NPC stress_test_npc_070: 429
Failed to register NPC stress_test_npc_087: 429
Failed to register NPC stress_test_npc_079: 429
Failed to register NPC stress_test_npc_074: 429
Failed to register NPC stress_test_npc_088: 429
Failed to register NPC stress_test_npc_089: 429
Failed to register NPC stress_test_npc_094: 429
Failed to register NPC stress_test_npc_091: 429
Failed to register NPC stress_test_npc_095: 429
Failed to register NPC stress_test_npc_076: 429
Failed to register NPC stress_test_npc_082: 429
Failed to register NPC stress_test_npc_098: 429
Failed to register NPC stress_test_npc_058: 429
Failed to register NPC stress_test_npc_083: 429
Failed to register NPC stress_test_npc_060: 429
Failed to register NPC stress_test_npc_099: 429
Failed to register NPC stress_test_npc_085: 429
Failed to register NPC stress_test_npc_096: 429
Failed to register NPC stress_test_npc_097: 429
Failed to register NPC stress_test_npc_090: 429
Failed to register NPC stress_test_npc_093: 429
Failed to register NPC stress_test_npc_078: 429
Failed to register NPC stress_test_npc_100: 429
Failed to register NPC stress_test_npc_068: 429
Failed to register NPC stress_test_npc_092: 429
Failed to register NPC stress_test_npc_086: 429
  Registered batch 2/4: 50 NPCs
Failed to register NPC stress_test_npc_101: 429
Failed to register NPC stress_test_npc_102: 429
Failed to register NPC stress_test_npc_105: 429
Failed to register NPC stress_test_npc_107: 429
Failed to register NPC stress_test_npc_103: 429
Failed to register NPC stress_test_npc_109: 429
Failed to register NPC stress_test_npc_106: 429
Failed to register NPC stress_test_npc_112: 429
Failed to register NPC stress_test_npc_104: 429
Failed to register NPC stress_test_npc_114: 429
Failed to register NPC stress_test_npc_116: 429
Failed to register NPC stress_test_npc_115: 429
Failed to register NPC stress_test_npc_119: 429
Failed to register NPC stress_test_npc_111: 429
Failed to register NPC stress_test_npc_113: 429
Failed to register NPC stress_test_npc_123: 429
Failed to register NPC stress_test_npc_122: 429
Failed to register NPC stress_test_npc_121: 429
Failed to register NPC stress_test_npc_127: 429
Failed to register NPC stress_test_npc_125: 429
Failed to register NPC stress_test_npc_130: 429
Failed to register NPC stress_test_npc_117: 429
Failed to register NPC stress_test_npc_131: 429
Failed to register NPC stress_test_npc_134: 429
Failed to register NPC stress_test_npc_120: 429
Failed to register NPC stress_test_npc_137: 429
Failed to register NPC stress_test_npc_129: 429
Failed to register NPC stress_test_npc_124: 429
Failed to register NPC stress_test_npc_138: 429
Failed to register NPC stress_test_npc_139: 429
Failed to register NPC stress_test_npc_144: 429
Failed to register NPC stress_test_npc_141: 429
Failed to register NPC stress_test_npc_145: 429
Failed to register NPC stress_test_npc_126: 429
Failed to register NPC stress_test_npc_132: 429
Failed to register NPC stress_test_npc_148: 429
Failed to register NPC stress_test_npc_108: 429
Failed to register NPC stress_test_npc_133: 429
Failed to register NPC stress_test_npc_110: 429
Failed to register NPC stress_test_npc_149: 429
Failed to register NPC stress_test_npc_135: 429
Failed to register NPC stress_test_npc_146: 429
Failed to register NPC stress_test_npc_147: 429
Failed to register NPC stress_test_npc_140: 429
Failed to register NPC stress_test_npc_143: 429
Failed to register NPC stress_test_npc_128: 429
Failed to register NPC stress_test_npc_150: 429
Failed to register NPC stress_test_npc_118: 429
Failed to register NPC stress_test_npc_142: 429
Failed to register NPC stress_test_npc_136: 429
  Registered batch 3/4: 50 NPCs
Failed to register NPC stress_test_npc_151: 429
Failed to register NPC stress_test_npc_152: 429
Failed to register NPC stress_test_npc_155: 429
Failed to register NPC stress_test_npc_157: 429
Failed to register NPC stress_test_npc_153: 429
Failed to register NPC stress_test_npc_159: 429
Failed to register NPC stress_test_npc_156: 429
Failed to register NPC stress_test_npc_162: 429
Failed to register NPC stress_test_npc_154: 429
Failed to register NPC stress_test_npc_164: 429
Failed to register NPC stress_test_npc_166: 429
Failed to register NPC stress_test_npc_165: 429
Failed to register NPC stress_test_npc_169: 429
Failed to register NPC stress_test_npc_161: 429
Failed to register NPC stress_test_npc_163: 429
Failed to register NPC stress_test_npc_173: 429
Failed to register NPC stress_test_npc_172: 429
Failed to register NPC stress_test_npc_171: 429
Failed to register NPC stress_test_npc_177: 429
Failed to register NPC stress_test_npc_175: 429
Failed to register NPC stress_test_npc_180: 429
Failed to register NPC stress_test_npc_167: 429
Failed to register NPC stress_test_npc_181: 429
Failed to register NPC stress_test_npc_184: 429
Failed to register NPC stress_test_npc_170: 429
Failed to register NPC stress_test_npc_187: 429
Failed to register NPC stress_test_npc_179: 429
Failed to register NPC stress_test_npc_174: 429
Failed to register NPC stress_test_npc_188: 429
Failed to register NPC stress_test_npc_189: 429
Failed to register NPC stress_test_npc_194: 429
Failed to register NPC stress_test_npc_191: 429
Failed to register NPC stress_test_npc_195: 429
Failed to register NPC stress_test_npc_176: 429
Failed to register NPC stress_test_npc_182: 429
Failed to register NPC stress_test_npc_198: 429
Failed to register NPC stress_test_npc_158: 429
Failed to register NPC stress_test_npc_183: 429
Failed to register NPC stress_test_npc_160: 429
Failed to register NPC stress_test_npc_199: 429
Failed to register NPC stress_test_npc_185: 429
Failed to register NPC stress_test_npc_196: 429
Failed to register NPC stress_test_npc_197: 429
Failed to register NPC stress_test_npc_190: 429
Failed to register NPC stress_test_npc_193: 429
Failed to register NPC stress_test_npc_178: 429
Failed to register NPC stress_test_npc_200: 429
Failed to register NPC stress_test_npc_168: 429
Failed to register NPC stress_test_npc_192: 429
Failed to register NPC stress_test_npc_186: 429
  Registered batch 4/4: 50 NPCs

Results:
  Total NPCs: 0
  Errors: 200
  Error Rate: 100.00%
  Avg Latency: 191.76ms
  P95 Latency: 307.87ms
[31m[1m______________________ TestDatabase.test_connect_success _______________________[0m
[1m[31m/usr/lib/python3.12/unittest/mock.py[0m:923: in assert_called_once
    raise AssertionError(msg)
[1m[31mE   AssertionError: Expected 'from_url' to have been called once. Called 0 times.[0m

[33mDuring handling of the above exception, another exception occurred:[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_database.py[0m:33: in test_connect_success
    mock_from_url.assert_called_once()
[1m[31mE   AssertionError: Expected 'from_url' to have been called once. Called 0 times.[0m
----------------------------- Captured stderr call -----------------------------
2025-11-09 00:10:53.453 | INFO     | database:connect:260 - Connecting to DragonflyDB at localhost:6379 (attempt 1/1)
2025-11-09 00:10:53.467 | INFO     | database:connect:278 - âœ“ Successfully connected to DragonflyDB
2025-11-09 00:10:53.562 | INFO     | database:connect:282 - DragonflyDB version: 7.4.0
2025-11-09 00:10:53.562 | INFO     | database:connect:283 - Connected clients: 53
[31m[1m____________________ TestDatabase.test_connect_retry_logic _____________________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_database.py[0m:51: in test_connect_retry_logic
    assert mock_from_url.call_count == 3
[1m[31mE   AssertionError: assert 0 == 3[0m
[1m[31mE    +  where 0 = <MagicMock name='from_url' id='131879703188432'>.call_count[0m
----------------------------- Captured stderr call -----------------------------
2025-11-09 00:10:53.667 | INFO     | database:connect:260 - Connecting to DragonflyDB at localhost:6379 (attempt 1/3)
2025-11-09 00:10:53.669 | INFO     | database:connect:278 - âœ“ Successfully connected to DragonflyDB
2025-11-09 00:10:53.676 | INFO     | database:connect:282 - DragonflyDB version: 7.4.0
2025-11-09 00:10:53.676 | INFO     | database:connect:283 - Connected clients: 54
[31m[1m________________ TestDatabase.test_connect_max_retries_exceeded ________________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_database.py[0m:61: in test_connect_max_retries_exceeded
    with pytest.raises(ConnectionError):
[1m[31mE   Failed: DID NOT RAISE <class 'ConnectionError'>[0m
----------------------------- Captured stderr call -----------------------------
2025-11-09 00:10:53.688 | INFO     | database:connect:260 - Connecting to DragonflyDB at localhost:6379 (attempt 1/2)
2025-11-09 00:10:53.691 | INFO     | database:connect:278 - âœ“ Successfully connected to DragonflyDB
2025-11-09 00:10:53.698 | INFO     | database:connect:282 - DragonflyDB version: 7.4.0
2025-11-09 00:10:53.699 | INFO     | database:connect:283 - Connected clients: 55
[31m[1m_________________________ TestDatabase.test_disconnect _________________________[0m
[1m[31m/usr/lib/python3.12/unittest/mock.py[0m:923: in assert_called_once
    raise AssertionError(msg)
[1m[31mE   AssertionError: Expected 'wait_closed' to have been called once. Called 0 times.[0m

[33mDuring handling of the above exception, another exception occurred:[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_database.py[0m:73: in test_disconnect
    db.client.wait_closed.assert_called_once()
[1m[31mE   AssertionError: Expected 'wait_closed' to have been called once. Called 0 times.[0m
----------------------------- Captured stderr call -----------------------------
2025-11-09 00:10:53.713 | INFO     | database:disconnect:305 - Disconnected from DragonflyDB
[31m[1m_____________________ TestDatabase.test_get_player_memory ______________________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_database.py[0m:119: in test_get_player_memory
    memories = await db.get_player_memory("player_001", "npc_001")
[1m[31mE   AttributeError: 'Database' object has no attribute 'get_player_memory'[0m
[31m[1m_____________________ TestDatabase.test_add_player_memory ______________________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_database.py[0m:136: in test_add_player_memory
    await db.add_player_memory("player_001", "npc_001", memory)
[1m[31mE   AttributeError: 'Database' object has no attribute 'add_player_memory'[0m
[31m[1m______________________ TestDatabase.test_rate_limit_check ______________________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_database.py[0m:148: in test_rate_limit_check
    is_limited = await db.check_rate_limit("player_001", "action_type", 60)
[1m[31mE   AttributeError: 'Database' object has no attribute 'check_rate_limit'[0m
[31m[1m_______________________ TestDatabase.test_set_rate_limit _______________________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_database.py[0m:163: in test_set_rate_limit
    await db.set_rate_limit("player_001", "action_type", 60)
[1m[31mE   AttributeError: 'Database' object has no attribute 'set_rate_limit'[0m
[31m[1m______________________ TestDatabase.test_quest_operations ______________________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_database.py[0m:180: in test_quest_operations
    await db.create_quest(quest_data)
[1m[31mE   AttributeError: 'Database' object has no attribute 'create_quest'. Did you mean: 'delete_quest'?[0m
[31m[1m___________ TestDatabaseErrorHandling.test_connection_error_handling ___________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_database.py[0m:207: in test_connection_error_handling
    with pytest.raises(ConnectionError):
[1m[31mE   Failed: DID NOT RAISE <class 'ConnectionError'>[0m
----------------------------- Captured stderr call -----------------------------
2025-11-09 00:10:53.944 | INFO     | database:connect:260 - Connecting to DragonflyDB at localhost:6379 (attempt 1/1)
2025-11-09 00:10:53.947 | INFO     | database:connect:278 - âœ“ Successfully connected to DragonflyDB
2025-11-09 00:10:54.343 | INFO     | database:connect:282 - DragonflyDB version: 7.4.0
2025-11-09 00:10:54.343 | INFO     | database:connect:283 - Connected clients: 53
[31m[1m____________ TestDatabaseErrorHandling.test_timeout_error_handling _____________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_database.py[0m:218: in test_timeout_error_handling
    with pytest.raises(TimeoutError):
[1m[31mE   Failed: DID NOT RAISE <class 'TimeoutError'>[0m
----------------------------- Captured stderr call -----------------------------
2025-11-09 00:10:54.358 | INFO     | database:connect:260 - Connecting to DragonflyDB at localhost:6379 (attempt 1/1)
2025-11-09 00:10:54.360 | INFO     | database:connect:278 - âœ“ Successfully connected to DragonflyDB
2025-11-09 00:10:54.376 | INFO     | database:connect:282 - DragonflyDB version: 7.4.0
2025-11-09 00:10:54.376 | INFO     | database:connect:283 - Connected clients: 54
[31m[1m__________________ TestModuleImports.test_llm_factory_import ___________________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_integration.py[0m:31: in test_llm_factory_import
    from llm.factory import LLMProviderFactory
[1m[31mllm/__init__.py[0m:6: in <module>
    from .factory import LLMProviderFactory, get_llm_provider
[1m[31mllm/factory.py[0m:9: in <module>
    from .providers.openai_provider import OpenAIProvider
[1m[31mllm/providers/__init__.py[0m:5: in <module>
    from .openai_provider import OpenAIProvider
[1m[31mllm/providers/openai_provider.py[0m:6: in <module>
    from openai import AsyncOpenAI
[1m[31mE   ModuleNotFoundError: No module named 'openai'[0m
[31m[1m_________________ TestModuleImports.test_azure_provider_import _________________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_integration.py[0m:42: in test_azure_provider_import
    from llm.providers.azure_openai_provider import AzureOpenAIProvider
[1m[31mllm/__init__.py[0m:6: in <module>
    from .factory import LLMProviderFactory, get_llm_provider
[1m[31mllm/factory.py[0m:9: in <module>
    from .providers.openai_provider import OpenAIProvider
[1m[31mllm/providers/__init__.py[0m:5: in <module>
    from .openai_provider import OpenAIProvider
[1m[31mllm/providers/openai_provider.py[0m:6: in <module>
    from openai import AsyncOpenAI
[1m[31mE   ModuleNotFoundError: No module named 'openai'[0m
[31m[1m_____________________ TestModuleImports.test_agents_import _____________________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_integration.py[0m:47: in test_agents_import
    from agents.dialogue_agent import DialogueAgent
[1m[31magents/__init__.py[0m:6: in <module>
    from .base_agent import BaseAIAgent, AgentContext, AgentResponse
[1m[31magents/base_agent.py[0m:12: in <module>
    from crewai import Agent
[1m[31mE   ModuleNotFoundError: No module named 'crewai'[0m
[31m[1m____________________ TestModuleImports.test_main_app_import ____________________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_integration.py[0m:57: in test_main_app_import
    from main import app
[1m[31mmain.py[0m:20: in <module>
    from ai_service.routers import npc_router, world_router, player_router
[1m[31m../ai_service/routers/__init__.py[0m:7: in <module>
    from .player import router as player_router
[1m[31m../ai_service/routers/player.py[0m:16: in <module>
    from ..llm import get_llm_provider
[1m[31m../ai_service/llm/__init__.py[0m:6: in <module>
    from .factory import LLMProviderFactory, get_llm_provider
[1m[31m../ai_service/llm/factory.py[0m:9: in <module>
    from .providers.openai_provider import OpenAIProvider
[1m[31m../ai_service/llm/providers/__init__.py[0m:5: in <module>
    from .openai_provider import OpenAIProvider
[1m[31m../ai_service/llm/providers/openai_provider.py[0m:6: in <module>
    from openai import AsyncOpenAI
[1m[31mE   ModuleNotFoundError: No module named 'openai'[0m
----------------------------- Captured stderr call -----------------------------
2025-11-09 00:10:56.088 | INFO     | ai_service.config:load_yaml_config:712 - Loaded configuration from /ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/config/ai-service-config.yaml
2025-11-09 00:10:56.197 | INFO     | ai_service.config:get_settings:741 - Settings loaded: ai-service on 0.0.0.0:8000
2025-11-09 00:10:56.197 | INFO     | ai_service.config:get_settings:742 - Environment: development, Debug: True
2025-11-09 00:10:56.197 | INFO     | ai_service.config:get_settings:743 - Default LLM Provider: azure_openai
2025-11-09 00:10:56.197 | INFO     | ai_service.config:get_settings:744 - DragonflyDB (cache): localhost:6379
2025-11-09 00:10:56.197 | INFO     | ai_service.config:get_settings:745 - PostgreSQL (persistent memory): localhost:5432/ai_world_memory
2025-11-09 00:10:56.197 | INFO     | ai_service.config:get_settings:748 - ================================================================================
2025-11-09 00:10:56.197 | INFO     | ai_service.config:get_settings:749 - AUTONOMOUS FEATURES CONFIGURATION
2025-11-09 00:10:56.197 | INFO     | ai_service.config:get_settings:750 - ================================================================================
2025-11-09 00:10:56.197 | INFO     | ai_service.config:get_settings:753 - NPC Movement: Enabled=True
2025-11-09 00:10:56.197 | INFO     | ai_service.config:get_settings:755 -   - Mode: event_driven
2025-11-09 00:10:56.197 | INFO     | ai_service.config:get_settings:756 -   - Update Interval: 60s (for fixed_interval mode)
2025-11-09 00:10:56.197 | INFO     | ai_service.config:get_settings:757 -   - Idle Timeout: 60s (for event_driven mode)
2025-11-09 00:10:56.198 | INFO     | ai_service.config:get_settings:758 -   - Chain Movement: True
2025-11-09 00:10:56.198 | INFO     | ai_service.config:get_settings:759 -   - Adaptive Behavior: True
2025-11-09 00:10:56.198 | INFO     | ai_service.config:get_settings:760 -   - Max Distance: 10 cells
2025-11-09 00:10:56.198 | INFO     | ai_service.config:get_settings:761 -   - Advanced Features: Pathfinding=False, Social=False, Collision=False
2025-11-09 00:10:56.198 | INFO     | ai_service.config:get_settings:766 - Economic Simulation: Enabled=True
2025-11-09 00:10:56.198 | INFO     | ai_service.config:get_settings:768 -   - Mode: daily
2025-11-09 00:10:56.198 | INFO     | ai_service.config:get_settings:769 -   - Update Interval: 86400s
2025-11-09 00:10:56.198 | INFO     | ai_service.config:get_settings:770 -   - Adaptive Pricing: True
2025-11-09 00:10:56.198 | INFO     | ai_service.config:get_settings:771 -   - Learning Enabled: True
2025-11-09 00:10:56.198 | INFO     | ai_service.config:get_settings:772 -   - Features: Inflation=True, Supply/Demand=True, Events=True
2025-11-09 00:10:56.198 | INFO     | ai_service.config:get_settings:777 - Shop Restocking: Enabled=True
2025-11-09 00:10:56.198 | INFO     | ai_service.config:get_settings:779 -   - Mode: npc_driven
2025-11-09 00:10:56.198 | INFO     | ai_service.config:get_settings:780 -   - Check Interval: 86400s
2025-11-09 00:10:56.198 | INFO     | ai_service.config:get_settings:781 -   - NPC Learning: True
2025-11-09 00:10:56.199 | INFO     | ai_service.config:get_settings:782 -   - Default Restock Interval: 3600s
2025-11-09 00:10:56.199 | INFO     | ai_service.config:get_settings:785 - Faction System: Enabled=True
2025-11-09 00:10:56.199 | INFO     | ai_service.config:get_settings:787 -   - Reputation Decay: True
2025-11-09 00:10:56.199 | INFO     | ai_service.config:get_settings:788 -   - Decay Interval: 604800s
2025-11-09 00:10:56.199 | INFO     | ai_service.config:get_settings:789 -   - Dynamic Relationships: True
2025-11-09 00:10:56.199 | INFO     | ai_service.config:get_settings:792 - Agent Learning: Enabled=True
2025-11-09 00:10:56.199 | INFO     | ai_service.config:get_settings:794 -   - Memory Retention: 30 days
2025-11-09 00:10:56.199 | INFO     | ai_service.config:get_settings:795 -   - Decision Logging: True
2025-11-09 00:10:56.199 | INFO     | ai_service.config:get_settings:796 -   - Context Window: 10 decisions
2025-11-09 00:10:56.199 | INFO     | ai_service.config:get_settings:799 - NPC-to-NPC Interactions: Enabled=True
2025-11-09 00:10:56.199 | INFO     | ai_service.config:get_settings:801 -   - Interaction Range: 5 cells
2025-11-09 00:10:56.199 | INFO     | ai_service.config:get_settings:802 -   - Relationship Tracking: True
2025-11-09 00:10:56.199 | INFO     | ai_service.config:get_settings:803 -   - Information Sharing: True
2025-11-09 00:10:56.199 | INFO     | ai_service.config:get_settings:804 -   - Proximity Check Interval: 30s
2025-11-09 00:10:56.200 | INFO     | ai_service.config:get_settings:805 -   - Relationship Decay Rate: 0.01/day
2025-11-09 00:10:56.200 | INFO     | ai_service.config:get_settings:808 - Instant Response System: Enabled=True
2025-11-09 00:10:56.200 | INFO     | ai_service.config:get_settings:810 -   - Instant Events: combat, urgent_quest, special_event, player_death, boss_spawn
2025-11-09 00:10:56.200 | INFO     | ai_service.config:get_settings:811 -   - Max Concurrent: 10
2025-11-09 00:10:56.200 | INFO     | ai_service.config:get_settings:814 - Universal Consciousness: Enabled=True
2025-11-09 00:10:56.200 | INFO     | ai_service.config:get_settings:816 -   - Reasoning Depth: deep
2025-11-09 00:10:56.200 | INFO     | ai_service.config:get_settings:817 -   - History Days: 7
2025-11-09 00:10:56.200 | INFO     | ai_service.config:get_settings:818 -   - Future Planning: True
2025-11-09 00:10:56.200 | INFO     | ai_service.config:get_settings:820 -     - Planning Steps: 3
2025-11-09 00:10:56.200 | INFO     | ai_service.config:get_settings:821 -   - Reasoning Chain Logging: True
2025-11-09 00:10:56.200 | INFO     | ai_service.config:get_settings:822 -   - World Consciousness: True
2025-11-09 00:10:56.200 | INFO     | ai_service.config:get_settings:825 - LLM Optimization Mode: balanced
2025-11-09 00:10:56.200 | INFO     | ai_service.config:get_settings:826 -   - Decision Cache: True
2025-11-09 00:10:56.200 | INFO     | ai_service.config:get_settings:828 -     - Cache TTL: 3600s
2025-11-09 00:10:56.201 | INFO     | ai_service.config:get_settings:829 -     - Similarity Threshold: 0.85
2025-11-09 00:10:56.201 | INFO     | ai_service.config:get_settings:830 -   - Decision Batching: True
2025-11-09 00:10:56.201 | INFO     | ai_service.config:get_settings:832 -     - Batch Size: 5
2025-11-09 00:10:56.201 | INFO     | ai_service.config:get_settings:833 -     - Batch Timeout: 2.0s
2025-11-09 00:10:56.201 | INFO     | ai_service.config:get_settings:834 -   - Pre-filtering: True
2025-11-09 00:10:56.201 | INFO     | ai_service.config:get_settings:835 -   - Rule-Based Decisions: True
2025-11-09 00:10:56.201 | INFO     | ai_service.config:get_settings:836 -   - Complexity Threshold: 0.5
2025-11-09 00:10:56.201 | INFO     | ai_service.config:get_settings:838 - ================================================================================
2025-11-09 00:10:56.201 | INFO     | ai_service.config:get_settings:841 - Free-Form Text Input: Enabled=True
2025-11-09 00:10:56.201 | INFO     | ai_service.config:get_settings:843 -   - Mode: chat_command
2025-11-09 00:10:56.201 | INFO     | ai_service.config:get_settings:844 -   - Max Length: 500 chars
2025-11-09 00:10:56.201 | INFO     | ai_service.config:get_settings:845 -   - Rate Limiting: True
2025-11-09 00:10:56.201 | INFO     | ai_service.config:get_settings:846 -   - Response Timeout: 30s
2025-11-09 00:10:56.202 | INFO     | ai_service.config:get_settings:849 - Chat Command Interface: Enabled=True
2025-11-09 00:10:56.202 | INFO     | ai_service.config:get_settings:851 -   - Prefix: @npc
2025-11-09 00:10:56.202 | INFO     | ai_service.config:get_settings:852 -   - Cooldown: 2s
2025-11-09 00:10:56.202 | INFO     | ai_service.config:get_settings:853 -   - Proximity Required: True
2025-11-09 00:10:56.202 | INFO     | ai_service.config:get_settings:856 - GPU Acceleration: Enabled=False
[31m[1m_____________ TestLLMProviders.test_azure_provider_initialization ______________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_integration.py[0m:131: in test_azure_provider_initialization
    from llm.providers.azure_openai_provider import AzureOpenAIProvider
[1m[31mllm/__init__.py[0m:6: in <module>
    from .factory import LLMProviderFactory, get_llm_provider
[1m[31mllm/factory.py[0m:9: in <module>
    from .providers.openai_provider import OpenAIProvider
[1m[31mllm/providers/__init__.py[0m:5: in <module>
    from .openai_provider import OpenAIProvider
[1m[31mllm/providers/openai_provider.py[0m:6: in <module>
    from openai import AsyncOpenAI
[1m[31mE   ModuleNotFoundError: No module named 'openai'[0m
[31m[1m________________ TestAgents.test_dialogue_agent_initialization _________________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_integration.py[0m:168: in test_dialogue_agent_initialization
    from agents.dialogue_agent import DialogueAgent
[1m[31magents/__init__.py[0m:6: in <module>
    from .base_agent import BaseAIAgent, AgentContext, AgentResponse
[1m[31magents/base_agent.py[0m:12: in <module>
    from crewai import Agent
[1m[31mE   ModuleNotFoundError: No module named 'crewai'[0m
[31m[1m________________ TestAgents.test_decision_agent_initialization _________________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_integration.py[0m:184: in test_decision_agent_initialization
    from agents.decision_agent import DecisionAgent
[1m[31magents/__init__.py[0m:6: in <module>
    from .base_agent import BaseAIAgent, AgentContext, AgentResponse
[1m[31magents/base_agent.py[0m:12: in <module>
    from crewai import Agent
[1m[31mE   ModuleNotFoundError: No module named 'crewai'[0m
[31m[1m__________ TestDatabasePerformance.test_memory_retrieval_performance ___________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_performance.py[0m:59: in test_memory_retrieval_performance
    result = await db.get_player_memory("player_001", "npc_001")
[1m[31mE   AttributeError: 'Database' object has no attribute 'get_player_memory'[0m
[31m[1m_____________ TestAgentPerformance.test_dialogue_agent_performance _____________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_performance.py[0m:140: in test_dialogue_agent_performance
    from agents.dialogue_agent import DialogueAgent
[1m[31magents/__init__.py[0m:6: in <module>
    from .base_agent import BaseAIAgent, AgentContext, AgentResponse
[1m[31magents/base_agent.py[0m:12: in <module>
    from crewai import Agent
[1m[31mE   ModuleNotFoundError: No module named 'crewai'[0m
[31m[1m______________ TestAgentPerformance.test_orchestrator_performance ______________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_performance.py[0m:177: in test_orchestrator_performance
    from agents.orchestrator import AgentOrchestrator
[1m[31magents/__init__.py[0m:6: in <module>
    from .base_agent import BaseAIAgent, AgentContext, AgentResponse
[1m[31magents/base_agent.py[0m:12: in <module>
    from crewai import Agent
[1m[31mE   ModuleNotFoundError: No module named 'crewai'[0m
[31m[1m___________ TestEndToEndPerformance.test_player_interaction_latency ____________[0m
[1m[31m/home/lot399/ai-mmorpg-world/rathena-AI-world/ai-autonomous-world/ai-service/tests/test_performance.py[0m:216: in test_player_interaction_latency
    from agents.orchestrator import AgentOrchestrator
[1m[31magents/__init__.py[0m:6: in <module>
    from .base_agent import BaseAIAgent, AgentContext, AgentResponse
[1m[31magents/base_agent.py[0m:12: in <module>
    from crewai import Agent
[1m[31mE   ModuleNotFoundError: No module named 'crewai'[0m
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                     Stmts   Miss  Cover   Missing
----------------------------------------------------------------------
__init__.py                                  1      0   100%
agents/__init__.py                           2      1    50%   8
agents/base_agent.py                        75     69     8%   13-186
agents/decision_agent.py                   136    136     0%   6-419
agents/decision_optimizer.py               162    162     0%   6-396
agents/dialogue_agent.py                   120    120     0%   7-303
agents/economy_agent.py                    160    160     0%   5-438
agents/memory_agent.py                     120    120     0%   6-340
agents/orchestrator.py                     102    102     0%   6-378
agents/quest_agent.py                      117    117     0%   5-422
agents/universal_consciousness.py          198    198     0%   7-522
agents/world_agent.py                      166    166     0%   6-431
config.py                                  405     24    94%   89, 94, 595, 603, 611, 620, 629, 637, 646, 655, 664, 676, 706-707, 714-716, 858-866
database.py                                350    273    22%   37-87, 91-97, 101-103, 107-117, 130-154, 167-189, 202-223, 227, 240, 252, 254, 287-298, 308-311, 315-317, 321-328, 333-346, 350-370, 374-379, 383-399, 408-410, 418-420, 424-430, 435-441, 445-451, 456-463, 467-480, 484-500, 504-515, 519-529, 533-552
llm/__init__.py                              3      1    67%   8
llm/base.py                                 39     15    62%   32-34, 58, 80, 102, 106, 110, 114, 123-132
llm/factory.py                              68     64     6%   10-180
llm/gpu_wrapper.py                          64     64     0%   6-172
llm/providers/__init__.py                    5      4    20%   6-10
llm/providers/anthropic_provider.py         60     60     0%   5-146
llm/providers/azure_openai_provider.py     121    121     0%   6-250
llm/providers/deepseek_provider.py          59     59     0%   6-142
llm/providers/google_provider.py            71     71     0%   5-165
llm/providers/openai_provider.py            51     49     4%   7-126
main.py                                    237    225     5%   21-410
middleware/__init__.py                       4      4     0%   5-9
middleware/auth.py                          25     25     0%   5-70
middleware/rate_limit.py                    38     38     0%   5-104
middleware/request_size.py                  18     18     0%   5-47
models/__init__.py                           4      0   100%
models/economy.py                           99     99     0%   5-144
models/faction.py                           98     98     0%   5-163
models/npc.py                               67      0   100%
models/npc_relationship.py                  75     75     0%   6-149
models/player.py                            32      0   100%
models/quest.py                            100    100     0%   5-157
models/world.py                             38      0   100%
routers/__init__.py                          4      1    75%   9
routers/batch.py                            77     77     0%   6-183
routers/chat_command.py                    126    126     0%   6-315
routers/economy.py                         138    138     0%   6-372
routers/faction.py                         118    118     0%   6-299
routers/npc.py                             200    172    14%   22-32, 44-123, 136-175, 188-246, 269-331, 345-394, 408-446, 460-491, 511-546, 560-620
routers/player.py                           69     62    10%   17-190
routers/pubsub_bridge.py                    55     55     0%   7-158
routers/quest.py                           110    110     0%   5-292
routers/world.py                            85     66    22%   30-53, 68-123, 134-141, 152-163, 177-188, 208-221
scheduler.py                               191    191     0%   6-369
tasks/__init__.py                            0      0   100%
tasks/economy.py                           220    220     0%   6-571
tasks/environment.py                       233     32    86%   55-57, 75, 109-110, 139-140, 169-170, 198, 227-228, 266-267, 345-346, 352, 363-368, 378-379, 411-412, 433-434, 454-456
tasks/faction.py                           205    205     0%   6-461
tasks/instant_response.py                  110    110     0%   6-211
tasks/npc_movement.py                      256    256     0%   7-609
tasks/npc_relationships.py                 240    240     0%   6-657
tasks/shop_restock.py                      210    210     0%   6-491
test_remediation.py                        155    155     0%   7-234
tests/__init__.py                            0      0   100%
tests/conftest.py                           62     13    79%   89, 107, 119, 132-135, 149-158
tests/locustfile.py                         76     76     0%   7-222
tests/performance/__init__.py                0      0   100%
tests/performance/locustfile.py             56     56     0%   16-171
tests/performance/test_benchmarks.py        94     94     0%   9-183
tests/performance/test_npc_load.py         198     25    87%   69-72, 104-105, 116, 164-165, 216-217, 284-285, 319, 324-337
tests/test_agents.py                        83     83     0%   5-238
tests/test_config.py                        96      3    97%   61-63, 74
tests/test_database.py                     115     15    87%   121-122, 138, 149-155, 165, 181-193
tests/test_environment.py                  288      0   100%
tests/test_integration.py                   98     25    74%   32, 43, 48-53, 58, 133-144, 169-180, 185-196
tests/test_llm_providers.py                100    100     0%   5-220
tests/test_performance.py                  111     41    63%   61-65, 141-172, 178-207, 217-257
tests/test_routers.py                       84     84     0%   5-220
utils/__init__.py                           37     37     0%   5-61
utils/advanced_movement.py                 124    124     0%   6-379
utils/batch_processor.py                    69     69     0%   7-179
utils/bridge_commands.py                    43     43     0%   6-170
utils/cache.py                              67     67     0%   7-161
utils/decorators.py                         78     78     0%   5-171
utils/gpu_manager.py                       213    213     0%   6-417
utils/gpu_pathfinding.py                    76     76     0%   6-201
utils/gpu_vector_search.py                  88     88     0%   6-201
utils/map_data.py                           66     66     0%   6-172
utils/movement_utils.py                     54     54     0%   6-157
utils/pathfinding.py                       127    127     0%   6-304
utils/pubsub.py                             48     48     0%   7-187
----------------------------------------------------------------------
TOTAL                                     8843   7087    20%
[36m[1m=========================== short test summary info ============================[0m
[31mFAILED[0m tests/performance/test_npc_load.py::[1mtest_100_npc_registration[0m - AssertionError: At least 90% of NPCs should register successfully
[31mFAILED[0m tests/performance/test_npc_load.py::[1mtest_100_npc_concurrent_interactions[0m - AssertionError: At least 90% of interactions should succeed
[31mFAILED[0m tests/performance/test_npc_load.py::[1mtest_sustained_load_100_npcs[0m - AssertionError: Throughput should be at least 5 req/s
[31mFAILED[0m tests/performance/test_npc_load.py::[1mtest_stress_test_200_npcs[0m - AssertionError: At least 90% of NPCs should register successfully
[31mFAILED[0m tests/test_database.py::[1mTestDatabase::test_connect_success[0m - AssertionError: Expected 'from_url' to have been called once. Called 0 times.
[31mFAILED[0m tests/test_database.py::[1mTestDatabase::test_connect_retry_logic[0m - AssertionError: assert 0 == 3
[31mFAILED[0m tests/test_database.py::[1mTestDatabase::test_connect_max_retries_exceeded[0m - Failed: DID NOT RAISE <class 'ConnectionError'>
[31mFAILED[0m tests/test_database.py::[1mTestDatabase::test_disconnect[0m - AssertionError: Expected 'wait_closed' to have been called once. Called 0 t...
[31mFAILED[0m tests/test_database.py::[1mTestDatabase::test_get_player_memory[0m - AttributeError: 'Database' object has no attribute 'get_player_memory'
[31mFAILED[0m tests/test_database.py::[1mTestDatabase::test_add_player_memory[0m - AttributeError: 'Database' object has no attribute 'add_player_memory'
[31mFAILED[0m tests/test_database.py::[1mTestDatabase::test_rate_limit_check[0m - AttributeError: 'Database' object has no attribute 'check_rate_limit'
[31mFAILED[0m tests/test_database.py::[1mTestDatabase::test_set_rate_limit[0m - AttributeError: 'Database' object has no attribute 'set_rate_limit'
[31mFAILED[0m tests/test_database.py::[1mTestDatabase::test_quest_operations[0m - AttributeError: 'Database' object has no attribute 'create_quest'. Did you ...
[31mFAILED[0m tests/test_database.py::[1mTestDatabaseErrorHandling::test_connection_error_handling[0m - Failed: DID NOT RAISE <class 'ConnectionError'>
[31mFAILED[0m tests/test_database.py::[1mTestDatabaseErrorHandling::test_timeout_error_handling[0m - Failed: DID NOT RAISE <class 'TimeoutError'>
[31mFAILED[0m tests/test_integration.py::[1mTestModuleImports::test_llm_factory_import[0m - ModuleNotFoundError: No module named 'openai'
[31mFAILED[0m tests/test_integration.py::[1mTestModuleImports::test_azure_provider_import[0m - ModuleNotFoundError: No module named 'openai'
[31mFAILED[0m tests/test_integration.py::[1mTestModuleImports::test_agents_import[0m - ModuleNotFoundError: No module named 'crewai'
[31mFAILED[0m tests/test_integration.py::[1mTestModuleImports::test_main_app_import[0m - ModuleNotFoundError: No module named 'openai'
[31mFAILED[0m tests/test_integration.py::[1mTestLLMProviders::test_azure_provider_initialization[0m - ModuleNotFoundError: No module named 'openai'
[31mFAILED[0m tests/test_integration.py::[1mTestAgents::test_dialogue_agent_initialization[0m - ModuleNotFoundError: No module named 'crewai'
[31mFAILED[0m tests/test_integration.py::[1mTestAgents::test_decision_agent_initialization[0m - ModuleNotFoundError: No module named 'crewai'
[31mFAILED[0m tests/test_performance.py::[1mTestDatabasePerformance::test_memory_retrieval_performance[0m - AttributeError: 'Database' object has no attribute 'get_player_memory'
[31mFAILED[0m tests/test_performance.py::[1mTestAgentPerformance::test_dialogue_agent_performance[0m - ModuleNotFoundError: No module named 'crewai'
[31mFAILED[0m tests/test_performance.py::[1mTestAgentPerformance::test_orchestrator_performance[0m - ModuleNotFoundError: No module named 'crewai'
[31mFAILED[0m tests/test_performance.py::[1mTestEndToEndPerformance::test_player_interaction_latency[0m - ModuleNotFoundError: No module named 'crewai'
[31m=========== [31m[1m26 failed[0m, [32m67 passed[0m, [33m4987 warnings[0m[31m in 120.25s (0:02:00)[0m[31m ===========[0m
