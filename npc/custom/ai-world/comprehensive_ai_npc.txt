//===== rAthena Script =======================================
//= Comprehensive AI-Enabled NPC
//===== Description: =========================================
//= Advanced AI NPC demonstrating all features:
//= - Dynamic personality and mood system
//= - Gift-giving mechanics with preferences
//= - Relationship tracking and quest unlocking
//= - Multi-trigger quest system
//= - Walking animations and movement
//= - Context-aware interactions
//===== Author: ==============================================
//= AI Autonomous World System
//============================================================

//============================================================
// Aria the Wandering Sage - Comprehensive AI NPC
// Combines features from all example NPCs
//============================================================
prontera,150,180,4	script	Aria the Wandering Sage#ai_master	4_M_SAGE_C,{
	.@player_id = getcharid(0);
	.@player_name$ = strcharinfo(0);
	.@player_level = BaseLevel;
	.@player_class$ = jobname(Class);
	.@map$ = strcharinfo(3);
	.@x = getmapxy(.@map$, .@x, .@y, UNITTYPE_PC);
	
	// Build comprehensive context JSON
	.@json$ = "{";
	.@json$ += "\"npc_id\":\"ai_master_001\",";
	.@json$ += "\"player_id\":\"" + .@player_id + "\",";
	.@json$ += "\"interaction_type\":\"talk\",";
	.@json$ += "\"context\":{";
	.@json$ += "\"player_name\":\"" + .@player_name$ + "\",";
	.@json$ += "\"player_level\":" + .@player_level + ",";
	.@json$ += "\"player_class\":\"" + .@player_class$ + "\",";
	.@json$ += "\"location\":{\"map\":\"" + .@map$ + "\",\"x\":" + .@x + ",\"y\":" + .@y + "},";
	.@json$ += "\"time_of_day\":\"" + gettime(DT_HOUR) + ":" + gettime(DT_MINUTE) + "\",";
	.@json$ += "\"weather\":\"clear\"";
	.@json$ += "}";
	.@json$ += "}";
	
	.@bridge_url$ = "http://192.168.0.100:8000";
	.@response$ = httppost(.@bridge_url$ + "/ai/player/interaction/simple", .@json$);
	
	mes "[Aria the Wandering Sage]";
	if (.@response$ != "" && .@response$ != "...") {
		mes .@response$;
	} else {
		// Fallback dialogue based on time of day
		.@hour = gettime(DT_HOUR);
		if (.@hour >= 6 && .@hour < 12) {
			mes "Good morning, " + .@player_name$ + ".";
			mes "The dawn brings new opportunities";
			mes "for those who seek them.";
		} else if (.@hour >= 12 && .@hour < 18) {
			mes "Greetings, traveler.";
			mes "The afternoon sun illuminates";
			mes "many paths. Which will you choose?";
		} else {
			mes "The evening finds you well, I hope.";
			mes "As darkness falls, mysteries";
			mes "reveal themselves to the wise.";
		}
	}
	
	next;
	mes "[Aria the Wandering Sage]";
	mes "How may I assist you today?";
	menu
		"Tell me about yourself",L_About,
		"I'd like to give you a gift",L_Gift,
		"Do you have any quests?",L_Quest,
		"Check our relationship",L_Relationship,
		"Nevermind",L_Close;
	
L_About:
	mes "[Aria the Wandering Sage]";
	mes "I am a wanderer of many lands,";
	mes "a seeker of knowledge and wisdom.";
	mes "I've studied ancient texts, explored";
	mes "forgotten ruins, and learned from";
	mes "countless cultures.";
	next;
	mes "[Aria the Wandering Sage]";
	mes "My journey has taught me that";
	mes "true wisdom comes not from books,";
	mes "but from understanding people";
	mes "and the world around us.";
	close;
	
L_Gift:
	mes "[Aria the Wandering Sage]";
	mes "A gift? How thoughtful of you!";
	mes "I appreciate gestures of kindness.";
	next;
	mes "[Aria the Wandering Sage]";
	mes "^FF0000[Gift System]^000000";
	mes "To give a gift, use the command:";
	mes "^0000FF@gift <item_id>^000000";
	mes " ";
	mes "I particularly enjoy:";
	mes "- Books and scrolls";
	mes "- Rare artifacts";
	mes "- Flowers and herbs";
	close;
	
L_Quest:
	// Check for available quests via API
	.@quest_json$ = "{";
	.@quest_json$ += "\"npc_id\":\"ai_master_001\",";
	.@quest_json$ += "\"player_id\":\"" + .@player_id + "\"";
	.@quest_json$ += "}";
	
	.@quest_response$ = httppost(.@bridge_url$ + "/ai/quest/available", .@quest_json$);
	
	mes "[Aria the Wandering Sage]";
	if (.@quest_response$ != "" && .@quest_response$ != "[]") {
		mes "Ah, I do have some tasks";
		mes "that could use your assistance.";
		mes " ";
		mes "^0000FF" + .@quest_response$ + "^000000";
	} else {
		mes "I have no quests for you at";
		mes "the moment. Perhaps as we";
		mes "grow closer, I'll have tasks";
		mes "that require your unique skills.";
		next;
		mes "[Aria the Wandering Sage]";
		mes "^777777Hint: Build our relationship";
		mes "through conversation and gifts";
		mes "to unlock special quests!^000000";
	}
	close;
	
L_Relationship:
	// Check relationship level via API
	.@rel_json$ = "{";
	.@rel_json$ += "\"npc_id\":\"ai_master_001\",";
	.@rel_json$ += "\"player_id\":\"" + .@player_id + "\"";
	.@rel_json$ += "}";
	
	.@rel_response$ = httppost(.@bridge_url$ + "/ai/relationship/check", .@rel_json$);
	
	mes "[Aria the Wandering Sage]";
	mes "Our relationship status:";
	mes "^0000FF" + .@rel_response$ + "^000000";
	close;
	
L_Close:
	mes "[Aria the Wandering Sage]";
	mes "May wisdom guide your path.";
	close;

OnInit:
	.npc_id$ = "ai_master_001";
	
	// Register NPC with comprehensive personality
	.@reg_json$ = "{";
	.@reg_json$ += "\"npc_id\":\"ai_master_001\",";
	.@reg_json$ += "\"name\":\"Aria the Wandering Sage\",";
	.@reg_json$ += "\"npc_class\":\"sage\",";
	.@reg_json$ += "\"level\":75,";
	.@reg_json$ += "\"position\":{\"map\":\"prontera\",\"x\":150,\"y\":180},";
	.@reg_json$ += "\"personality\":{";
	.@reg_json$ += "\"openness\":0.92,";
	.@reg_json$ += "\"conscientiousness\":0.85,";
	.@reg_json$ += "\"extraversion\":0.65,";
	.@reg_json$ += "\"agreeableness\":0.80,";
	.@reg_json$ += "\"neuroticism\":0.30,";
	.@reg_json$ += "\"moral_alignment\":\"neutral_good\"";
	.@reg_json$ += "},";
	.@reg_json$ += "\"initial_goals\":[";
	.@reg_json$ += "\"Share knowledge with worthy seekers\",";
	.@reg_json$ += "\"Uncover ancient mysteries\",";
	.@reg_json$ += "\"Build meaningful relationships\",";
	.@reg_json$ += "\"Guide adventurers on their path\"";
	.@reg_json$ += "]";
	.@reg_json$ += "}";
	
	.@bridge_url$ = "http://192.168.0.100:8000";
	.@response$ = httppost(.@bridge_url$ + "/ai/npc/register", .@reg_json$);
	debugmes "[AI World] Aria the Wandering Sage registered: " + .@response$;
	
	// Enable walking/wandering behavior
	npcwalkto 155, 185;

	// Start autonomous movement timer
	initnpctimer;
	end;

OnTimer60000:
	// Random movement every 60 seconds
	.@rand_x = 145 + rand(15);
	.@rand_y = 175 + rand(15);
	npcwalkto .@rand_x, .@rand_y;
	initnpctimer;
	end;
}

