//===== rAthena Script =======================================
//= Reset NPC (First Reset Free)
//============================================================

prt_in,45,94,3	script	Reset Girl	4_F_YUNYANG,{

	// Costs: Skills, Stats, Both, Limit (0 = unlimited)
	setarray .@Reset[0], 100000, 100000, 150000, 0;

	mes "[Reset Girl]";

	// Optional reset limit
	if (.@Reset[3] && reset_limit >= .@Reset[3]) {
		mes "Sorry, you can only reset " + callfunc("F_InsertPlural", .@Reset[3], "time") + " in your life.";
		close;
	}

	// Show prices / free info
	if (reset_limit == 0) {
		mes "Welcome! Your first reset is completely ^00FF00FREE^000000.";
	} else {
		mes "Reset Stats: " + callfunc("F_InsertComma", .@Reset[1]) + "z";
		mes "Reset Skills: " + callfunc("F_InsertComma", .@Reset[0]) + "z";
		mes "Reset Both: " + callfunc("F_InsertComma", .@Reset[2]) + "z";
	}

	if (.@Reset[3])
		mes "You may only reset " + callfunc("F_InsertPlural", .@Reset[3], "time") + ", so use " + ((.@Reset[3] > 1) ? "them" : "it") + " wisely.";

	mes "Please select the service you want:";
	next;

	// 1 = Skills, 2 = Stats, 3 = Both, 4 = Cancel
	set .@i, select("^FF3355Reset Skills:Reset Stats:Reset Both^000000:Cancel");
	if (.@i > 3) close;

	mes "[Reset Girl]";

	// Determine cost (first reset is free)
	if (reset_limit == 0) {
		set .@cost, 0;
	} else {
		set .@cost, .@Reset[.@i - 1];
	}

	// Check Zeny (if not free)
	if (.@cost > 0 && Zeny < .@cost) {
		mes "Sorry, you don't have enough Zeny.";
		close;
	}

	// Optional confirmation when there is a limit
	if (.@Reset[3] && reset_limit == 0) {
		mes "This is your first reset, and it's free!";
	} else if (.@Reset[3]) {
		mes "You can only reset " + callfunc("F_InsertPlural", .@Reset[3], "time") + ". Are you sure?";
		if (select("Let me think:That's fine") == 1) close;
	}

	// Charge Zeny (if not free)
	if (.@cost > 0)
		set Zeny, Zeny - .@cost;

	// Apply reset
	if (.@i & 1) {
		sc_end_class;
		ResetSkill;
	}
	if (.@i & 2)
		ResetStatus;

	// Count this reset
	set reset_limit, reset_limit + 1;

	mes "There you go!";
	close;
}
