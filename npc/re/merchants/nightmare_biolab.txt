//===== rAthena Script =======================================
//= Nightmare Biolab NPCs
//===== Description: =========================================
//= [Walkthrough Conversion]
//= Nightmare Biolab exchange NPCs
//  NOTE: The nightmare biolab monsters are currently missing
//  some items used in the file.
//    Silent Energy Particles (ID: 25127)
//    Weak Energy Particles (ID: 25128)
//    Unstable Energy Particles (ID: 25129)
//    Sinister Energy Particles (ID: 25130)
//    Cursed Crystal (ID: 23080)
//===== Changelogs: ==========================================
//= 1.0 First version. [Capuche]
//= 1.1 Added some missing warp points and lore pieces [akaineko]
//============================================================

// Item Functions
//============================================================
function	script	F_Pieces_Of_Sentiment	{	// 22687
	if (strcharinfo(3) == "lhz_dun_n")// usage forbidden on the same map
		return;
	specialeffect2 EF_HIT4;
	.@r = rand(1,23);
	if (.@r == 1)
		warp "lhz_dun_n",140,89;
	else if (.@r == 2)
		warp "lhz_dun_n",75,138;
	else if (.@r == 3)
		warp "lhz_dun_n",198,151;
	else if (.@r == 4)
		warp "lhz_dun_n",200,189;
	else if (.@r == 5)
		warp "lhz_dun_n",87,84;
	else if (.@r == 6)
		warp "lhz_dun_n",201,101;
	else if (.@r == 7)
		warp "lhz_dun_n",230,138;
	else if (.@r == 8)
		warp "lhz_dun_n",239,220;
	else if (.@r == 9)
		warp "lhz_dun_n",162,252;
	else if (.@r == 10)
		warp "lhz_dun_n",99,106;
	else if (.@r == 11)
		warp "lhz_dun_n",40,212;
	else if (.@r == 12)
		warp "lhz_dun_n",140,191;
	else if (.@r == 13)
		warp "lhz_dun_n",164,77;
	else if (.@r == 14)
		warp "lhz_dun_n",124,138;
	else if (.@r == 15)
		warp "lhz_dun_n",28,140;
	else if (.@r == 16)
		warp "lhz_dun_n",78,189;
	else if (.@r == 17)
		warp "lhz_dun_n",137,262;
	else if (.@r == 18)
		warp "lhz_dun_n",115,253;
	else if (.@r == 19)
		warp "lhz_dun_n",140,39;
	else if (.@r == 20)
		warp "lhz_dun_n",240,64;
	else if (.@r == 21)
		warp "lhz_dun_n",131,235;
	else if (.@r == 22)
		warp "lhz_dun_n",34,70;
	else
		warp "lhz_dun_n",176,202;
	delitem 22687,1;
	return;
}

function	script	F_Cursed_Crystal	{	// 23080
	// custom rates
	.@r = rand(500);
	if (.@r < 10)		getitem 23016,100;// Cursed_Fragment
	else if (.@r < 352)	getitem 23016,200;// Cursed_Fragment
	else if (.@r < 469)	getitem 23016,300;// Cursed_Fragment
	else if (.@r < 498)	getitem 23016,400;// Cursed_Fragment
	else				getitem 23016,500;// Cursed_Fragment
	return;
}

function	script	F_Cursed_Fragment	{	// 23016
	// custom rates
	.@r = rand(981);
	if (.@r < 166) {
		if (rand(2) == 0)
			showscript "��س�...����Ѻ���...";
		else
			showscript "����...�ç���Ѻ���...";
		sleep2 200;
		warp "Random",0,0;
	}
	else if (.@r < 231)	{
		showscript "�ç����ѹ˹�Ǩѧ...";
		sc_start SC_FREEZE,8000,0;
	}
	else if (.@r < 304) {
		showscript "��Ң���...��Ҩ������...�ͺ�س...";
		getitem 6820,1;// Energy_Fragment
	}
	else if (.@r < 317)
		sc_start SC_CONFUSION,3000,0;
	else if (.@r < 328) {
		showscript "�á�����¢�ҷ�...";
		sc_start SC_CURSE,3000,0;
	}
	else if (.@r < 408) {
		showscript "�� Odin...";
		sc_start SC_ASSUMPTIO,100000,5;
		specialeffect2 EF_ASSUMPTIO;
	}
	else if (.@r < 496) {
		showscript "��Ҩ����������...!";
		sc_start SC_ATKPOTION,600000,10;
		sc_start SC_MATKPOTION,600000,10;
	}
	else {
		.@rand = rand(5);
		if (.@rand == 0)
			showscript "������!";
		else if (.@rand == 1)
			showscript "��ش��...�ѹ��...";
		else if (.@rand == 2)
			showscript "��ҡ���...��������...";
		else if (.@rand == 3)
			showscript "���������ҷ����...";
		else
			showscript "��Ѵ��...�������...?";
	.@r = rand(1,12);
	if (.@r == 1) {
		showscript "I will never forgive you...!";
		sc_start SC_ATKPOTION,600000,50;
		sc_start SC_MATKPOTION,600000,50;
	}
	else if (.@r == 2) {
		showscript "Somebody please help me...";
		sc_start SC_CURSE,10000,0;
	}
	else if (.@r == 3) {
		showscript "Stop it... It hurts...";
		sc_start SC_BLEEDING,5000,0;
	}
	else if (.@r == 4) {
		showscript "It's so cold in here...";
		sc_start SC_FREEZE,5000,0;
	}
	else if (.@r == 5) {
		showscript "Please... Stay with me...";
		itemskill "AL_TELEPORT",1;
	}
	else if (.@r == 6) {
		showscript "Stay... here with me...";
		itemskill "AL_TELEPORT",1;
	}
	else if (.@r == 7) {
		showscript "You shouldn't have come here...";
		sc_start SC_STUN,5000,0;
	}
	else if (.@r == 8) {
		showscript "Hello... Is anyone there...?";
		sc_start SC_BLIND,5000,0;
	}
	else if (.@r == 9) {
		showscript "I am so scared....scared....";
		sc_start SC_CONFUSION,10000,0;
	}
	else if (.@r == 10) {
		showscript "Dear Odin...";
		sc_start SC_ASSUMPTIO,100000,5;
		specialeffect2 EF_ASSUMPTIO;
	}
	else if (.@r == 11) {
		showscript "Wake up!";
		percentheal 0,20;
	}
	else {
		showscript "I am sorry... I will leave now... thank you...";
		getitem 6820,1;// Energy_Fragment
	}
	return;
}


// Nightmare Biolab Entrances
lighthalzen,321,218,4	script	Ohno Tohiro#1	4_M_RASWORD,{
	disable_items;
	mes "[Ohno Tohiro]";
	.@r = rand(1,10);
	if (.@r < 6)
		mes "��Ҷ١������Ǻ��� research charts...";
	else if (.@r < 7) {
		mes "- �ѹ���Թ�úҧ���ٴ - - ���������÷ҧ�� -";
		next;
		mes "[Ohno Tohiro]";
		mes "�� ... �ء���ҧ���Թ����ҧ�Һ���";
		mes "ʶҹТͧ����Ǻ�����§ҹ���º��������";
		mes "��Ѻ��ҹ";
		next;
		mes "[Ohno Tohiro]";
		mes "�ѹ����§ҹ�����ŷ������Ǣ�ͧ�Ѻ��ͧ��Ժѵԡ�����ӴѺ�����Ӥѭ�٧�ش�ѹ��";
		mes "��Ѻ��ҹ ... ���з�";
		next;
		mes "[Ohno Tohiro]";
		mes "�����Һ�ҧ����������ա��";
	}
	else {
		mes "[Ohno Tohiro]";
		mes "����ͧ�ѹ˹ѡ";
		mes "�������ö���ѹ��ǹҹ�ͧ��� .. ";
		mes "���Ф����� .. ";
	}
	next;
	mes "[Ohno Tohiro]";
	mes "���...? �������������������������ҧ...";
	mes "���...���...";
	mes "�պҧ���ҧ�����ҵ�ͧ��èҡ������ ?";
	while(true) {
		next;
		switch( select( "�����ʹ���.", "�������ǡѺ tomb of honor.", "��Ѻ价��� tomb of honor.", "�͡������Թ����." ) ) {
		case 1:
			mes "[Ohno Tohiro]";
			mes "�չѡ�����¨ӹǹ�ҡ�����ѧ�ͧ������¡���, ¡������!";
			mes "����������¹�, ����Ѻ���Ң��!";
			close;
		case 2:
			mes "[Ohno Tohiro]";
			mes "��������Թ����ǡѺ����¡��������ʶҹ�����, �١��� ?";
			mes "�ѡ��������ǹ�ҡ������͹����ѹ���!";
			next;
			mes "[Ohno Tohiro]";
			mes "������������¡�����á�������� ? �ѹ�й�����ʶҹ��������͹�����ӹǹ�ҡ.";
			next;
			mes "[Ohno Tohiro]";
			mes "���¡�ѹ���Ѻ�ѡ�����¤�˹�� ��������ѡ. ��ѧ�ҡ���, �ҡ��ʴ�����ʹ����ҧ�ҡ�����ͧ���!";
			mes "�Ҿ���ӡѺ����ͧ�����ǡѺ biomedical research, ����͹������ͧ���ͧ�ҧ���ҧ.";
			next;
			mes "[Ohno Tohiro]";
			mes "�Ң���ͧ������ʴ�����Ҵ����价���������ҧ��. ����ѧ�ŷ���������������ͧ����ǡѺ����¡���Т������ͧ���������������ͧ���. ���Ң�¢����Ź������Թ 100,000 Zeny.";
			next;
			mes "[Ohno Tohiro]";
			mes "���ҹ�ѡ, �ҡ�Ѻ�Ҿ�����Ѻ��ҧ��·�������. �ѹ���繻ү������������ʹ��Ѻ����...��ҡ����ҡ...";
			mes "���ҧ�á���, ����ͧ���������ҧ. ��繤����á, �ѹ�ٷç��ѧ�ҡ��鹷�����ҡ���.";
			next;
			mes "[Ohno Tohiro]";
			mes "����ҵ����, �ѡ�����¨ӹǹ�ҡ������ʶҹ�����ѹ���¼�ҹ����¡�����ѧ�ҡ���Թ�������. �������¾��Ѻ�ǡ���ա���. ��������繵���, ʶҹ�����١���¡��� tomb of honor.";
			mes "������, ��Ҩ����Ѻ�Թ�ͺ�س�ҧ��ǹ�ҡ�ǡ��.";
			next;
			mes "[Ohno Tohiro]";
			mes "��ҵ�ͧ��÷�Һ���˵ط�����Ѻ�Թ ?";
			mes "�����ʶҹ������繤��á, �ѧ��鹤�������Ңͧ�֧���繢ͧ���! ����ջѭ����� ?";
			next;
			mes "[Ohno Tohiro]";
			mes "��� ���...���ҧ�á���, ����Թ��� 100,000 Zeny. ����, ��Ҩ��Դ��еٷ��й��������ᵡ����Ѻ�ѡ���������ҧ���...";
			continue;
		case 3:
			if (Zeny < 100000) {
				mes "[Ohno Tohiro]";
				mes "������Թ����!";
				mes "��š�������բͧ�����͡��!";
				continue;
			}
			mes "[Ohno Tohiro]";
			mes "�˹����...˹��...�ͧ...���";
			mes "������Ѻ�Թ�Ҥú����, ��Ҩ��Դ�������ǹ��.";
			mes "�����ѧ�����Ҩ��ʹ��Ѻ��!...";
			next;
			if (Zeny >= 100000) {
				Zeny -= 100000;
				warp "lhz_dun_n",100,202;
			}
			end;
		case 4:
			mes "[Ohno Tohiro]";
			mes "���� ? ���������Թ, ����ҵ�ͧ��è����� ?";
			mes "���...���...��ͧ�բͧ���š, ����� research chart ��ҧ��� ?";
			next;
			mes "[Ohno Tohiro]";
			mes "����, �ٴ���. ����Ǥ��ǹ�����Թ. ������������������ ?";
			next;
			mes "[Ohno Tohiro]";
			mes "�����Ҷ����Ң�����价�����. ��� 10 research charts ������ҡ��. ����, ��Ҩ������价�� tomb of honor �ͧ. ��ҤԴ���� ?";
			next;
			if (select( "��Ѻ价�����١�͹˹��.", "��� 10 research charts." ) == 1) {
				mes "[Ohno Tohiro]";
				mes "��������ҡ�Ӹ�áԨ�Ѻ��� ?";
				continue;
			}
			if (countitem(7347) < 10) {
				mes "[Ohno Tohiro]";
				mes "������͹ 10 research charts �����ú.";
				mes "�ҧ������Ҩ�����Ժ�͡�ҡ��ѧ.";
				next;
				mes "[Ohno Tohiro]";
				mes "�����÷����ҵ�ͧ��èҡ������ ?";
				continue;
			}
			mes "[Ohno Tohiro]";
			mes "���...��, �������...����ҵ�ͧ���...�� ��...";
			next;
			mes "[Ohno Tohiro]";
			mes "��Ҩ������价������¡����ѭ��.";
			mes "�����ҡ�������ʹ. ���Ǿ��ѹ����!";
			next;
			delitem 7347,10;// Lab_Staff_Record
			warp "lhz_dun_n",100,202;
			end;
		}
	}
}

lighthalzen,320,204,3	script	A kid with black finger	4_F_04,{
	disable_items;
	mes "[Lunar]";
	mes "��ҡ��ѧ�ͧ������ ? ��ҡ��ѧ�ͧ��ʶҹ�����դ�����Թ�蹾�ҹ价������� ?";
	next;
	mes "[Lunar]";
	mes "��Ҿ����价����������ҵ�ͧ���. ��ҵ�ͧ�� ^0000cd20 Sentimental Fragment ��� 150K Zeny^000000.";
	next;
	mes "[Lunar]";
	mes "��������ͧ��ʶҹ�����ʹ��»��Ȩҡ�ǡ�����. ��ҵ�ͧ���´��� ^0000cd30 Sentimental Fragment ��� 2M Zeny^000000.";
	next;
	mes "[Lunar]";
	mes "��ҵ�ͧ���价���˹ ?";
	next;
	switch( select( "�������仴��¤����.", "ʶҹ����ʧ�.", "ʶҹ������蹤������?", "�������." ) ) {
	case 1:
		mes "[Lunar]";
		mes "���������ҵ�ͧ��� ?";
		next;
		if (countitem(22687) < 20 || Zeny < 150000) {
			mes "[Lunar]";
			mes "����.";
			next;
			mes "[Lunar]";
			mes "�ѹ����. ��ҵ�ͧ�� ^0000cd20 Sentimental Fragment ��� 150K Zeny^000000. ��Ҿ����仿��������.";
			close;
		}
		mes "[Lunar]";
		mes "���������ҵ�ͧ��� ?";
		next;
		mes "[Lunar]";
		mes "�����. ����դú. ��Ҩо�����.";
		next;
		mes "[Lunar]";
		mes "��...��Ҿ����������Թ...��ҵ�ͧ���ŵ���ͧ.";
		next;
		mes "[Lunar]";
		mes "�ѧ���..����������������, ��Ҩ���� ^0000cdStrange Machine ��������͹ crystal^000000.";
		next;
		mes "[Lunar]";
		mes "�������ͧ���п�鹿� HP �ͧ��Ҷ��������ѹ. �ѹ�ª��ª��Ե������. �������������ѹ仵������ç��������ҧ��...";
		next;
		mes "[Lunar]";
		mes "��һԴ����ͧ���������������ѹ, ���Ҩ����������繡óվ����.";
		next;
		mes "[Lunar]";
		mes "���ŵ���ͧ���������ͧ����ͨ��繴���!!";
		delitem 22687,20;// Sentimental Fragment
		Zeny = Zeny - 150000;
		if (isbegin_quest(14683) > 0)
			erasequest 14683;
		setquest 14683;// Mysterious Device
		close2;
		warp "lhz_dun_n",162,254;
		end;
	case 2:
		mes "[Lunar]";
		mes "����բͧ����Թ�ú��� ??";
		next;
		if (countitem(22687) < 30 || Zeny < 2000000) {
			mes "[Lunar]";
			mes "����.";
			next;
			mes "[Lunar]";
			mes "�ѹ����. ^0000cd30 Sentimental Fragment ��� 2M Zeny^000000 ����ͧ��. ��Ҿ����仿��������.";
			close;
		}
		mes "[Lunar]";
		mes "��. ����դú. ��Ҩо�����.";
		next;
		mes "[Lunar]";
		mes "�ҧ�͡��ʹ�ҹ�͡�ͧ��ᾧ.";
		next;
		mes "[Lunar]";
		mes "^EE0000������, ��Ҩ���͹������. ������ѹ૿�����, �ѧ������������͡�ҡ�������絵Ѵ, ��Ҩ��������ش save point.";
		close2;
		delitem 22687,30;
		Zeny = Zeny - 2000000;
		warp "lhz_d_n2",60,44;
		end;
	case 3:
		mes "[Lunar]";
		mes "��Ңش�Թ�����Ңͧ�Թ��Т�ҡ羺�ҧ���ҧ���ա��Ңͧ�Թ.";
		next;
		mes "[Lunar]";
		mes "�����������ö�����ʹ������. �ѹ���仴��¤����.";
		next;
		mes "[Lunar]";
		mes "�բ���������..�ҧ��价��������������Ѻ���ա���...";
		next;
		mes "[Lunar]";
		mes "�������֡������..�ѹ�С�����ʶҹ����ʹ��������Ѻ�ѡ�����·���仼�����.";
		next;
		mes "[Lunar]";
		mes "ʶҹ�������Ҷ֧ ^0000cd������Ѻ������������š �^000000.";
		next;
		mes "[Lunar]";
		mes "�������ź����Ҥ���·��������Ц�Ң��.";
		next;
		mes "[Lunar]";
		mes "�����Ǣ�ҡ��ŧ������ŧ㹷�����š�����Ҵ.";
		next;
		mes "[Lunar]";
		mes "�ѹ�繷������¡Ѻ��������� ^0000cd���ѹ����������֡^000000. ��ҡ���, �ѧ��鹢�Ҩ֧�͡价ѹ��.";
		next;
		mes "[Lunar]";
		mes "��Ҩо����件���������Թ��Тͧ��.";
		next;
		mes "[Lunar]";
		mes "�ѹ��������¶����Ҩ���ͧ.";
		close;
	case 4:
		mes "[Lunar]";
		mes "��������������ʹ. �ǡ�����������è���������.";
		close;
	}
}

lighthalzen,327,216,3	script	Crevice#1	4_CRACK,{
	end;
OnInit:
	initnpctimer;
	end;
OnTimer5000:
	specialeffect EF_AGIUP3;
	end;
OnTimer6000:
	initnpctimer;
	end;
}

// Dungeon exit
lhz_dun_n,96,203,3	script	Dungeon gateway#1	4_CRACK,{
	if (select( "����͡�ҡ�ѹ���¹.", "�͡�ҡ�ѹ���¹." ) == 1) {
		mes "- ����ѧ����觷��е�ͧ�ӷ���� -";
		close;
	}
	warp "lighthalzen",310,228;
	end;
OnInit:
	initnpctimer;
	end;
OnTimer5000:
	specialeffect EF_AGIUP3;
	end;
OnTimer6000:
	initnpctimer;
	end;
}

// Lighthalzen Exchange NPCs
lighthalzen,319,213,4	script	Veteran Adventurer#JCv2	4_M_MELODY,2,2,{
	disable_items;
	mes "[Veteran Adventurer]";
	mes "���! ��ҵ�ͧ����š�Ե�������ɤ���������� ?";
	next;
	setarray .@items[0],
		6469,200,	// Will of Warrior
		6470,200,	// Blood Thirst
		6471,300;	// Ghost Chill
	.@color$[0] = countitem(6820) < 200 ? "^777777" : "^000000";
	.@color$[1] = countitem(6820) < 300 ? "^777777" : "^000000";
	.@s = select( "�ѧ����ͧ���", .@color$[0] + "1 Will of Warrior (200 Energy pieces)", .@color$[0] + "1 Blood Thirst (200 energy pieces)", .@color$[1] + "1 Ghost Chill (300 energy pieces)^000000" ) - 2;
	if (.@s == -1) {
		emotion ET_QUESTION;
		mes "[Veteran Adventurer]";
		mes "��Ҵ�����͹����������ҧ, ��� ? ������, �ҹ�ͧ��ҡ�������ҡ�����ѹ���...";
		next;
		mes "[Veteran Adventurer]";
		mes "�ѹ˹��, ��������˹����Ҥ������Ң�ҷ����Ҥ�...";
		next;
		mes "[Veteran Adventurer]";
		mes "'^1F294D��Ҩз����ء�����Ҥ������� Cloak of the Fallen Soldier!!^000000'.";
		next;
		mes "[Veteran Adventurer]";
		mes "�ѧ���������, �ػ�ó����ͧ�����ʴبӹǹ�ҡ, �ѧ�����Ҫԡ�ء���֧����շҧ���͡��蹹͡�ҡ��ͧ�Դ����㹴ѹ���¹��ж١�ѧ�Ѻ���ӧҹ.";
		next;
		mes "[Veteran Adventurer]";
		mes "�������շҧ���������⪤�ͧ��Ҩ��͡Ѻ����. ��ҷӧҹ�ش����ͧ���¤������������ǡ��͡Ѻ�����ǹ������ҡ�ӹǹ�ҡ.";
		next;
		mes "[Veteran Adventurer]";
		mes "���������˹����Ҥ� �觢����š����¹��觢ͧ��ҧ�Ѻ������.";
		next;
		mes "[Veteran Adventurer]";
		mes "��͹���, �ӹǹ������š�١�Ѵ�Թ������˹����Ҥ�";
		mes "'^1F294D��Ҩ��������Ѻ�ҡ��ӡ��Ҩӹǹ���!!^000000'...";
		next;
		emotion ET_HNG;
		mes "[Veteran Adventurer]";
		mes "���������˹����Ҥ� ���ͧ�����¹�Թ�������˹����Ҥ�. �ǡ��Ҿ��������ҧ˹ѡ������ش���͹���.";
		next;
		mes "[Veteran Adventurer]";
		mes "�������Ҿǡ�������ö���������ҧ�Ǵ�����ҡ��Ѻ�ӹǹ������ŧ. (��Ыԡ)...�ѹ�����Դ�����.";
		close;
	}
	.@s *= 2;
	mes "[Veteran Adventurer]";
	mes "^3300661 " + getitemname(.@items[.@s]) + "^000000 �š����¹�Ѻ ^CC3333" + .@items[.@s+1] + " Energy Pieces^000000.";
	next;
	if (select( "�š.", "����š." ) == 2) {
		emotion ET_OTL;
		mes "[Veteran Adventurer]";
		mes "���� ?...��ҤԴ�������������š����¹������.";
		close;
	}
	while(true) {
		if (countitem(6820) < .@items[.@s+1]) {
			emotion ET_SORRY;
			mes "[Veteran Adventurer]";
			mes "���ɴ���. �������շҧ���͡�������˹����Ҥ������. ��ҵ�ͧ�� " + .@items[.@s+1] + " , ����һ���ʸ, ��Ҫ���������ԧ�.";
			close;
		}
		delitem 6820, .@items[.@s+1];// Energy Pieces
		getitem .@items[.@s],1;
		mes "[Veteran Adventurer]";
		mes "��ҵ�ͧ����š����¹����������?";
		next;
		if (select( "������.", "��ش�š����¹." ) == 2) {
			emotion ET_THANKS;
			mes "[Veteran Adventurer]";
			mes "�ͺ�س...�������Ң�Ҩ����١ŧ�������˹����Ҥ�����, �ͺ�����ҡ.";
			close;
		}
	}
	end;

OnTouch:
	.@r = rand(4);
	if (.@r == 0)
		npctalk "��Ҩ��š 1 Will of Warrior �Ѻ 200 energy pieces.", "", bc_self;
	else if (.@r == 1)
		npctalk "��Ҩ��š 1 Ghost Chill �Ѻ 300 energy pieces.", "", bc_self;
	else if (.@r == 2)
		npctalk "��Ҩ��š 1 Blood Thirst �Ѻ 200 energy pieces.", "", bc_self;
	else {
		emotion ET_OHNO;
		npctalk "���!...�����ѹ�֧����ɪ����ǹ�ҡ�ѡ ?", "", bc_self;
	}
	end;
}

lighthalzen,312,296,4	script	Bully#JCv2	4_M_LGTPOOR,{
	disable_items;
	mes "[Bully]";
	mes "���, �����. ��Ҿͨ��� Energy pieces �������� ? ��Ҩ��š�ѹ�Ѻ��觷�����ö����ҵ�ͧ���.";
	next;
	.@s = select(
		"Listen to the story.",
		( countitem(25127) < 2000 ? "^777777" : "^000000" ) + "1 Energy Fragment (2000 Silent E Particles)",
		( countitem(25128) < 1000 ? "^777777" : "^000000" ) + "1 Energy Fragment (1000 Weak E Particles)",
		( countitem(25129) < 500 ? "^777777" : "^000000" ) + "1 Energy Fragment (500 Unstable E Particles)",
		( countitem(25130) < 500 ? "^777777" : "^000000" ) + "1 Energy Fragment (500 Sinister E Particles)",
		( countitem(25131) < 50 ? "^777777" : "^000000" ) + "1 Energy Fragment (50 Fallen E Particles)",
		( countitem(6820) < 50 ? "^777777" : "^000000" ) + "1 Sentimental Fragment (50 Energy Fragments)",
		( countitem(6820) < 666 ? "^777777" : "^000000" ) + "1 Cursed Fragment (666 Energy Fragments)"
	) - 2;
	if (.@s == -1) {
		emotion ET_THINK;
		mes "[Bully]";
		mes ". . . . . . .";
		next;
		mes "[Bully]";
		mes "�����...����͹��ҧ�Ҵ���֧.";
		mes "�»����Ҩ�����¢�����价ӧҹ�ͧ��.";
		next;
		mes "[Bully]";
		mes "���ɴ���, ������������èоٴ. ������ҷӧҹ��������ѹ���Թ������ҡ���.";
		close;
	}
	setarray .@exchange[0],
		6820, 25127,2000,	// Silent Energy Particle -> Energy Fragment
		6820, 25128,1000,	// Weak Energy Particles -> Energy Fragment
		6820, 25129,500,	// Unstable Energy Particle -> Energy Fragment
		6820, 25130,500,	// Sinister Energy Particle -> Energy Fragment
		6820, 25131,50,		// Fallen Energy Particle -> Energy Fragment
		22687, 6820,50,		// Energy Fragment -> Sentimental Fragment
		23016, 6820,666;	// Energy Fragment -> Cursed Fragment
	.@index = .@s * 3;
	mes "[Bully]";
	mes "��ҵ�ͧ��÷����š ^330066" + .@exchange[.@index+2] + " " + getitemname(.@exchange[.@index+1]) + "^000000 �Ѻ ^CC33331 " + getitemname(.@exchange[.@index]) + "^000000 ����� ?";
	next;
	if (select( "�š.", "����š." ) == 2) {
		emotion ET_HNG;
		mes "[Bully]";
		mes "������...���������ͺ, �����ҡѧ��.";
		close;
	}
	while(true) {
		if (countitem(.@exchange[.@index+1]) < .@exchange[.@index+2]) {
			emotion ET_SCRATCH;
			mes "[Bully]";
			mes "���...���...����š�����.";
			mes "��Һ͡������������ҵ�ͧ�š�ѹ���� " + .@exchange[.@index+2] + " (item)s.";
			close;
		}
		delitem .@exchange[.@index+1], .@exchange[.@index+2];
		getitem .@exchange[.@index], 1;
		emotion ET_SEXY;
		mes "[Bully]";
		mes "��� �ͺ�س. ��ҵ�ͧ����š����¹������ ?";
		next;
		if (select( "�š���.", "��ش�š����¹." ) == 2) {
			mes "[Bully]";
			mes "�����㴷������� energy piece �����, ������Ң��.";
			close;
		}
	}
}

// Enchants NPCs
lhz_dun_n,145,265,4	script	Silent Mind#JCv2	4_CENERE,{
	disable_items;
	mes "[Silent Mind]";
	mes ". . . . . .!";
	mes "...";
	mes "^FF0000*�������ö�Ѻ Death's Chest ��������������ԭ�ҳ�������͹�ѹ�� 3 �ѹ.*^000000";
	next;
	setarray .@item[0],6814,6815,6816,6817,6818,6819;
	for ( .@i = 0; .@i < 6; ++.@i ) {
		if (countitem(.@item[.@i]) < 3)
			.@menu$ += "^777777���� " + getitemname(.@item[.@i]) + ".^000000:";
		else
			.@menu$ += "���ͺ 3 " + getitemname(.@item[.@i]) + ".:";
	}
	.@s = select(.@menu$) - 1;
	while(true) {
		if (countitem(.@item[.@s]) < 3) {
			emotion ET_HNG;
			mes "[Silent Mind]";
			mes "!. . . . . .";
			mes "^FF0000*��ҵ�ͧ���ԭ�ҳ�������͹�ѹ�� 3 �ѹ�����š�Ѻ Death's Chest.*^000000";
			close;
		}
		delitem .@item[.@s],3;
		getitem 22679,1;// Chest_of_Death
		emotion ET_HUNGRY;
		mes "[Silent Mind]";
		mes ". . . . . .";
		mes "...";
		mes "^FF0000*������Ѻ Death's Chest ����. ��ҵ�ͧ����š����������?*^000000";
		next;
		if (select( "�š���.", "��ش�š." ) == 2) {
			mes "[Silent Mind]";
			mes ". . . . . .";
			close;
		}
	}
}

lhz_dun_n,134,265,2	script	Wandering Mind#JCv2	4_CENERE,{
	disable_items;
	npctalk "���...�����...����֡��...", "", bc_self;
	mes "[Wandering Mind]";
	mes "���...�����...����֡��...�֧������...�ѹ�ҡ���...�ͧ��餹...";
	next;
	npctalk "���...���...�� ?...", "", bc_self;
	mes "[Wandering Mind]";
	mes "�����...����˹ ?...����˹�ѹ ?...��ҡ��...���...���...�� ?...�������...�������...";
	next;
	mes "[Wandering Mind]";
	mes "��ҵ�ͧ���...��ѧ...��������...�...�������...�ѹ�Ъ���...���...������...��駤��...���...";
	next;
	switch( select( "�Ϳ Old Helmet", "ź�Ϳ Old Helmet", "��������´�Ϳ Old Helmet" ) ) {
	case 1:
		npctalk "���ͺ...������...��������...", "", bc_self;
		mes "[Wandering Mind]";
		mes "����...����...���ͺ...������...������...����������...��Ҩ��Ϳ...��ѧ�������...ŧ���ǡ���...";
		mes "^FF0000*�����ҹ� Cursed Fragment ��, �������ö�Ϳ��ǡ��.*^000000";
		next;
		.@equip_id = getequipid(EQI_HEAD_TOP);
		switch(.@equip_id) {
			case 18971:// Old_Rune_Circlet
			case 18972:// Old_Mitra
			case 18973:// Old_Driver_Band_R
			case 18974:// Old_Driver_Band_Y
			case 18975:// Old_Shadow_Handicraft
			case 18976:// Old_Minstrel_Song_Hat
			case 18977:// Old_Midas_Whisper
			case 18978:// Old_Magic_Stone_Hat
			case 18979:// Old_Blazing_Soul
			case 18980:// Old_Wind_Whisper
			case 18981:// Old_Dying_Swan
			case 18982:// Old_Circlet_Of_Bone
			case 18983:// Old_Protect_Of_Crown
			case 18984:// Old_Camo_RabbitHood
				break;
			default:
				npctalk "������ѹ...������ѹ...", "", bc_self;
				mes "[Wandering Mind]";
				mes "�ѹ��...�������ʹ�...���ǡ...�ѹ��������ҹ...�������Ѻ��ѧ�����...��ҵ�ͧ���...������ѹ...? ���...";
				mes "^FF0000*㹡���Ϳ Old Helmet ���� Cursed Fragment ��ҹ��.*^000000";
				close;
		}
		mes "[Wandering Mind]";
	
		.@requirement = 10;	// 10 Cursed Fragments by default
		setarray .@card[0], getequipcardid(EQI_HEAD_TOP,0), getequipcardid(EQI_HEAD_TOP,1), getequipcardid(EQI_HEAD_TOP,2), getequipcardid(EQI_HEAD_TOP,3);
		.@refine = getequiprefinerycnt(EQI_HEAD_TOP);
	
		if (.@card[3] == 0) {
			.@slot = 3;
			mes "�ǡ���...�������...Ẻʺ��� ?...�ͧ...⪤�ͧ���...��..����...";
			mes "^FF0000*㹡���Ϳ��ͧ��� 4. �������Ϳ��˹��� 6 �൵��.*^000000";
		}
		else if (.@card[2] == 0) {
			.@slot = 2;
			mes "��...����...��...����͹���...��...�Ϳ...�����á����� ?...";
			mes "^FF0000*㹡���Ϳ��ͧ��� 3. �������Ϳ��˹��� 6 �൵��.*^000000";
		}
		else if (.@card[1] == 0) {
			.@slot = 1;
			mes "��...����...����Դ��...˹�ҧ...�������Ѻ...��ѧ���������ҡ���...��è�...�Ѵ�Թ�...�͹���...";
			mes "^FF0000*㹡���Ϳ��ͧ��� 2.";
			mes "����Ҩ���Ϳ Mettle, Magic Essence, Acute, Master Archer, Adamantine, Affection, �ѹ����ö����͹��鹢����.*^000000";
		}
		else {
			// enchant leveling
			switch( .@card[1] ) {
			case 29061:	// Ambition1Lv
			case 29071:	// Tab1Lv
			case 29081:	// Expect1Lv
			case 29091:	// ArchLine1Lv
			case 29101:	// Steel1Lv
			case 29111:	// Mercy1Lv
				mes "��...��...��...����ѹ...�ǧ��...�����ҡ...����������稵�ʹ!...���Ч��...��ҤԴ���...��ҨС�Ѻ���Ң��...������Ѻ�����鹷���ѹ�ҡ���...";
				.@requirement = 20;
				.@enchant_level = 1;
				.@enchant_rate = 80;
				break;
			case 29062:	// Ambition2Lv
			case 29072:	// Tab2Lv
			case 29082:	// Expect2Lv
			case 29092:	// ArchLine2Lv
			case 29102:	// Steel2Lv
			case 29112:	// Mercy2Lv
				mes "����͹���...�����...3 ?...�����������...��Ҩ�...���Ѻ...��ѧ���������ҡ���...��������������...��Ҩ��٭���¾�ѧ...���������Ѻ��...�͡�...";
				.@requirement = 40;
				.@enchant_level = 2;
				.@enchant_rate = 70;
				break;
			case 29063:	// Ambition3Lv
			case 29073:	// Tab3Lv
			case 29083:	// Expect3Lv
			case 29093:	// ArchLine3Lv
			case 29103:	// Steel3Lv
			case 29113:	// Mercy3Lv
				mes "����͹���...�����...4 ?...�����������...��Ҩ�...���Ѻ...��ѧ���������ҡ���...��������������...��Ҩ��٭���¾�ѧ...���������Ѻ��...�͡�...";
				.@requirement = 50;
				.@enchant_level = 3;
				.@enchant_rate = 50;
				break;
			case 29064:	// Ambition4Lv
			case 29074:	// Tab4Lv
			case 29084:	// Expect4Lv
			case 29094:	// ArchLine4Lv
			case 29104:	// Steel4Lv
			case 29114:	// Mercy4Lv
				mes "����͹���...�����...5 ?...��Ҿ����...���ФǺ���...��ѧ�ѹ...����˭�...�����ѧ ?...��������������...�������ҡ���...��...�������Ѻ...";
				.@requirement = 70;
				.@enchant_level = 4;
				.@enchant_rate = 20;
				break;
			case 29065:	// Ambition5Lv
			case 29075:	// Tab5Lv
			case 29085:	// Expect5Lv
			case 29095:	// ArchLine5Lv
			case 29105:	// Steel5Lv
			case 29115:	// Mercy5Lv
				mes "����͹���...�����...6 ?...��Ҿ����...���ФǺ���...��ѧ�ѹ...����˭�...�����ѧ ?...��������������...�������ҡ���...��...�������Ѻ...";
				.@requirement = 100;
				.@enchant_level = 5;
				.@enchant_rate = 20;	// unknown rates
				break;
			case 29066:	// Ambition6Lv
			case 29076:	// Tab6Lv
			case 29086:	// Expect6Lv
			case 29096:	// ArchLine6Lv
			case 29106:	// Steel6Lv
			case 29116:	// Mercy6Lv
				// custom text
				mes "����͹���...�����...7 ?...��Ҿ����...���ФǺ���...��ѧ�ѹ...����˭�...�����ѧ ?...��������������...�������ҡ���...��...�������Ѻ...";
				.@requirement = 150;
				.@enchant_level = 6;
				.@enchant_rate = 20;	// unknown rates
				break;
			case 29067:	// Ambition7Lv
			case 29077:	// Tab7Lv
			case 29087:	// Expect7Lv
			case 29097:	// ArchLine7Lv
			case 29107:	// Steel7Lv
			case 29117:	// Mercy7Lv
				// custom text
				mes "����͹���...�����...8 ?...��Ҿ����...���ФǺ���...��ѧ�ѹ...����˭�...�����ѧ ?...��������������...�������ҡ���...��...�������Ѻ...";
				.@requirement = 250;
				.@enchant_level = 7;
				.@enchant_rate = 20;	// unknown rates
				break;
			case 29068:	// Ambition8Lv
			case 29078:	// Tab8Lv
			case 29088:	// Expect8Lv
			case 29098:	// ArchLine8Lv
			case 29108:	// Steel8Lv
			case 29118:	// Mercy8Lv
				// custom text
				mes "����͹���...�����...9 ?...��Ҿ����...���ФǺ���...��ѧ�ѹ...����˭�...�����ѧ ?...��������������...�������ҡ���...��...�������Ѻ...";
				.@requirement = 500;
				.@enchant_level = 8;
				.@enchant_rate = 20;	// unknown rates
				break;
			case 29069:	// Ambition9Lv
			case 29079:	// Tab9Lv
			case 29089:	// Expect9Lv
			case 29099:	// ArchLine9Lv
			case 29109:	// Steel9Lv
			case 29119:	// Mercy9Lv
				// custom text
				mes "����͹���...�����...10 ?...��Ҿ����...���ФǺ���...��ѧ�ѹ...����˭�...�����ѧ ?...��������������...�������ҡ���...��...�������Ѻ...";
				.@requirement = 1000;
				.@enchant_level = 9;
				.@enchant_rate = 20;	// unknown rates
				break;
			case 29070:	// Ambition10Lv
			case 29080:	// Tab10Lv
			case 29090:	// Expect10Lv
			case 29100:	// ArchLine10Lv
			case 29110:	// Steel10Lv
			case 29120:	// Mercy10Lv
				// custom text
			default:
				mes "��� ����...�ѹ��������...�������ѧ...�дѺ���...˹�ҧ���Ǥ��...ź�Ϳ...";
				mes "^FF0000*Mettle, Magic Spirit, Vigor, Bull's Eye, Adamantine, Benevolence";
				mes "�������ö����͹������Ϳ��������ػ�ó����Ϳ����.*^000000";
				close;
			}
			.@slot = 999;
		}
		next;
		mes "[Wandering Mind]";
		mes "���ҧ�á���...��͹����ѹ���Դ���...��ҵ�ͧ��Ǩ�ͺ...��������...Cursed Fragments ����������...";
		next;
		mes "[Wandering Mind]";
		mes "Cursed...Fragments..." + .@requirement + " �ѹ...���...�ӹǹ���...��ҵ�ͧ���...㹡���Ϳ...�ѹ ?...��...��...";
		mes "^FF0000*㹡���Ϳ, " + .@requirement + " Cursed Fragment(s) ��� ����ͧ��.*^000000";
		next;
		if (select( "���¤�Һ�ԡ��.", "������." ) == 2) {
			mes "[Wandering Mind]";
			mes "�...��...������͹...������...�ѧ�������...�����Ѻ��ѧ�ѹ����˭�...�͹���...";
			close;
		}
		if (countitem(23016) < .@requirement) {// Cursed Fragment
			mes "[Wandering Mind]";
			mes "�...��...���...���...����� ?...���...������...㹾�ѧ...�����...��Ѻ������������� ?...";
			mes "^FF0000*㹡���Ϳ, Cursed Fragment(s) 10 �ѹ ��� ����ͧ��.";
			mes "��Ǩ�٨ӹǹ�ͧ Cursed Fragments �ͧ����ա����.*^000000";
			close;
		}
		mes "[Wandering Mind]";
		mes "���..����...�ѹ��...��ѧ㹡������...��ҤԴ���...��ѧ���...�ѧ�����...����...";
		mes "^FF0000*�дѺ��õպǡ, ����, �ͧ�ػ�ó���������. ���ҧ�á���, ������Ϳ�ҨŴŧ��, �������Ѻ�ѹ������������������.*^000000";
		next;
		if (select( "���Թ����Ϳ.", "����Ϳ����." ) == 2) {
			mes "[Wandering Mind]";
			mes "�...��...������͹...������...�ѧ�������...�����Ѻ��ѧ�ѹ����˭�...�͹���...";
			close;
		}
		progressbar "000000",1;
		delitem 23016, .@requirement;// Cursed Fragment

		// anti-hack
		if (callfunc("F_IsEquipIDHack", EQI_HEAD_TOP, .@equip_id) || callfunc("F_IsEquipCardHack", EQI_HEAD_TOP, .@card[0], .@card[1], .@card[2], .@card[3]) || callfunc("F_IsEquipRefineHack", EQI_HEAD_TOP, .@refine))
			close;

		switch(.@slot) {
		case 3:
		case 2:
			setarray .@enchant[0],
				4700,	// Strength1
				4701,	// Strength2
				4702,	// Strength3
				4703,	// Strength4
				4704,	// Strength5
				4710,	// Inteligence1
				4711,	// Inteligence2
				4712,	// Inteligence3
				4713,	// Inteligence4
				4714,	// Inteligence5
				4720,	// Dexterity1
				4721,	// Dexterity2
				4722,	// Dexterity3
				4723,	// Dexterity4
				4724,	// Dexterity5
				4730,	// Agility1
				4731,	// Agility2
				4732,	// Agility3
				4733,	// Agility4
				4734,	// Agility5
				4740,	// Vitality1
				4741,	// Vitality2
				4742,	// Vitality3
				4743,	// Vitality4
				4744,	// Vitality5
				4750,	// Luck1
				4751,	// Luck2
				4752,	// Luck3
				4753,	// Luck4
				4754;	// Luck5
			.@card[.@slot] = .@enchant[ rand( getarraysize(.@enchant) ) ];	// unknown rates
			break;
		case 1:
			setarray .@enchant[0],
				4703,	// Strength4
				4704,	// Strength5
				4713,	// Inteligence4
				4714,	// Inteligence5
				4723,	// Dexterity4
				4724,	// Dexterity5
				4733,	// Agility4
				4734,	// Agility5
				4743,	// Vitality4
				4744,	// Vitality5
				4753,	// Luck4
				4754,	// Luck5
				29061,	// Ambition1Lv
				29071,	// Tab1Lv
				29081,	// Expect1Lv
				29091,	// ArchLine1Lv
				29101,	// Steel1Lv
				29111;	// Mercy1Lv
			.@card[1] = .@enchant[ rand( getarraysize(.@enchant) ) ];	// unknown rates
			break;
		case 999:
			// enchant leveling
			if (.@enchant_rate > rand(100))
				.@level_dt = 1;
			else
				.@level_dt = -1;
			.@enchant_level += .@level_dt;
			.@card[1] += .@level_dt;
			if (.@card[1] < 29061 || .@card[1] > 29120) {
				mes "[Wandering Mind]";
				mes "�ҧ��觷����������Դ���.";
				close;
			}
			if (.@enchant_level < 1 || .@enchant_level > 10) {
				// item not deleted
				specialeffect2 EF_SUI_EXPLOSION;
				mes "[Wandering Mind]";
				mes "�..��ҡ��...!! ��ѧ㹡������...��������...������Ҥ���...���ҧ�á���...⪤�շ���ѹ��������Դ���о�ѧ...���....��͹��.";
				close;
			}
			break;
		default:
			mes "[Wandering Mind]";
			mes "�ҧ��觷����������Դ���.";
			close;
		}
		delequip EQI_HEAD_TOP;
		getitem2 .@equip_id,1,1,.@refine,0,.@card[0],.@card[1],.@card[2],.@card[3];
		if (.@level_dt == -1) {// can only happens during enchant leveling
			specialeffect2 EF_SUI_EXPLOSION;
			mes "[Wandering Mind]";
			mes "�..��ҡ��...!! ��ѧ㹡������...��������...������Ҥ���...��ѧ...�������...�ѹ...��Ŵŧ...�˹���дѺ...";
			mes "^FF0000*���ͧ�ҡ�Ϳ�������, ������Ϳ�ж١Ŵ�˹���дѺ.*^000000";
			close;
		}
		specialeffect2 EF_FIREHIT;
		mes "[Wandering Mind]";
		mes "�ѹ...�����. �������֡����Ҿ�ѧ㹡������������觢������.";
		mes "^FF0000*�Թ�մ���. ����Ϳ�����仴��´�.*^000000";
		close;
	case 2:
		.@equip_id = getequipid(EQI_HEAD_TOP);
		switch(.@equip_id) {
			case 18971:// Old_Rune_Circlet
			case 18972:// Old_Mitra
			case 18973:// Old_Driver_Band_R
			case 18974:// Old_Driver_Band_Y
			case 18975:// Old_Shadow_Handicraft
			case 18976:// Old_Minstrel_Song_Hat
			case 18977:// Old_Midas_Whisper
			case 18978:// Old_Magic_Stone_Hat
			case 18979:// Old_Blazing_Soul
			case 18980:// Old_Wind_Whisper
			case 18981:// Old_Dying_Swan
			case 18982:// Old_Circlet_Of_Bone
			case 18983:// Old_Protect_Of_Crown
			case 18984:// Old_Camo_RabbitHood
				break;
			default:
				npctalk "������ѹ...������ѹ...", "", bc_self;
				mes "[Wandering Mind]";
				mes "�ѹ��...�������ʹ�...���ǡ...�ѹ��������ҹ...�������Ѻ��ѧ�����...��ҵ�ͧ���...������ѹ...? ���...";
				mes "^FF0000*㹡���Ϳ Old Helmet ���� Cursed Fragment ��ҹ��.*^000000";
				close;
		}
		setarray .@card[0], getequipcardid(EQI_HEAD_TOP,0), getequipcardid(EQI_HEAD_TOP,1), getequipcardid(EQI_HEAD_TOP,2), getequipcardid(EQI_HEAD_TOP,3);
		.@refine = getequiprefinerycnt(EQI_HEAD_TOP);

		if (.@card[3] < 1) {// one enchant required
			npctalk "���...�����ҡ...", "", bc_self;
			mes "[Wandering Mind]";
			mes "���...��Ҵٹ���ҡ...����͹�����...���Ѻ��ѧ...�����...������...�ҡ�͹...";
			mes "^FF0000*��ǡ���������Ϳ, �����ź�Ϳ�����.*^000000";
			close;
		}
		npctalk "���...����...��ҨСԹ...�ѹ...�ѹ���...", "", bc_self;
		mes "[Wandering Mind]";
		mes "���...�������͹...���ͺ㹾�ѧ��� ?...�� 10 mind powers �������...����, ��Ҩз�����ѧ...�ѹ����...";
		mes "^FF0000*��ҵ�ͧ�� 10 Sentimental Fragments 㹡��ź�Ϳ.";
		mes "��ǡ����ź�Ϳ, ����š�õպǡ��С��촨��������, �ҡ���ź�Ϳ.*^000000";
		next;
		if (select( "���ʹ�.", "���¤�Һ�ԡ��." ) == 1) {
			npctalk "��ʹ�...", "", bc_self;
			mes "[Wandering Mind]";
			mes "��Ҩ�...��...���...�����ҵ�ͧ��â��...��Ҩ������...��ʹ�...���...";
			close;
		}
		if (countitem(22687) < 10) {// Sentimental Fragment
			mes "��..�...������...����...";
			mes "10 mind powers...�� ����Ҩ...�ջѭ����...";
			mes "^FF0000*��ҵ�ͧ�� 10 Sentimental Fragments 㹡��ź�Ϳ.";
			mes "��Ǩ�٨ӹǹ�ͧ Sentimental Fragments �ͧ����ա����.*^000000";
			close;
		}
		npctalk "�...��...", "", bc_self;
		mes "[Wandering Mind]";
		mes "���º����!...���...ź...�Ϳ�͡�ҡ...old helmet �������...��ҤԴ���...�ǡ����ѧ����ö...�觢����...";
		next;
		progressbar "000000",2;
		specialeffect2 EF_FIREHIT;
		delitem 22687,10;// Sentimental Fragment

		if (callfunc("F_IsEquipIDHack", EQI_HEAD_TOP, .@equip_id) || callfunc("F_IsEquipCardHack", EQI_HEAD_TOP, .@card[0], .@card[1], .@card[2], .@card[3]) || callfunc("F_IsEquipRefineHack", EQI_HEAD_TOP, .@refine))
			close;

		delequip EQI_HEAD_TOP;
		getitem2 .@equip_id,1,1,.@refine,0,.@card[0],0,0,0;
		mes "[Wandering Mind]";
		mes "�..��...��ѧ...㹡������...��١...�ٴ�Ѻ...�͡�����...�..��ҡ��...";
		close;
	case 3:
		for ( .@i = 18971; .@i <= 18984; ++.@i ) {
			if (.@i < 18977)
				.@string$[0] += getitemname(.@i) + ", ";
			else if (.@i < 18984)
				.@string$[1] += getitemname(.@i) + ", ";
			else
				.@string$[2] = getitemname(.@i);
		}
		mes "[Wandering Mind]";
		mes "��ҵ�ͧ���...��ѧ��� ?...��� ���, ���...��ͧ��...old Helmet..";
		mes "^FF0000*�������ö�Ϳ�ѹŧ� " + .@string$[0];
		mes "" + .@string$[1];
		mes "" + .@string$[2] + ".*^000000";
		next;
		mes "[Wandering Mind]";
		mes "������...�Ӿ�ѧ...㹡������...�� ��Ҩ�...�ͺ��ѧ...������...";
		mes "^FF0000*��ҵ�ͧ�� Cursed Fragments 㹡���Ϳ.*^000000";
		next;
		mes "[Wandering Mind]";
		mes "���...��͹���...������Ѻ��ѧ...���ա���...��ҵ�ͧ��...�ӹǹ��ѧ...㹡������...����ҡ...";
		mes "^FF0000*㹡���Ϳ��ͧ��� 4, 3, 2 ���. ��ҵ�ͧ�� 10 Cursed Fragments �������ҷӡ���Ϳ���Ъ�ͧ�繤����á.*^000000";
		next;
		mes "[Wandering Mind]";
		mes "��������...�͡��...����Ҩ��...����ö�Ѿ�ô...�дѺ�Ϳ��...";
		mes "^FF0000*���������͹�дѺ������Ϳ, 50, 70, 100, 150, 250, 500, 1000 Cursed Fragments ��ͨӹǹ, ���������͹������Ϳ";
		mes "�����ҡ 20 Cursed Fragments 㹤��駷�� 2, ��� 40 Cursed Fragments 㹤��駷�� 3.*^000000";
		close;
	}
}

lhz_dun_n,143,269,4	script	Victimized Soul's Mind#1	4_M_DEATH2,{
	disable_items;
	.@r = rand(5);
	if (.@r == 0)
		npctalk "���...��ͤ�...����ѹ����...���...������͹�����...", "", bc_self;
	else if (.@r == 1)
		npctalk "���¢�Ҵ���...��Ҩ�...�ӷء���ҧ...������������...", "", bc_self;
	else if (.@r == 2)
		npctalk "���������١���...������ѡ�ͧ���...�͢�ҡ�͹...��ҡ��ѧ...��Ѻ��ҹ...", "", bc_self;
	else if (.@r == 3)
		npctalk "��ѧ�ҡ���...�ء���..�ѹ...��ҡ���", "", bc_self;
	else
		npctalk "��...���...ᢹ...���...", "", bc_self;
	mes "[Victimized Soul's Mind]";
	mes "�Ե...�ԭ�ҳ...�ѹ�ҡ���...";
	mes "ʹյ...�Ѩ�غѹ...��С������...";
	mes "��Ҥ����...";
	mes "�������ö...�Ǻ���...�����...���ء����ҹ�ҡ�������������� ?...";
	next;
	if (.@r == 0)
		npctalk "�����ѧ�ҡ����ҵ��...��������㹤����ѹ�ͧ��ҡѹ...", "", bc_self;
	else if (.@r == 1)
		npctalk "���ô...���¢�Ҵ���...����ѹ�͡�...�մ���...�ѹ������ҡ���...", "", bc_self;
	else if (.@r == 2)
		npctalk "��...�ô...�Ң���͡�...��Ҩ�����Թ���...��������ҵ�ͧ���...", "", bc_self;
	else if (.@r == 3)
		npctalk "�������...��ҨС���...���...�ͧ������ ?...", "", bc_self;
	else
		npctalk "��ҡ...��...���...", "", bc_self;
	mes "[Victimized Soul's Mind]";
	mes "������...����ö...���ѹ��...����Ҩ��...�����...���...���¡�����...";
	next;
	if (.@r == 0)
		npctalk "��Ҩ���������...�繪���...", "", bc_self;
	else if (.@r == 1)
		npctalk "���ô...��ҡ�...", "", bc_self;
	else if (.@r == 2)
		npctalk "���ô...", "", bc_self;
	else if (.@r == 3)
		npctalk "������...�Ф�����ͧ...���...������...�ӹ֡�Դ...㹺һ...�����ҷ����...", "", bc_self;
	else
		npctalk "...��ҡ���...", "", bc_self;
	mes "[Victimized Soul's Mind]";
	mes "���ظ����ҹ��...�����仴���...�Ե�ԭ�ҳ...��觤��������...��Ф�����...";
	mes "������...���ѹ...��...��Ҩ�����¹...�ѹ...�� energy...pieces...";
	while(true) {
		next;
		if (checkweight(2677,5) == 0) {
			mes "[Victimized Soul's Mind]";
			mes "��������ͧ�س .. ";
			mes "������� ... ";
			close;
		}
		if (select( "���ͺ���ظ.", "�����ʹ���." ) == 2) {
			mes "[Victimized Soul's Mind]";
			mes "...��Ҩ�...��Ѻ...���Ң��...�ա...";
			close;
		}
		mes "[Victimized Soul's Mind]";
		mes "���͡��Դ...���ظ...������...��ͧ���...����¹ ?...";
		next;
		while(true) {
			switch( select( "��Ѻ价�����١�͹˹��", "Katar", "Bow", "Axe, Mace, Book", "Wand", "Sword, Dagger", "Spear, Two-handed sword", "Musical instrument, Whip, Knuckle" ) ) {
			case 1:
				break;
			case 2:
				callsub S_Exchange,
					1284,	// Krishna
					1290,	// Agent_Katar
					1285,	// Chakram
					1291;	// Guillotine_Katar
				continue;
			case 3:
				callsub S_Exchange,
					18109,	// Catapult
					18110,	// Big_CrossBow
					1745,	// Falken_Blitz
					18103,	// Mystic_Bow
					18111;	// Creeper_Bow
				continue;
			case 4:
				callsub S_Exchange,
					1311,	// Vecer_Axe
					1392,	// Ygnus_Stale
					1393,	// End_Sektura
					16017,	// Bloody_Cross
					16010,	// Red_Ether_Bag
					2161,	// Geffenia_Book_Water
					1584,	// Chilly_Spell_Book
					16000,	// Erde
					16001;	// Red_Square_Bag
				continue;
			case 5:
				callsub S_Exchange,
					2005,	// Dea_Staff
					2004,	// Kronos
					1647,	// Croce_Staff
					1659,	// Recovery_Light
					1646,	// La'cryma_Stick
					1654;	// Mental_Stick
				continue;
			case 6:
				callsub S_Exchange,
					13431,	// Chrome_Sword
					13421,	// Ruber
					13061,	// Black_Wing
					13062,	// Ancient_Dagger
					13070,	// Scarletto_Nail
					13069,	// Aztoe_Nail
					13046,	// Krieg
					13047;	// Weihna
				continue;
			case 7:
				callsub S_Exchange,
					1433,	// Imperial_Spear
					1435,	// Cannon_Spear
					1490,	// Giant_Lance
					1196,	// Chrome_Twohand_Sword
					1189;	// Krasnaya
				continue;
			case 8:
				callsub S_Exchange,
					1930,	// Green_Whistle
					1984,	// Stem_Whip
					1985,	// Rosebine
					1830;	// Sura_Rampage
				continue;
			}
			break;
		}
	}
	end;

S_Exchange:
	.@size = getargcount();
	.@menu$ = "��Ѻ价�����١�͹˹��:";
	for ( .@i = 0; .@i < .@size; .@i++ ) {
		if (countitem(getarg(.@i)) < 1)
			.@menu$ += "^999999����� " + getitemname(getarg(.@i)) + ".^000000:";
		else
			.@menu$ += "����� " + getitemname(getarg(.@i)) + ".:";
	}
	.@s = select(.@menu$) - 2;
	if (.@s == -1)
		return;
	mes "[Victimized Soul's Mind]";
	mes "���...�����͡...���ظ...��觴�����͹��...���仴���...�Ե�ԭ�ҳ...��Ҩ�...����������¹�ѹ...�� Energy Fragments...���...��繴������ ?";
	next;
	if (select( "�����繴���.", "����� Energy Fragments." ) == 2) {
		if (countitem(getarg(.@s)) < 1) {
			mes "[Victimized Soul's Mind]";
			mes "������...��...^006400" + getitemname(getarg(.@s)) + "^000000...";
			mes "�����...�������áѺ���...�ա��� ?...";
			next;
			return;
		}
		donpcevent strnpcinfo(0) + "::OnBar";
		sleep2 5000;
		specialeffect EF_BLACKBODY;
		specialeffect EF_GUMGANG4;
		specialeffect EF_DARKCASTING2;
		specialeffect EF_RG_COIN7;
		percentheal -50,-50;
		specialeffect2 EF_POISONSMOKE;
		specialeffect2 EF_NPC_BURNT;
		delitem getarg(.@s),1;
		.@r = rand(100);
		if (.@r < 70)
			.@amount = 1;
		else if (.@r < 90)
			.@amount = 2;
		else
			.@amount = 3;
		getitem 6820, .@amount;// Energy Fragment
		mes "[Victimized Soul's Mind]";
		mes "��������ҧ...Energy...Fragment...�ҡ ^006400" + getitemname(getarg(.@s)) + "^000000...";
		next;
		mes "- ������Ѻ��������������ҧ˹ѡ - - �¤��蹾�ѧ�ҹ - - ���������ҧ��¢ͧ���. -";
		next;
	}
	mes "[Victimized Soul's Mind]";
	mes "�����...�������áѺ���...�ա��� ?...";
	next;
	return;

OnBar:
	progressbar_npc "000000",5;
	end;
}

lhz_dun_n,136,269,6	script	Sorrowful Soul's Mind#1	4_M_DEATH,{
	disable_items;
	.@r = rand(5);
	if (.@r == 0)
		npctalk "���...�ѹ��...", "", bc_self;
	else if (.@r == 1)
		npctalk "�ǡ��ҷء��...�ŧ�á��...", "", bc_self;
	else if (.@r == 2)
		npctalk "����������. ����...�֧�繢�� ?...", "", bc_self;
	else if (.@r == 3)
		npctalk "���...������...��������Ѻ...", "", bc_self;
	else
		npctalk "�ǡ��ҷء��...��ͻ��Ҩ...", "", bc_self;
	mes "[Sorrowful Soul's Mind]";
	mes "�Ե...�ԭ�ҳ...�ѹ�ҡ���...";
	mes "ʹյ...�Ѩ�غѹ...��С������...";
	next;
	if (.@r == 0)
		npctalk "���㨢ͧ���...�纻Ǵ�Թ�...", "", bc_self;
	else if (.@r == 1)
		npctalk "���...��...������...", "", bc_self;
	else if (.@r == 2)
		npctalk "���...��������������...������������������.", "", bc_self;
	else if (.@r == 3)
		npctalk "��ҤԴ���...��Ҩ��ժ��Ե�ʹ...��ѧ�ҡ�����ҷ����稷ء���ҧ�� ?...", "", bc_self;
	else
		npctalk "�������������ͧ...���...�����������Ѻ�ѹ...", "", bc_self;
	mes "[Sorrowful Soul's Mind]";
	mes "��Ҥ���� ?...";
	mes "�������ö...������ҨԵ�ԭ�ҳ...���ء����ҹ...�ҡ���������������� ?...";
	next;
	if (.@r == 0)
		npctalk "�����ҡ...��Ѻ...��ҹ...", "", bc_self;
	else if (.@r == 1)
		npctalk "��Ҩ�...�һ�����...������...��Ҩе�������...", "", bc_self;
	else if (.@r == 2)
		npctalk "��������...����...", "", bc_self;
	else if (.@r == 3)
		npctalk "��ҡ��ѧ�Դ...�������� ?...", "", bc_self;
	else
		npctalk "���...�������...�����...��ͺ���� ?...", "", bc_self;
	mes "[Sorrowful Soul's Mind]";
	mes "������...����ö...���ѹ��...�������ö...���...���...����...����...�����ҵ�ͧ���...";
	next;
	setarray .@item_name$[0],
		getitemname(18971),	// Old_Rune_Circlet
		getitemname(18972),	// Old_Mitra
		getitemname(18973),	// Old_Driver_Band_R
		getitemname(18974),	// Old_Driver_Band_Y
		getitemname(18975),	// Old_Shadow_Handicraft
		getitemname(18976),	// Old_Minstrel_Song_Hat
		getitemname(18977),	// Old_Midas_Whisper
		getitemname(18978),	// Old_Magic_Stone_Hat
		getitemname(18979),	// Old_Blazing_Soul
		getitemname(18980),	// Old_Wind_Whisper
		getitemname(18981),	// Old_Dying_Swan
		getitemname(18984),	// Old_Camo_RabbitHood
		getitemname(18982),	// Old_Circlet_Of_Bone
		getitemname(18983),	// Old_Protect_Of_Crown
		getitemname(20749);	// Cloak of the Fallen Soldier[1]
	while(true) {
		if (checkweight(2677,5) == 0) {
			mes "[Sorrowful Soul's Mind]";
			mes "��������ͧ�س .. ";
			mes "������� ... ";
			close;
		}
		if (select( "���ͺ soul.", "�����ʹ���." ) == 2) {
			mes "[Sorrowful Soul's Mind]";
			mes "...��Ҩ���...���...��Ѻ��...�Ң���ա����...";
			close;
		}
		mes "[Sorrowful Soul's Mind]";
		mes "���������ͺ...����� soul ��...��Ҩ����ҧ�ͧ�ҧ���ҧ...������仴���...��ѧ�����..�������Ҵ��¡ѹ...";
		mes "���...��ͧ���...���� ?...";
		while(true) {
			next;
			switch( select( "��Ѻ价�����١�͹˹��", .@item_name$[0], .@item_name$[1], .@item_name$[2], .@item_name$[3], .@item_name$[4], .@item_name$[5], .@item_name$[6], .@item_name$[7], .@item_name$[8], .@item_name$[9], .@item_name$[10], .@item_name$[11], .@item_name$[12], .@item_name$[13], .@item_name$[14] + "[1]" ) ) {
			case 1:
				break;
			case 2:
				mes "- " + .@item_name$[0] + " -";
				mes "^006400���������������ö�š����¹�Ѻ�ͤ��ҷ������.^000000";
				mes "^006400All State + 1, MDEF+ 5^000000";
				mes "^006400���� ATK + 4 ��� 1 ����ŵպǡ^000000";
				mes "^006400���� ASPD + 1 ��� 5 ����ŵպǡ^000000";
				mes "^006400���� MHP, MSP ��� 1% �ء 2 ����ŵպǡ^000000";
				mes "^006400���� �����ç Ignition Break ��� 20%^000000";
				mes "^006400��� 2 ����ŵպǡ^000000";
				mes "^006400���� �����ç Hundred Spear ��� 15%^000000";
				mes "^006400��� 2 ����ŵպǡ^000000";
				mes "^006400������: ��ǡ ��ͧ�ѹ: 10^000000";
				mes "^006400���˹�: ��ǹ�� ���˹ѡ: 10^000000";
				mes "^006400��ͧ��ҧ: 1^000000";
				mes "^006400��ͧ��������: 170 �Ҫվ: Rune Knight^000000";
				callsub S_Make,
					18971,	// Old_Rune_Circlet
					19961,	// C_Rune_Circlet
					6814;	// Swordman_Soul
				continue;
			case 3:
				mes "- " + .@item_name$[1] + " -";
				mes "^006400���������������ö�š����¹�Ѻ�ͤ��ҷ������.^000000";
				mes "^006400All State + 1, MDEF+ 5^000000";
				mes "^006400���� MATK + 2, ATK + 4, Heal Amount + 2% ��� 1 ����ŵպǡ.^000000";
				mes "^006400���� MHP, MSP ��� 1% �ء 2 ����ŵպǡ^000000";
				mes "^006400���� �����ç Judex ��� 20% ��� 2 ����ŵպǡ.^000000";
				mes "^006400���� �����ç Magnus Exorcismus ��� 10% ��� 2 ����ŵպǡ.^000000";
				mes "^006400������: ��ǡ ��ͧ�ѹ: 10^000000";
				mes "^006400���˹�: ��ǹ�� ���˹ѡ: 10^000000";
				mes "^006400��ͧ��ҧ: 1^000000";
				mes "^006400��ͧ��������: 170 �Ҫվ: Archbishop^000000";
				callsub S_Make,
					18972,	// Old_Mitra
					19962,	// C_Mitra
					6819;	// Acolyte_Soul
				continue;
			case 4:
				mes "- " + .@item_name$[2] + " -";
				mes "^006400���������������ö�š����¹�Ѻ�ͤ��ҷ������.^000000";
				mes "^006400All State + 1^000000";
				mes "^006400���� ATK + 4 ��� 1 ����ŵպǡ^000000";
				mes "^006400���� ASPD + 1 ��� 5 ����ŵպǡ^000000";
				mes "^006400���� MHP, MSP ��� 1% �ء 2 ����ŵպǡ^000000";
				mes "^006400���� �����ç Power Swing ��� 20% ��� 2 ����ŵպǡ.^000000";
				mes "^006400���� �����ç Axe Tornado ��� 20% ��� 2 ����ŵպǡ.^000000";
				mes "^006400������: ��ǡ ��ͧ�ѹ: 10^000000";
				mes "^006400���˹�: ��ǹ�� ���˹ѡ: 10^000000";
				mes "^006400��ͧ��ҧ: 1^000000";
				mes "^006400��ͧ��������: 170 �Ҫվ: Mechanic^000000";
				callsub S_Make,
					18973,	// Old_Driver_Band_R
					19963,	// C_Driver_Band_R
					6815;	// Merchant_Soul
				continue;
			case 5:
				mes "- " + .@item_name$[3] + " -";
				mes "^006400���������������ö�š����¹�Ѻ�ͤ��ҷ������.^000000";
				mes "^006400All State + 1^000000";
				mes "^006400���� ATK + 4 ��� 1 ����ŵպǡ^000000";
				mes "^006400���� ASPD + 1 ��� 5 ����ŵպǡ^000000";
				mes "^006400���� MHP, MSP ��� 1% �ء 2 ����ŵպǡ^000000";
				mes "^006400���� �����ç Arm Cannon ��� 5% ��� 2 ����ŵպǡ.^000000";
				mes "^006400Ŵ ��Ŵ�ǹ� Suicidal Destruction ŧ 10 �Թҷ� ��� 4 ����ŵպǡ.^000000";
				mes "^006400������: ��ǡ ��ͧ�ѹ: 10^000000";
				mes "^006400���˹�: ��ǹ�� ���˹ѡ: 10^000000";
				mes "^006400��ͧ��ҧ: 1^000000";
				mes "^006400��ͧ��������: 170 �Ҫվ: Mechanic^000000";
				callsub S_Make,
					18974,	// Old_Driver_Band_Y
					19964,	// C_Driver_Band_Y
					6815;	// Merchant_Soul
				continue;
			case 6:
				mes "- " + .@item_name$[4] + " -";
				mes "^006400���������������ö�š����¹�Ѻ�ͤ��ҷ������.^000000";
				mes "^006400All State + 1^000000";
				mes "^006400���� ATK + 4, MATK + 4 �ء ����ŵպǡ.^000000";
				mes "^006400���� MHP, MSP ��� 1% �ء 2 ����ŵպǡ^000000";
				mes "^006400���� �����ç Triangle Shot ��� 25% ��� 2 ����ŵպǡ.^000000";
				mes "^006400Ŵ ��Ŵ�ǹ� Masquerade-unlock key, Enervation ŧ 1 �Թҷ� ���������ŵպǡ�֧ 6.^000000";
				mes "^006400Ŵ ��Ŵ�ǹ� Masquerade-Laziness, Weakness ŧ 1 �Թҷ� ���������ŵպǡ�֧ 8.^000000";
				mes "^006400Ŵ ��Ŵ�ǹ� Masquerade-Ignorance, Gloomy ŧ 1 �Թҷ� ���������ŵպǡ�֧ 10.^000000";
				mes "^006400������: ��ǡ ��ͧ�ѹ: 10^000000";
				mes "^006400���˹�: ��ǹ�� ���˹ѡ: 10^000000";
				mes "^006400��ͧ��ҧ: 1^000000";
				mes "^006400��ͧ��������: 170 �Ҫվ: Shadow_Chaser^000000";
				callsub S_Make,
					18975,	// Old_Shadow_Handicraft
					19965,	// C_Shadow_Handicraft
					6816;	// Thief_Soul
				continue;
			case 7:
				mes "- " + .@item_name$[5] + " -";
				mes "^006400���������������ö�š����¹�Ѻ�ͤ��ҷ������.^000000";
				mes "^006400All State + 1^000000";
				mes "^006400���� �����ç ranged physical ��� 1% �ء ����ŵպǡ.^000000";
				mes "^006400���� MHP, MSP ��� 1% �ء 2 ����ŵպǡ^000000";
				mes "^006400���� �����ç Arrow Vulcan ��� 20% ��� 2 ����ŵպǡ.^000000";
				mes "^006400���� �����ç Severe Rainstorm ��� 5% ��� 2 ����ŵպǡ.^000000";
				mes "^006400������: ��ǡ ��ͧ�ѹ: 10^000000";
				mes "^006400���˹�: ��ǹ�� ���˹ѡ: 10^000000";
				mes "^006400��ͧ��ҧ: 1^000000";
				mes "^006400��ͧ��������: 170 �Ҫվ: Minstrel^000000";
				callsub S_Make,
					18976,	// Old_Minstrel_Song_Hat
					19966,	// C_Minstrel_Song_Hat
					6818;	// Archer_Soul
				continue;
			case 8:
				mes "- " + .@item_name$[6] + " -";
				mes "^006400���������������ö�š����¹�Ѻ�ͤ��ҷ������.^000000";
				mes "^006400All State + 1^000000";
				mes "^006400���� ATK + 4 ��� 1 ����ŵպǡ^000000";
				mes "^006400���� ranged physical ��� 1% ��� 2 ����ŵպǡ.^000000";
				mes "^006400���� MHP, MSP ��� 1% �ء 2 ����ŵպǡ^000000";
				mes "^006400���� �����ç Cart Cannon ��� 15% ��� 2 ����ŵպǡ.^000000";
				mes "^006400������: ��ǡ ��ͧ�ѹ: 10^000000";
				mes "^006400���˹�: ��ǹ�� ���˹ѡ: 10^000000";
				mes "^006400��ͧ��ҧ: 1^000000";
				mes "^006400��ͧ��������: 170 �Ҫվ: Generic^000000";
				callsub S_Make,
					18977,	// Old_Midas_Whisper
					19967,	// C_Midas_Whisper
					6815;	// Merchant_Soul
				continue;
			case 9:
				mes "- " + .@item_name$[7] + " -";
				mes "^006400���������������ö�š����¹�Ѻ�ͤ��ҷ������.^000000";
				mes "^006400All State + 1 MDEF+ 5^000000";
				mes "^006400���� SP regen ��� 20%.^000000";
				mes "^006400���� MATK + 1% �ء ����ŵպǡ.^000000";
				mes "^006400���� MHP, MSP ��� 1% �ء 2 ����ŵպǡ^000000";
				mes "^006400���� �����ç Soul Expansion ��� 5% ��� 2 ����ŵպǡ.^000000";
				mes "^006400Ŵ ��Ŵ�ǹ� Crimson Rock ŧ 1 �Թҷ�.^000000";
				mes "^006400Ŵ ��Ŵ�ǹ� Crimson Rock ŧ 0.1 �ء ����ŵպǡ.^000000";
				mes "^006400������: ��ǡ ��ͧ�ѹ: 10^000000";
				mes "^006400���˹�: ��ǹ�� ���˹ѡ: 10^000000";
				mes "^006400��ͧ��ҧ: 1^000000";
				mes "^006400��ͧ��������: 170 �Ҫվ: Warlock^000000";
				callsub S_Make,
					18978,	// Old_Magic_Stone_Hat
					19968,	// C_Magic_Stone_Hat
					6817;	// Mage_Soul
				continue;
			case 10:
				mes "- " + .@item_name$[8] + " -";
				mes "^006400���������������ö�š����¹�Ѻ�ͤ��ҷ������.^000000";
				mes "^006400All State + 1^000000";
				mes "^006400���� ATK + 4, CRI + 2 �ء ����ŵպǡ.^000000";
				mes "^006400���� MHP, MSP ��� 1% �ء 2 ����ŵպǡ^000000";
				mes "^006400���� �����ç Rampage Blaster ��� 15% ��� 2 ����ŵպǡ.^000000";
				mes "^006400���� �����ç Lightning Shot ��� 20% ��� 2 ����ŵպǡ.^000000";
				mes "^006400������: ��ǡ ��ͧ�ѹ: 10^000000";
				mes "^006400���˹�: ��ǹ�� ���˹ѡ: 10^000000";
				mes "^006400��ͧ��ҧ: 1^000000";
				mes "^006400��ͧ��������: 170 �Ҫվ: Sura^000000";
				callsub S_Make,
					18979,	// Old_Blazing_Soul
					19969,	// C_Blazing_Soul
					6819;	// Acolyte_Soul
				continue;
			case 11:
				mes "- " + .@item_name$[9] + " -";
				mes "^006400���������������ö�š����¹�Ѻ�ͤ��ҷ������.^000000";
				mes "^006400All State + 1 MDEF+ 5.^000000";
				mes "^006400���� MATK + 1%, ATK + 4 �ء ����ŵպǡ.^000000";
				mes "^006400���� MHP, MSP ��� 1% �ء 2 ����ŵպǡ^000000";
				mes "^006400���� �����ç Poison Burst ��� 15% ��� 2 ����ŵպǡ.^000000";
				mes "^006400���� �����ç Varetyr Spear ��� 20% ��� 2 ����ŵպǡ.^000000";
				mes "^006400������: ��ǡ ��ͧ�ѹ: 10^000000";
				mes "^006400���˹�: ��ǹ�� ���˹ѡ: 10^000000";
				mes "^006400��ͧ��ҧ: 1^000000";
				mes "^006400��ͧ��������: 170 �Ҫվ: Sorcerer^000000";
				callsub S_Make,
					18980,	// Old_Wind_Whisper
					19970,	// C_Wind_Whisper
					6817;	// Mage_Soul
				continue;
			case 12:
				mes "- " + .@item_name$[10] + " -";
				mes "^006400���������������ö�š����¹�Ѻ�ͤ��ҷ������.^000000";
				mes "^006400All State + 1^000000";
				mes "^006400���� ranged physical ��� 1% �ء ����ŵպǡ.^000000";
				mes "^006400���� MHP, MSP ��� 1% �ء 2 ����ŵպǡ^000000";
				mes "^006400���� �����ç Arrow Vulcan ��� 20% ��� 2 ����ŵպǡ.^000000";
				mes "^006400���� �����ç Severe Rainstorm ��� 5% ��� 2 ����ŵպǡ.^000000";
				mes "^006400������: ��ǡ ��ͧ�ѹ: 10^000000";
				mes "^006400���˹�: ��ǹ�� ���˹ѡ: 10^000000";
				mes "^006400��ͧ��ҧ: 1^000000";
				mes "^006400��ͧ��������: 170 �Ҫվ: Wanderer^000000";
				callsub S_Make,
					18981,	// Old_Dying_Swan
					19971,	// C_Dying_Swan
					6818;	// Archer_Soul
				continue;
			case 13:
				mes "- " + .@item_name$[11] + " -";
				mes "^006400���������������ö�š����¹�Ѻ�ͤ��ҷ������.^000000";
				mes "^006400All State + 1^000000";
				mes "^006400���� ranged physical ��� 1% �ء ����ŵպǡ.^000000";
				mes "^006400Complete evasion +1 ��� 3 ����ŵպǡ.^000000";
				mes "^006400���� MHP, MSP ��� 1% �ء 2 ����ŵպǡ^000000";
				mes "^006400���� �����ç Cluster Bomb ��� 15% ��� 2 ����ŵպǡ.^000000";
				mes "^006400���� �����ç Warg Strike ��� 10% ��� 2 ����ŵպǡ.^000000";
				mes "^006400������: ��ǡ ��ͧ�ѹ: 10^000000";
				mes "^006400���˹�: ��ǹ�� ���˹ѡ: 10^000000";
				mes "^006400��ͧ��ҧ: 1^000000";
				mes "^006400��ͧ��������: 170 �Ҫվ: Ranger^000000";
				callsub S_Make,
					18984,	// Old_Camo_RabbitHood
					19974,	// C_Camouflage_RabbitHood
					6818;	// Archer_Soul
				continue;
			case 14:
				mes "- " + .@item_name$[12] + " -";
				mes "^006400���������������ö�š����¹�Ѻ�ͤ��ҷ������.^000000";
				mes "^006400All State + 1^000000";
				mes "^006400���� �����ç critical ��� 1% ��� attack speed �ء ����ŵպǡ (Ŵ attack delay 1%)^000000";
				mes "^006400���� MHP, MSP ��� 1% �ء 2 ����ŵպǡ^000000";
				mes "^006400���� �����ç Cross Impact ��� 10% ��� 2 ����ŵպǡ.^000000";
				mes "^006400���� �����ç Cross Reaper Slash ��� 20% ��� 2 ����ŵպǡ.^000000";
				mes "^006400������: ��ǡ ��ͧ�ѹ: 10^000000";
				mes "^006400���˹�: ��ǹ�� ���˹ѡ: 10^000000";
				mes "^006400��ͧ��ҧ: 1^000000";
				mes "^006400��ͧ��������: 170 �Ҫվ: Guillotine_Cross^000000";
				callsub S_Make,
					18982,	// Old_Circlet_Of_Bone
					19973,	// C_Circlet_Of_Bone
					6816;	// Thief_Soul
				continue;
			case 15:
				mes "- " + .@item_name$[13] + " -";
				mes "^006400���������������ö�š����¹�Ѻ�ͤ��ҷ������.^000000";
				mes "^006400All State + 1 MDEF+ 5.^000000";
				mes "^006400���� ATK + 4 ��� 1 ����ŵպǡ^000000";
				mes "^006400���� ASPD + 1 ��� 5 ����ŵպǡ^000000";
				mes "^006400���� MHP, MSP ��� 1% �ء 2 ����ŵպǡ^000000";
				mes "^006400���� �����ç Cannon Spear ��� 20% ��� 2 ����ŵպǡ.^000000";
				mes "^006400���� �����ç Over Brand ��� 5% ��� 2 ����ŵպǡ.^000000";
				mes "^006400������: ��ǡ ��ͧ�ѹ: 10^000000";
				mes "^006400���˹�: ��ǹ�� ���˹ѡ: 10^000000";
				mes "^006400��ͧ��ҧ: 1^000000";
				mes "^006400��ͧ��������: 170 �Ҫվ: Royal Guard^000000";
				callsub S_Make,
					18983,	// Old_Protect_Of_Crown
					19972,	// C_Protect_Of_Crown
					6814;	// Swordman_Soul
				continue;
			case 16:
				mes "- " + .@item_name$[14] + "[1] -";
				mes "^006400��Ҥ���㹵ӹҹ������դ�������^000000 ^006400㹡�õ��������ҧ�����ҭ��ж١��ҵ���ʹ��ú.";
				mes "���� MHP, MSP ��� 1% ��� 2 ����ŵպǡ";
				mes "ATK + 10 ����͵���Ф��դ�� STR ��ԧ �֧ 90.";
				mes "(���� ATK + 2 �ء ����ŵպǡ)";
				mes "MATK + 20 ����͵���Ф��դ�� INT ��ԧ �֧ 90.";
				mes "(���� MATK + 3 �ء ����ŵպǡ)";
				mes "����͵���Ф��դ�� VIT ��ԧ �֧ 90";
				mes "3% ��Ҥ�����ҹ�ҹ��͡�����ջ���";
				mes "(���� 3% ���������ŵպǡ�֧ 8,";
				mes "���� 4% ���������ŵպǡ�֧ 10)";
				mes "����͵���Ф��դ�� AGI ��ԧ �֧ 90";
				mes "���� attack speed (3% attack delay reduction)";
				mes "(Attack delay Ŵŧ 1% ��� 2 ����ŵպǡ)";
				mes "(���� ASPD + 1 ���������ŵպǡ�֧ 10.)";
				mes "����͵���Ф��դ�� DEX ��ԧ �֧ 90";
				mes "���� ranged attack power ��� 3%";
				mes "(���� 1% ��� 2 ����ŵպǡ)";
				mes "����͵���Ф��դ�� LUK ��ԧ �֧ 90";
				mes "���� �����ç critical ��� 5%.";
				mes "(���� 1% �ء ����ŵպǡ)";
				mes "������: ��Ҥ��� ��ͧ�ѹ: 30";
				mes "���˹ѡ: 60";
				mes "��ͧ��ҧ: 1";
				mes "��ͧ��������: 170 �Ҫվ: ������^000000";
				callsub S_Make,
					20749,	// Manteau_Of_Fallen_
					20748,	// Manteau_Of_Fallen
					6471,	// Goast_Chill
					true;
				continue;
			}
			break;
		}
	}

S_Make:
	.@reward_id = getarg(0);
	.@equipment_req = getarg(1);
	.@item_misc_req = getarg(2);
	if (getarg(3,0)) {
		setarray .@string$[0], "chill", "cloak";
		setarray .@material[0],20,100;	// chill, energy
	}
	else {
		setarray .@string$[0], "soul", "hat";
		setarray .@material[0],1,20;	// soul, energy
	}
	next;
	mes "[Sorrowful Soul's Mind]";
	mes "���ͷ��з�...^006400" + getitemname(.@reward_id) + "^000000...";
	mes "��...����� " + .@string$[0] + ", " + .@string$[1] + "...���ǹ���¹...����㹷������仴���...��ѧ�ҹ�״��...";
	next;
	mes "[Sorrowful Soul's Mind]";
	mes "��ҵ�ͧ��� 1 " + getitemname(.@equipment_req) + ", " + .@material[0] + " " + getitemname(.@item_misc_req) + "..." + .@material[1] + " " + getitemname(6820) + "..";
	mes "��������� " + getitemname(6820) + " ��� " + .@string$[0] + "�� 5 ���...���...������������...";
	mes "���...�з�...Ẻ�˹ ?";
	next;
	switch( select( "��Ѻ价�����١�͹˹��", "�� " + .@material[1] + " energies, " + .@material[0] + " " + .@string$[0], "�� " + (.@material[1] * 5) + " energies, " + (.@material[0] * 5) + " " + .@string$[0] + "s" ) ) {
	case 1:
		mes "[Sorrowful Soul's Mind]";
		mes "�����ѧ���...�������ö...��...������ �...���蹡ѹ...";
		return;
	case 2:
		.@rate = 1;
		break;
	case 3:
		.@rate = 5;
		break;
	}
	if (countitem(.@equipment_req) < 1 || countitem(.@item_misc_req) < (.@material[0] * .@rate) || countitem(6820) < (.@material[1] * .@rate)) {
		mes "[Sorrowful Soul's Mind]";
		mes "������...��...�ѵ�شԺ��...���з�...^006400" + getitemname(.@reward_id) + "^000000...";
		return;
	}
	progressbar "000000",5;
	percentheal -50,-50;
	specialeffect2 EF_POISONSMOKE;
	specialeffect2 EF_NPC_BURNT;
	delitem .@equipment_req, 1;
	delitem .@item_misc_req, (.@material[0] * .@rate);
	delitem 6820, (.@material[1] * .@rate);// Energy Fragment

	if ((20*.@rate) > rand(100)) {
		specialeffect EF_BLACKBODY;
		specialeffect EF_GUMGANG4;
		specialeffect EF_DARKCASTING2;
		specialeffect EF_RG_COIN7;
		mes "[Sorrowful Soul's Mind]";
		mes "����...^006400" + getitemname(.@reward_id) + "^000000...";
		getitem .@reward_id,1;
	}
	else {
		specialeffect EF_POISONSMOKE;
		specialeffect EF_GUMGANG4;
		mes "[Sorrowful Soul's Mind]";
		mes "^006400" + getitemname(.@reward_id) + "^000000... �������...";
	}
	next;
	mes "- ������Ѻ��������������ҧ˹ѡ - - �¤��蹾�ѧ�ҹ - - ���������ҧ��¢ͧ���. -";
	next;
	mes "[Sorrowful Soul's Mind]";
	mes "������...�����...�ͨЪ���...�������� ?...";
	return;
}

// Exchange npcs - safe map (no mobs)
lhz_d_n2,53,49,4	duplicate(Silent Mind#JCv2)	Silent Mind#JCv2C	4_CENERE
lhz_d_n2,42,49,2	duplicate(Wandering Mind#JCv2)	Wandering Mind#JCv2C	4_CENERE
lhz_d_n2,51,53,4	duplicate(Victimized Soul's Mind#1)	Victimized Soul's Mind#1C	4_M_DEATH2
lhz_d_n2,44,53,6	duplicate(Sorrowful Soul's Mind#1)	Sorrowful Soul's Mind#1C	4_M_DEATH

// Safe map - Exit
lhz_d_n2,34,45,3	script	#lhzdw	1_SHADOW_NPC,{
	mes "[Bastets]";
	mes "�������ö��繷ҧ�͡��.";
	next;
	if (select( "��Ѻ价�� Lighthalzen.", "�ѧ����Ѻ." ) == 1)
		warp "lighthalzen",310,228;
	end;
}

// Heal
lhz_dun_n,167,259,2	script	A Questionable Device#l	4_SYSTEM_BOX,3,3,{
	if (isbegin_quest(14683) == 1) {
		mes "[System Message]";
		mes "��ⵤ�� �ء�Թ �Դ��ҹ. ����������ö�Թ����ͧ RT-223 ��.";
		next;
		if (select( "����Թ����ͧ.", "�Թ����ͧ." ) == 2) {
			mes "[System Message]";
			mes "�ء����û�ԺѵԵ�����ء�Թ.";
			close;
		}
		specialeffect EF_MAPPILLAR;
		mes "[System Message]";
		mes "�����蹡��ѧ�Թ����ͧ RT-223. �����ᵹ���¨��Դ��ҹ��ѧ�ҡ��鹵͹���.";
		specialeffect2 EF_BABY;
		percentheal 100,100;
		completequest 14683;// Mysterious Device
		close;
	}
	end;

OnTouch:
	npctalk "�ء����û�ԺѵԵ�����ء�Թ.", "", bc_self;
	end;

OnInit:
	questinfo( QTYPE_QUEST, QMARK_YELLOW, "isbegin_quest(14683) == 1" );
	end;
}

// Misc
lhz_dun_n,75,121,0	script	#Alphoccio_Basil_A1	HIDDEN_WARP_NPC,3,3,{
	end;
OnTouch:
	specialeffect EF_BAT2;
	disablenpc strnpcinfo(0);
	initnpctimer;
	end;
OnTimer1000:
	.@npc_name$ = strnpcinfo(0);
	if (.@npc_name$ == "#Alphoccio_Basil_A1") {
		.@talker_name$ = "#lhz_dun_talk_A23"; 
		switch (rand(5)) {
			case 0:  .@msg$ = "�繤����Դ��Ҵ�ͧ�ѹ���Դ��ҹ����������Թ�ҧ..."; break;
			case 1:  .@msg$ = "��...�����..��ѧ����..."; break;
			case 2:  .@msg$ = "�ǡ�ҷ����������������?..������ͧ��Ẻ���.."; break;
			case 3:  .@msg$ = "�ѹ���Թ���§�ŧ������§�ŧ..���������..."; break;
			default:  .@msg$ = "�ѹ�������˹..�շҧ�͡�������.."; break;
		}
	}
	else if (.@npc_name$ == "#Alphoccio_Basil_A2") {
		.@talker_name$ = "#lhz_dun_talk_A24";
		switch (rand(5)) {
			case 0:  .@msg$ = "�ѹ�Դ�����Ҩз��ŧ����Թ�ҧ�ͺ�š���ʹ�..."; break;
			case 1:  .@msg$ = "����Ӥѭ�����Ҩ��������˹㹢�з��س�������ѹ..."; break;
			case 2:  .@msg$ = "Trentini...�س�������˹..."; break;
			case 3:  .@msg$ = "���§�ͧ�ŧ���ѧ�ҧ����..."; break;
			default:  .@msg$ = "���ǵ͹���...��������������ѹ��ҧ.."; break;
		}
	}
	else if (.@npc_name$ == "#Catherine Cheiron_A1") {
		.@talker_name$ = "#lhz_dun_talk_A5";
		switch (rand(5)) {
			case 0:  .@msg$ = "�ѹ������Ѻ����š�ҡ..."; break;
			case 1:  .@msg$ = "Sob sob...Somebody...Please.."; break;
			case 2:  .@msg$ = "˹�Ǩѧ...�����...��⡴ѧ��������.."; break;
			case 3:  .@msg$ = "���§�ͧ�ѹ...������͡��..."; break;
			default:  .@msg$ = "���͹...�ѹ����..."; break;
		}
	}
	else if (.@npc_name$ == "#Katrinn Chiron_A2") {
		.@talker_name$ = "#lhz_dun_talk_A6";
		switch (rand(5)) {
			case 0:  .@msg$ = "����ù...�������˹..."; break;
			case 1:  .@msg$ = "�����纻Ǵ...�����״...�ѹ����..."; break;
			case 2:  .@msg$ = "�Ƿ��������ҡ�ҡ����Ѻ�ѹ�������¹���͹����ѹ������ª��..."; break;
			case 3:  .@msg$ = "�ǡ��������������..."; break;
			default:  .@msg$ = "���͹...�״�Թ�..."; break;
		}
	}
	else if (.@npc_name$ == "#Celia_Alde_A1") {
		.@talker_name$ = "#lhz_dun_talk_A17";
		switch (rand(5)) {
			case 0:  .@msg$ = "��...��������...���������..."; break;
			case 1:  .@msg$ = "�ѹ��������ҩѹ����ö�͡�������..."; break;
			case 2:  .@msg$ = "�Ե�ԭ�ҳ�����ʧ��÷����...�Ҩ��..."; break;
			case 3:  .@msg$ = "����ѹ�������...�ѹ���Դ������ѧ�..?"; break;
			default:  .@msg$ = "���...����ѹ�Թ��������ö㹡����������ͧ�ѹ...��������..."; break;
		}
	}
	else if (.@npc_name$ == "#Celia_Alde_A2") {
		.@talker_name$ = "#lhz_dun_talk_A18";
		switch (rand(4)) {
			case 0:  .@msg$ = "�����������...�������..."; break;
			case 1:  .@msg$ = "My...survival...and escape...analyzis results..."; break;
			case 2:  .@msg$ = "Where...what...No, no...Never..."; break;
			default:  .@msg$ = "�ѹ��ҡ�͡仨ҡ�����������Ƿ���ش..."; break;
		}
	}
	else if (.@npc_name$ == "#Chen_Liu_A1") {
		.@talker_name$ = "#lhz_dun_talk_A19";
		switch (rand(5)) {
			case 0:  .@msg$ = "��Ǣͧ�ѹ����֡�š �..."; break;
			case 1:  .@msg$ = "ʶҹ����������͹�Ѻ��ͧ��Թ���١�����ҧ..."; break;
			case 2:  .@msg$ = "���ŷ��˹��͡...������..."; break;
			case 3:  .@msg$ = "�ѹ���ѧ�����µ��..."; break;
			default:  .@msg$ = "�ѹ�繾��...���᷹��觡��ŧ�ɨҡ���ä�..."; break;
		}
	}
	else if (.@npc_name$ == "#Chen_Liu_A2") {
		.@talker_name$ = "#lhz_dun_talk_A20";
		switch (rand(4)) {
			case 0:  .@msg$ = "�˹�Ңͧ�ѵ��...��蹤���˹�Ңͧ���͹�����ҹ..."; break;
			case 1:  .@msg$ = "St Capitolina Abbey...�ѧ�էҹ����ͧ��..."; break;
			case 2:  .@msg$ = "�Ţͧ�ѹ�١���...�ǡ�ҷ��������ѹ���ҧ.."; break;
			default:  .@msg$ = "��ѧ�ѡ����Է���...��ѧ�..."; break;
		}
	}
	else if (.@npc_name$ == "#Eremes_Guille_A1") {
		.@talker_name$ = "#lhz_dun_talk_A7";
		switch (rand(5)) {
			case 0:  .@msg$ = "�����价������Ҫ��Ե�ʹ..."; break;
			case 1:  .@msg$ = "�ѹạ�ʹ���µԹ�ѹ��ͧ�ʹ!.."; break;
			case 2:  .@msg$ = "���������...����áԨ..."; break;
			case 3:  .@msg$ = "�ҧ�͡���������...������..."; break;
			default:  .@msg$ = "���������...�١�ҧἹ���ҧ�ԶվԶѹ��͹..."; break;
		}
	}
	else if (.@npc_name$ == "#Eremes_Guille_A2") {
		.@talker_name$ = "#lhz_dun_talk_A8";
		switch (rand(5)) {
			case 0:  .@msg$ = "Katrinn �������...�ѹ��ͧ����ͧ..."; break;
			case 1:  .@msg$ = "�ѹ��ͧ����áԨ��������...����觢ͧ�ѹ..."; break;
			case 2:  .@msg$ = "Assasin Guild �ͩѹ..."; break;
			case 3:  .@msg$ = "�ѹ�����ҡ�����������ҩѹ��������ҧ�蹹��..."; break;
			default:  .@msg$ = "�ǧ�Ңͧ�ѹ���...�ѹ�����ҹ..."; break;
		}
	}
	else if (.@npc_name$ == "#Flamel_Emule_A1") {
		.@talker_name$ = "#lhz_dun_talk_A15";
		switch (rand(5)) {
			case 0:  .@msg$ = "�ѹ���������֡���˹�ҧ�ҡ�͹..."; break;
			case 1:  .@msg$ = "Celia...�ѹ����..."; break;
			case 2:  .@msg$ = "��ҧ��¢ͧ�ѹ���仴���������繨ҡ��ü�ҵѴ..."; break;
			case 3:  .@msg$ = "������û�ҡ����...�������...�����..."; break;
			default:  .@msg$ = "�ѹ����..."; break;
		}
	}
	else if (.@npc_name$ == "#Flamel_Emule_A2") {
		.@talker_name$ = "#lhz_dun_talk_A16";
		switch (rand(5)) {
			case 0:  .@msg$ = "��ͺ���Ǣͧ�ѹ...�ѡ�ѹ����ʵ��...�е�ͧ�Ѻ���..."; break;
			case 1:  .@msg$ = "�ѹ����֡����͹...ʵԢͧ�ѹ...������ǩѹ�ա����..."; break;
			case 2:  .@msg$ = "ʵԢͧ�ѹ...���ѧ���͹�ҧ..."; break;
			case 3:  .@msg$ = "�͹�����ѧ���������..."; break;
			default:  .@msg$ = "��ҧ��¢ͧ�ѹ...����...����շҧ..."; break;
		}
	}
	else if (.@npc_name$ == "#Gertie_Wie_A1") {
		.@talker_name$ = "#lhz_dun_talk_A21";
		switch (rand(4)) {
			case 0:  .@msg$ = "��Ҷ١��..."; break;
			case 1:  .@msg$ = "�س���ѧ����������..."; break;
			case 2:  .@msg$ = "�ѹ���ҧ�Թ�...�ͧ�����繷ҧ�͡���..."; break;
			default:  .@msg$ = "��...⪤����..."; break;
		}
	}
	else if (.@npc_name$ == "#Gertie_Wie_A2") {
		.@talker_name$ = "#lhz_dun_talk_A22";
		switch (rand(5)) {
			case 0:  .@msg$ = "�ѹ��è����Ѻ�Թ�ҡ���ҹ���ҩѹ�������ѹ���Դ���..."; break;
			case 1:  .@msg$ = "����ѹ�ʺ...�����Ҩ��Դ���â�鹡Ѻ���...�ѹ��..."; break;
			case 2:  .@msg$ = "���آͧ�ѹ�������...�� �...���Ժ��繹ѡú..."; break;
			case 3:  .@msg$ = "�ѹ�д����ҧ���Ѵ���ѧ...�ѹ��èШ�..."; break;
			default:  .@msg$ = "�������������ѹ���Դ��������Ҩ�����觹��..."; break;
		}
	}
	else if (.@npc_name$ == "#Harword_AltEisen_A1") {
		.@talker_name$ = "#lhz_dun_talk_A9";
		switch (rand(5)) {
			case 0:  .@msg$ = "�͹�����ҧ��¢ͧ�ѹ����͹�������...�ѹ�繤������ʧ��ͧ�ѹ��ԧ�.."; break;
			case 1:  .@msg$ = "������������˹?..�ѹ�����͡�������..."; break;
			case 2:  .@msg$ = "�ѹ�������˹...�ѹ��������§��ҧ�س..."; break;
			case 3:  .@msg$ = "�ѹ��ͧ�ͧ��૫�Ź�ͧ��Ǣͧ�ѹ...�����Ҩ��Դ���â��..."; break;
			default:  .@msg$ = "�ѹ����...�Ե㨢ͧ�ѹ�Ѻŧ..."; break;
		}
	}
	else if (.@npc_name$ == "#Harword Alt-Eisen_A2") {
		.@talker_name$ = "#lhz_dun_talk_A10";
		switch (rand(3)) {
			case 0:  .@msg$ = "�ѹ�ͧ������͹Ҥ��ͧ����ͧ�ա����..."; break;
			case 1:  .@msg$ = "�Ңͧ�ѹ...��Դ..."; break;
			default:  .@msg$ = "����ѹ...��鴴������..."; break;
		}
	}
	else if (.@npc_name$ == "#Magaleta_Sorin_A1") {
		.@talker_name$ = "#lhz_dun_talk_A3";
		switch (rand(5)) {
			case 0:  .@msg$ = "Dear Odin...����� Seyren ��..."; break;
			case 1:  .@msg$ = "�������������ѹ����..."; break;
			case 2:  .@msg$ = "��������������ʧ��ͧ�ѹ...��������ѹ..."; break;
			case 3:  .@msg$ = "��ѧ�ѡ����Է����ѡ�����ʹ�������..."; break;
			default:  .@msg$ = "Dear Odin...May we...May he..."; break;
		}
	}
	else if (.@npc_name$ == "#Magaleta_Sorin_A2") {
		.@talker_name$ = "#lhz_dun_talk_A4";
		switch (rand(4)) {
			case 0:  .@msg$ = "�֧�ʹԹ����ѡ������͡��ѧ�ͧ������..."; break;
			case 1:  .@msg$ = "��ҧ��¢ͧ�ѹ�٭���¤��������..."; break;
			case 2:  .@msg$ = "��ѧ�ѡ����Է�����͹��ŧ������ �..."; break;
			default:  .@msg$ = "My Seyren...�س�������˹..."; break;
		}
	}
	else if (.@npc_name$ == "#Randel_Lawrence_A1") {
		.@talker_name$ = "#lhz_dun_talk_A13";
		switch (rand(4)) {
			case 0:  .@msg$ = "�ѹ�١���ҷ����㹰ҹм��ѭ�ҡ��..."; break;
			case 1:  .@msg$ = "�͹����ѹ��������...��ԧ�..."; break;
			case 2:  .@msg$ = "�ѹ���ʴ���ѧ�ͧ���ҴԹ..."; break;
			default:  .@msg$ = "�١���ͧ͢�ѹ�������˹..."; break;
		}
	}
	else if (.@npc_name$ == "#Randel_Lawrence_A2") {
		.@talker_name$ = "#lhz_dun_talk_A14";
		switch (rand(5)) {
			case 0:  .@msg$ = "���١����...��Ҿǡ�س�ʹ...�س��ͧ�͡�ҡ��觹��...����ͤ����..."; break;
			case 1:  .@msg$ = "��ѧ�ͧ�ѹ��������..."; break;
			case 2:  .@msg$ = "��蹤������..���ѧ����¹..."; break;
			case 3:  .@msg$ = "�ѹ�繼���ʹ���Ե���ش���·��������.."; break;
			default:  .@msg$ = "�ѹ��ǧ�����������ѹ�״���˹�ҩѹ..."; break;
		}
	}
	else if (.@npc_name$ == "#Seyren_Windsor_A1") {
		.@talker_name$ = "#lhz_dun_talk_A1";
		switch (rand(4)) {
			case 0:  .@msg$ = "�ѹ��ͧ�����͹...�ѹ��ͧ..."; break;
			case 1:  .@msg$ = "��Թ�����˹..���͹�ѹʺ�´����.."; break;
			case 2:  .@msg$ = "�ռ������������Ӣͧ���...������û�ʹ��·��к͡�Ѻ..."; break;
			default:  .@msg$ = "��ͧ͢�ѹ������Ѻ������ͧ���..."; break;
		}
	}
	else if (.@npc_name$ == "#Seyren_Windsor_A2") {
		.@talker_name$ = "#lhz_dun_talk_A2";
		switch (rand(5)) {
			case 0:  .@msg$ = "�ѹ����֡�Դ..."; break;
			case 1:  .@msg$ = "�ѹ����Թ������ص�������õ��ȩѹ�����������ͧ͢�ѹ���ŷԹ..."; break;
			case 2:  .@msg$ = "��ͧ˹ըҡ�ǡ��...��觹�������..."; break;
			case 3:  .@msg$ = "����������ö����ʶҹ����蹹��..."; break;
			default:  .@msg$ = "����ѡ...Margaretha..."; break;
		}
	}
	else if (.@npc_name$ == "#Shecil_Damon_A1") {
		.@talker_name$ = "#lhz_dun_talk_A11";
		switch (rand(5)) {
			case 0:  .@msg$ = "���� �...�������..."; break;
			case 1:  .@msg$ = "⶧�ҧ�Թ��������ҧ�͡����..."; break;
			case 2:  .@msg$ = "�ѹ����...�ͩѹ��Թ..."; break;
			case 3:  .@msg$ = "�ѹ����...�ҡ...����..."; break;
			default:  .@msg$ = "�ѹ�ѧ�ո������١������..."; break;
		}
	}
	else if (.@npc_name$ == "#Shecil_Damon_A2") {
		.@talker_name$ = "#lhz_dun_talk_A12";
		switch (rand(5)) {
			case 0:  .@msg$ = "�ѹ���Ẻ������������..."; break;
			case 1:  .@msg$ = "��Թ...��˹..."; break;
			case 2:  .@msg$ = "���͹...��蹤����觷��ѹ�Դ�֧..."; break;
			case 3:  .@msg$ = "㹪�ͧ��鹤������..���Դ��鹷���˹..?"; break;
			default:  .@msg$ = "�ѹ����...�ѹ�ѧ��診..."; break;
		}
	}
	else if (.@npc_name$ == "#Trentini_A1") {
		.@talker_name$ = "#lhz_dun_talk_A25";
		switch (rand(5)) {
			case 0:  .@msg$ = "�ѹ����֡��������������˹..."; break;
			case 1:  .@msg$ = "�ѹ�з��ѧ䧴�?..�Ǵ���������Թ..."; break;
			case 2:  .@msg$ = "�ѹ�繤����Դ�ͧ�ѹ�ͧ...�ѹ����ԡ�Ѻ Alphoccio 㹷���ش..."; break;
			case 3:  .@msg$ = "�ѹ�������ѹ��͡�á����...��蹤�ͼ��Ѿ��..."; break;
			default:  .@msg$ = "�ѹ�Դ�֧�س...�ҡ..."; break;
		}
	}
	else if (.@npc_name$ == "#Trentini_A2") {
		.@talker_name$ = "#lhz_dun_talk_A26";
		switch (rand(4)) {
			case 0:  .@msg$ = "�����������¤�..���͹��...���..."; break;
			case 1:  .@msg$ = "��͡��ҹ������ͧ..."; break;
			case 2:  .@msg$ = "�ѹ�ͺ�ء���§�ͧ�ǡ���ҡ..."; break;
			default: .@msg$ = "��ҧ��¢ͧ�ѹ������Ѻ���..."; break;
		}
	}
	npctalk .@msg$, .@talker_name$;
	end;
OnTimer40000:
	stopnpctimer;
	enablenpc strnpcinfo(0);
	end;
}

lhz_dun_n,92,102,0	duplicate(#Alphoccio_Basil_A1)	#Alphoccio_Basil_A2	HIDDEN_WARP_NPC,3,3
lhz_dun_n,150,74,0	duplicate(#Alphoccio_Basil_A1)	#Catherine Cheiron_A1	HIDDEN_WARP_NPC,3,3
lhz_dun_n,174,98,0	duplicate(#Alphoccio_Basil_A1)	#Katrinn Chiron_A2	HIDDEN_WARP_NPC,3,3
lhz_dun_n,25,65,0	duplicate(#Alphoccio_Basil_A1)	#Celia_Alde_A1	HIDDEN_WARP_NPC,3,3
lhz_dun_n,60,102,0	duplicate(#Alphoccio_Basil_A1)	#Celia_Alde_A2	HIDDEN_WARP_NPC,3,3
lhz_dun_n,194,188,0	duplicate(#Alphoccio_Basil_A1)	#Chen_Liu_A1	HIDDEN_WARP_NPC,3,3
lhz_dun_n,255,206,0	duplicate(#Alphoccio_Basil_A1)	#Chen_Liu_A2	HIDDEN_WARP_NPC,3,3
lhz_dun_n,81,184,0	duplicate(#Alphoccio_Basil_A1)	#Eremes_Guille_A1	HIDDEN_WARP_NPC,3,3
lhz_dun_n,113,191,0	duplicate(#Alphoccio_Basil_A1)	#Eremes_Guille_A2	HIDDEN_WARP_NPC,3,3
lhz_dun_n,84,87,0	duplicate(#Alphoccio_Basil_A1)	#Flamel_Emule_A1	HIDDEN_WARP_NPC,3,3
lhz_dun_n,39,55,0	duplicate(#Alphoccio_Basil_A1)	#Flamel_Emule_A2	HIDDEN_WARP_NPC,3,3
lhz_dun_n,232,198,0	duplicate(#Alphoccio_Basil_A1)	#Gertie_Wie_A1	HIDDEN_WARP_NPC,3,3
lhz_dun_n,130,148,0	duplicate(#Alphoccio_Basil_A1)	#Gertie_Wie_A2	HIDDEN_WARP_NPC,3,3
lhz_dun_n,119,195,0	duplicate(#Alphoccio_Basil_A1)	#Harword Alt-Eisen_A1	HIDDEN_WARP_NPC,3,3
lhz_dun_n,158,210,0	duplicate(#Alphoccio_Basil_A1)	#Harword Alt-Eisen_A2	HIDDEN_WARP_NPC,3,3
lhz_dun_n,159,122,0	duplicate(#Alphoccio_Basil_A1)	#Magaleta_Sorin_A1	HIDDEN_WARP_NPC,3,3
lhz_dun_n,133,39,0	duplicate(#Alphoccio_Basil_A1)	#Magaleta_Sorin_A2	HIDDEN_WARP_NPC,3,3
lhz_dun_n,168,193,0	duplicate(#Alphoccio_Basil_A1)	#Randel_Lawrence_A1	HIDDEN_WARP_NPC,3,3
lhz_dun_n,188,188,0	duplicate(#Alphoccio_Basil_A1)	#Randel_Lawrence_A2	HIDDEN_WARP_NPC,3,3
lhz_dun_n,44,155,0	duplicate(#Alphoccio_Basil_A1)	#Seyren Windsor_A1	HIDDEN_WARP_NPC,3,3
lhz_dun_n,54,221,0	duplicate(#Alphoccio_Basil_A1)	#Seyren Windsor_A2	HIDDEN_WARP_NPC,3,3
lhz_dun_n,249,66,0	duplicate(#Alphoccio_Basil_A1)	#Shecil_Damon_A1	HIDDEN_WARP_NPC,3,3
lhz_dun_n,213,97,0	duplicate(#Alphoccio_Basil_A1)	#Shecil_Damon_A2	HIDDEN_WARP_NPC,3,3
lhz_dun_n,191,129,0	duplicate(#Alphoccio_Basil_A1)	#Trentini_A1	HIDDEN_WARP_NPC,3,3
lhz_dun_n,259,132,0	duplicate(#Alphoccio_Basil_A1)	#Trentini_A2	HIDDEN_WARP_NPC,3,3

lhz_dun_n,44,155,6	script	#lhz_dun_talk_A1	CLEAR_NPC,{ end; }
lhz_dun_n,54,221,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A2	CLEAR_NPC
lhz_dun_n,159,122,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A3	CLEAR_NPC
lhz_dun_n,133,39,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A4	CLEAR_NPC
lhz_dun_n,150,74,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A5	CLEAR_NPC
lhz_dun_n,174,98,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A6	CLEAR_NPC
lhz_dun_n,81,184,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A7	CLEAR_NPC
lhz_dun_n,113,191,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A8	CLEAR_NPC
lhz_dun_n,119,195,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A9	CLEAR_NPC
lhz_dun_n,158,210,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A10	CLEAR_NPC
lhz_dun_n,249,66,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A11	CLEAR_NPC
lhz_dun_n,213,97,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A12	CLEAR_NPC
lhz_dun_n,168,193,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A13	CLEAR_NPC
lhz_dun_n,188,188,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A14	CLEAR_NPC
lhz_dun_n,84,87,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A15	CLEAR_NPC
lhz_dun_n,39,55,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A16	CLEAR_NPC
lhz_dun_n,25,65,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A17	CLEAR_NPC
lhz_dun_n,60,102,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A18	CLEAR_NPC
lhz_dun_n,194,188,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A19	CLEAR_NPC
lhz_dun_n,255,206,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A20	CLEAR_NPC
lhz_dun_n,232,198,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A21	CLEAR_NPC
lhz_dun_n,130,148,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A22	CLEAR_NPC
lhz_dun_n,75,121,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A23	CLEAR_NPC
lhz_dun_n,92,102,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A24	CLEAR_NPC
lhz_dun_n,191,129,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A25	CLEAR_NPC
lhz_dun_n,259,132,6	duplicate(#lhz_dun_talk_A1)	#lhz_dun_talk_A26	CLEAR_NPC

// npc location -> quest ID inaccurate
lhz_dun_n,132,61,2	script	A Questionable Device#14684	4_SYSTEM_BOX,5,5,{
	end;
OnTouch:
	.@quest_id = atoi(strnpcinfo(2));
	switch( checkquest(.@quest_id,PLAYTIME) ) {
	case -1:
		break;
	case 0:
	case 1:
		npctalk "...�Ѩ�غѹ...��ͧ���...����..���..��ǹ�..";
		end;
	case 2:
		erasequest .@quest_id;
		break;
	}
	specialeffect EF_MAPPILLAR;
	npctalk "��ⵤ�� �ء�Թ...�Դ��..���..RT..017...��Ŵ�ǹ�...1 �������......";
	specialeffect2 EF_BABY;
	setquest .@quest_id;// Mysterious Device
	switch( .@quest_id ) {
	case 14684:
		// atk dmg+10%, def+10% on monsters (inaccurates, unknown values)
		// atk+: Swordman, Thief / def+: Acolyte, Merchant
		sc_start2 SC_LHZ_DUN_N1,1800000,10,10,10000,SCSTART_NOTICKDEF;	/// last 30 mins
		break;
	case 14685:
		// atk+: Acolyte, Merchant / def+: Mage, Archer
		sc_start2 SC_LHZ_DUN_N2,1800000,10,10,10000,SCSTART_NOTICKDEF;
		break;
	case 14686:
		// atk+: Mage, Archer / def+: Swordman, Thief
		sc_start2 SC_LHZ_DUN_N3,1800000,10,10,10000,SCSTART_NOTICKDEF;
		break;
	case 14687:
		// atk+: MvPs / def+: MvPs
		sc_start2 SC_LHZ_DUN_N4,1800000,10,10,10000,SCSTART_NOTICKDEF;
		break;
	}
	end;

OnInit:
	.@condition$ = "!isbegin_quest(" + strnpcinfo(2) + ")";
	questinfo( QTYPE_QUEST, QMARK_YELLOW, .@condition$ );
	end;
}

lhz_dun_n,53,127,2	duplicate(A Questionable Device#14684)	A Questionable Device#14685	4_SYSTEM_BOX,5,5
lhz_dun_n,214,127,2	duplicate(A Questionable Device#14684)	A Questionable Device#14686	4_SYSTEM_BOX,5,5
lhz_dun_n,148,148,2	duplicate(A Questionable Device#14684)	A Questionable Device#14687	4_SYSTEM_BOX,5,5

/*
// Unknown effects
lhz_dun_n,130,204,2	script	Dead Man#lhzd01	4_TOWER_06,5,5
lhz_dun_n,78,133,2	script	Dead Man#lhzd02	4_TOWER_06,5,5
lhz_dun_n,47,65,2	script	Dead Man#lhzd03	4_TOWER_06,5,5
lhz_dun_n,141,39,2	script	Dead Man#lhzd04	4_TOWER_06,5,5
lhz_dun_n,123,85,2	script	Dead Man#lhzd05	4_TOWER_06,5,5
lhz_dun_n,212,71,2	script	Dead Man#lhzd06	4_TOWER_06,5,5
lhz_dun_n,213,109,2	script	Dead Man#lhzd07	4_TOWER_06,5,5
lhz_dun_n,145,179,2	script	Dead Man#lhzd08	4_TOWER_06,5,5
lhz_dun_n,233,135,2	script	Dead Man#lhzd09	4_TOWER_06,5,5
lhz_dun_n,241,201,2	script	Dead Man#lhzd10	4_TOWER_06,5,5
lhz_dun_n,150,211,2	script	Dead Man#lhzd11	4_TOWER_03,5,5
lhz_dun_n,69,144,2	script	Dead Man#lhzd12	4_TOWER_03,5,5
lhz_dun_n,113,81,2	script	Dead Man#lhzd13	4_TOWER_03,5,5
lhz_dun_n,144,64,2	script	Dead Man#lhzd14	4_TOWER_03,5,5
lhz_dun_n,157,93,2	script	Dead Man#lhzd15	4_TOWER_03,5,5
lhz_dun_n,231,69,2	script	Dead Man#lhzd16	4_TOWER_03,5,5
lhz_dun_n,179,107,2	script	Dead Man#lhzd17	4_TOWER_03,5,5
lhz_dun_n,172,175,2	script	Dead Man#lhzd18	4_TOWER_03,5,5
lhz_dun_n,228,149,2	script	Dead Man#lhzd19	4_TOWER_03,5,5
lhz_dun_n,248,218,2	script	Dead Man#lhzd20	4_TOWER_03,5,5
lhz_dun_n,139,233,2	script	Dead Man#lhzd21	4_TOWER_08,5,5
lhz_dun_n,69,110,2	script	Dead Man#lhzd22	4_TOWER_08,5,5
lhz_dun_n,100,109,2	script	Dead Man#lhzd23	4_TOWER_08,5,5
lhz_dun_n,137,72,2	script	Dead Man#lhzd24	4_TOWER_08,5,5
lhz_dun_n,169,85,2	script	Dead Man#lhzd25	4_TOWER_08,5,5
lhz_dun_n,245,63,2	script	Dead Man#lhzd26	4_TOWER_08,5,5
lhz_dun_n,182,126,2	script	Dead Man#lhzd27	4_TOWER_08,5,5
lhz_dun_n,182,154,2	script	Dead Man#lhzd28	4_TOWER_08,5,5
lhz_dun_n,246,141,2	script	Dead Man#lhzd29	4_TOWER_08,5,5
lhz_dun_n,236,226,2	script	Dead Man#lhzd30	4_TOWER_08,5,5
lhz_dun_n,38,200,2	script	Dead Man#lhzd31	4_TOWER_11,5,5
lhz_dun_n,95,86,2	script	Dead Man#lhzd32	4_TOWER_11,5,5
lhz_dun_n,98,138,2	script	Dead Man#lhzd33	4_TOWER_11,5,5
lhz_dun_n,145,89,2	script	Dead Man#lhzd34	4_TOWER_11,5,5
lhz_dun_n,186,92,2	script	Dead Man#lhzd35	4_TOWER_11,5,5
lhz_dun_n,181,148,2	script	Dead Man#lhzd36	4_TOWER_11,5,5
lhz_dun_n,181,148,2	script	Dead Man#lhzd37	4_TOWER_11,5,5
lhz_dun_n,203,144,2	script	Dead Man#lhzd38	4_TOWER_11,5,5
lhz_dun_n,240,134,2	script	Dead Man#lhzd39	4_TOWER_11,5,5
lhz_dun_n,141,129,2	script	Dead Man#lhzd40	4_TOWER_11,5,5
lhz_dun_n,81,160,2	script	Dead Man#lhzd41	4_TOWER_13,5,5
lhz_dun_n,41,77,2	script	Dead Man#lhzd42	4_TOWER_13,5,5
lhz_dun_n,99,162,2	script	Dead Man#lhzd43	4_TOWER_13,5,5
lhz_dun_n,136,95,2	script	Dead Man#lhzd44	4_TOWER_13,5,5
lhz_dun_n,184,80,2	script	Dead Man#lhzd45	4_TOWER_13,5,5
lhz_dun_n,202,102,2	script	Dead Man#lhzd46	4_TOWER_13,5,5
lhz_dun_n,157,143,2	script	Dead Man#lhzd47	4_TOWER_13,5,5
lhz_dun_n,202,133,2	script	Dead Man#lhzd48	4_TOWER_13,5,5
lhz_dun_n,220,178,2	script	Dead Man#lhzd49	4_TOWER_13,5,5
lhz_dun_n,131,148,2	script	Dead Man#lhzd50	4_TOWER_13,5,5
*/