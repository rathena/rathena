//===== rAthena Script =======================================
//= Gold PC Bonus NPC
//===== Description: =========================================
//= NPC that can be spawned via the Gold PC Timer Button.
//===== Changelog: ===========================================
//= Customized to show reward item and amount in the menu
//============================================================

prt_in,45,117,5	script	Goldpoint Manager::GOLDPCCAFE	4_TREASURE_BOX,{

	// Format: "ITEM_ID:AMOUNT:COST_IN_POINTS"
	setarray .items$[1],
		"1230003:1:120",
		"1230003:2:210",
		"1230003:3:300";

	mes "[Goldpoint Manager]";
	mes "You currently have ^0000ff"+#Goldpc_Points+"^000000 points.";
	mes "What reward do you want?";
	next;

	// First option: just view current points
	.@menu$ = "View current points";

	// Build dynamic menu with item name, amount and cost
	for (.@i = 1; .@i < getarraysize(.items$); .@i++) {
		explode(.@array$, .items$[.@i], ":");
		.@itemid = atoi(.@array$[0]);
		.@amount = atoi(.@array$[1]);
		.@cost   = atoi(.@array$[2]);
		.@name$  = getitemname(.@itemid);

		// Label example: "3x Beginner Coin (300 points)"
		.@line$ = .@amount + "x " + .@name$ + " (" + .@cost + " points)";

		// Mark as not enough points if player can't afford
		if (#Goldpc_Points < .@cost)
			.@line$ += " ^ff0000(not enough points)^000000";

		.@menu$ += ":" + .@line$;
	}

	.@s = select(.@menu$) - 1;

	// Option 0: just view points
	if (.@s == 0) {
		mes "[Goldpoint Manager]";
		mes "You currently have ^0000ff"+#Goldpc_Points+"^000000 points.";
		close;
	}

	// Resolve selected reward
	explode(.@array$, .items$[.@s], ":");
	.@itemid = atoi(.@array$[0]);
	.@amount = atoi(.@array$[1]);
	.@cost   = atoi(.@array$[2]);
	.@name$  = getitemname(.@itemid);

	if (#Goldpc_Points < .@cost) {
		mes "[Goldpoint Manager]";
		mes "You have ^0000ff"+#Goldpc_Points+"^000000 points remaining.";
		mes "You cannot get ^FFCC00"+.@amount+"x "+.@name$+"^000000 with this amount of points.";
		close;
	}

	mes "[Goldpoint Manager]";
	mes "You chose ^FFCC00"+.@amount+"x "+.@name$+"^000000 for ^0000ff"+.@cost+"^000000 points.";
	mes "We will reward you immediately.";
	next;

	#Goldpc_Points -= .@cost;
	getitem .@itemid, .@amount;

	mes "[Goldpoint Manager]";
	mes "You received ^FFCC00"+.@amount+"x "+.@name$+"^000000.";
	mes "You have ^0000ff"+#Goldpc_Points+"^000000 points remaining.";
	close;
}
